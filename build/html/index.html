<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marine Robotics Computer Vision &mdash; Marine Robotics Computer Vision  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Marine Robotics Computer Vision
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Marine Robotics Computer Vision</a></li>
<li><a class="reference internal" href="#id1">Дополнительные ссылки</a></li>
<li><a class="reference internal" href="#id2">Рекомедуемая минимальная конфигурация</a></li>
<li><a class="reference internal" href="#id3">Описание служебных структур</a><ul>
<li><a class="reference internal" href="#id4">Перечисления:</a></li>
<li><a class="reference internal" href="#id5">Структуры:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">Модуль служебных функций</a><ul>
<li><a class="reference internal" href="#id7">Функции работы с изображениями</a></li>
<li><a class="reference internal" href="#id8">Функции работы с видео</a></li>
<li><a class="reference internal" href="#id9">Функции калибровки камер</a></li>
<li><a class="reference internal" href="#id10">Функции логирования</a></li>
<li><a class="reference internal" href="#id11">Функции работы с изображениями из интернета</a></li>
<li><a class="reference internal" href="#id12">Функции построения карты диспаратности</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">Модуль аугментации</a><ul>
<li><a class="reference internal" href="#id14">Функция поворота изображения</a></li>
<li><a class="reference internal" href="#id15">Функция отражения изображения</a></li>
<li><a class="reference internal" href="#id16">Функция аугментации изображений</a></li>
<li><a class="reference internal" href="#id17">Поддерживаемые методы аугментации:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">Модуль кластеризации</a><ul>
<li><a class="reference internal" href="#id19">Загрузка данных из файла</a></li>
<li><a class="reference internal" href="#id20">Кластеризация загруженных данных</a></li>
<li><a class="reference internal" href="#id21">Печать информации о кластерах</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id22">Модуль сравнения изображений</a><ul>
<li><a class="reference internal" href="#id23">Сравнение изображений</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id24">Модуль детекции изображений</a><ul>
<li><a class="reference internal" href="#id25">Инициализация детектора</a></li>
<li><a class="reference internal" href="#id26">Загрузка предобученной модели</a></li>
<li><a class="reference internal" href="#id27">Обучение модели</a></li>
<li><a class="reference internal" href="#id28">Автоматический подбор гиперпараметров</a></li>
<li><a class="reference internal" href="#id29">Предсказание и визуализация</a><ul>
<li><a class="reference internal" href="#id30">Валидация модели</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id31">Модуль предварительной обработки изображений</a><ul>
<li><a class="reference internal" href="#id32">Функция создания изображения с сообщением об ошибке</a></li>
<li><a class="reference internal" href="#id33">Коррекция яркости изображения</a></li>
<li><a class="reference internal" href="#id34">Увеличение резкости (метод Лапласа)</a></li>
<li><a class="reference internal" href="#id35">Увеличение резкости (метод Гаусса)</a></li>
<li><a class="reference internal" href="#id36">Основная функция предварительной обработки</a></li>
<li><a class="reference internal" href="#id37">Увеличение контраста изображения</a></li>
<li><a class="reference internal" href="#id38">Балансировка контраста</a></li>
<li><a class="reference internal" href="#id39">Расширение контраста</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id40">Модуль морфологических преобразований</a><ul>
<li><a class="reference internal" href="#id41">Основная функция морфологических преобразований</a></li>
<li><a class="reference internal" href="#id42">Функция морфологического открытия</a></li>
<li><a class="reference internal" href="#id43">Функция морфологического закрытия</a></li>
<li><a class="reference internal" href="#id44">Функция морфологического градиента</a></li>
<li><a class="reference internal" href="#id45">Функция морфологической эрозии</a></li>
<li><a class="reference internal" href="#id46">Функция морфологического расширения</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id47">Модуль расчета курса объекта</a><ul>
<li><a class="reference internal" href="#objcourse">Класс ObjCourse</a></li>
<li><a class="reference internal" href="#id48">Инициализация нейронной сети</a></li>
<li><a class="reference internal" href="#id49">Основной процесс обработки</a></li>
<li><a class="reference internal" href="#id50">Расчет курса</a></li>
<li><a class="reference internal" href="#id51">Предобработка изображения</a></li>
<li><a class="reference internal" href="#id52">Постобработка результатов</a></li>
<li><a class="reference internal" href="#id53">Отрисовка меток</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id54">Модуль сегментации изображений</a><ul>
<li><a class="reference internal" href="#fpn">Архитектура FPN</a></li>
<li><a class="reference internal" href="#segmentor">Класс Segmentor</a></li>
<li><a class="reference internal" href="#id55">Вспомогательные классы</a></li>
<li><a class="reference internal" href="#id56">Функции потерь</a></li>
</ul>
</li>
<li><a class="reference internal" href="#d">Модуль создания 3D сцен</a><ul>
<li><a class="reference internal" href="#id57">Формирование стереопары</a></li>
<li><a class="reference internal" href="#id58">Построение карты диспаратности</a></li>
<li><a class="reference internal" href="#id59">Сегментация объектов</a></li>
<li><a class="reference internal" href="#id60">Визуализация 3D сцены</a></li>
<li><a class="reference internal" href="#id61">Сохранение результатов</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yolov5">Модуль работы с YOLOv5</a><ul>
<li><a class="reference internal" href="#id62">Интерактивная разметка данных</a></li>
<li><a class="reference internal" href="#id63">Генерация конфигурации модели</a></li>
<li><a class="reference internal" href="#id64">Генерация гиперпараметров</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id65">Подготовка к работе</a><ul>
<li><a class="reference internal" href="#id66">Установка и настройка зависимостей</a></li>
<li><a class="reference internal" href="#id67">Установка и первоначальная настройка библиотеки</a><ul>
<li><a class="reference internal" href="#windows-cuda">Для операционной системы Windows без поддержки CUDA</a></li>
<li><a class="reference internal" href="#id68">Для операционной системы Windows с поддержкой CUDA</a></li>
<li><a class="reference internal" href="#linux-ubuntu-cuda">Для операционной системы Linux (Ubuntu) без поддержки CUDA (пошаговая версия)</a></li>
<li><a class="reference internal" href="#id69">Для операционной системы Linux (Ubuntu) без поддержки CUDA (версия с помощью скрипта)</a></li>
<li><a class="reference internal" href="#id70">Для операционной системы Linux (Ubuntu) с поддержкой CUDA (пошаговая версия)</a></li>
<li><a class="reference internal" href="#id71">Для операционной системы Linux (Ubuntu) с поддержкой CUDA (версия с помощью скрипта)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-mrcv">Инструкция по установке Python версии библиотеки mrcv</a></li>
<li><a class="reference internal" href="#mini">Для mini-ПК</a></li>
<li><a class="reference internal" href="#id72">Подготовка данных для работы с примерами</a></li>
<li><a class="reference internal" href="#id73">Запуск примеров библиотеки</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id74">Демонстрационные примеры</a><ul>
<li><a class="reference internal" href="#id75">Программные функции библиотеки для подсчета количества объектов интереса по данным видеопотока в реальном масштабе времени и определения курса роботизированного аппарата на объект интереса</a></li>
<li><a class="reference internal" href="#id76">Пример использования программных функций библиотеки для автоматической настройки параметров обучения нейросети с архитектурой YOLOv5</a></li>
<li><a class="reference internal" href="#id77">Пример использования программных функций библиотеки для автоматической генерации конфигурационных файлов для моделей детекторов и классификаторов</a></li>
<li><a class="reference internal" href="#id78">Пример использования программных функций библиотеки для автоматического обучения нейронной сети для детекции и идентификации объектов</a></li>
<li><a class="reference internal" href="#id79">Пример использования программных функций библиотеки для детектирования аварийной ситуации технологического объекта</a></li>
<li><a class="reference internal" href="#id80">Пример использования программных функций библиотеки для сопровождения объекта по данным системы компьютерного зрения с применением нейросетевого подхода к предсказанию положения объекта</a></li>
<li><a class="reference internal" href="#roi">Пример использования программных функций библиотеки для построения региона интереса (ROI) с использованием предсказания перемещения объекта интереса на исходном изображении</a></li>
<li><a class="reference internal" href="#id81">Пример использования программных функций библиотеки для предварительной обработки изображений (автоматическая коррекция контраста и яркости, исправление геометрических искажений)</a></li>
<li><a class="reference internal" href="#d-3d">Пример использования программных функций библиотеки для компьютерного стереозрения для определения координат 3D точек в сегментах идентифицированных объектов и восстановления 3D сцены по двумерным изображениям</a></li>
<li><a class="reference internal" href="#id82">Пример использования программных функций библиотеки для служебных утилит работы с видеокамерами, в т.ч. калибровка (одиночная камера и стереокамера)</a></li>
<li><a class="reference internal" href="#id83">Пример использования программных функций библиотеки для автоматического создания датасетов для обучения нейросети</a></li>
<li><a class="reference internal" href="#id84">Пример использования программных функций библиотеки для интеллектуальной сегментации объектов интереса на изображениях</a></li>
<li><a class="reference internal" href="#id85">Пример использования программных функций библиотеки для реализации модифицированного алгоритма выделения связных компонент для кластеризации облака 3D точек</a></li>
<li><a class="reference internal" href="#id86">Пример использования программных функций библиотеки для предварительной обработки изображений для модуля аугментации данных</a></li>
<li><a class="reference internal" href="#id87">Пример использования программных функций библиотеки для полуавтоматической разметки для аугментации данных с помощью нейронной сети</a></li>
<li><a class="reference internal" href="#id88">Пример использования программных функций библиотеки для утилиты обработки и визуальной разметки изображений модуля аугментации данных</a></li>
<li><a class="reference internal" href="#id89">Пример использования программных функций библиотеки для генерации новых изображений для формирования обучающей выборки нейросетевого модуля аугментации данных</a></li>
<li><a class="reference internal" href="#id90">Пример использования программных функций библиотеки для комплексирования данных, поступающих от сенсоров различных видов</a></li>
<li><a class="reference internal" href="#id91">Пример использования программных функций библиотеки для формирования вектора признаков по данным, поступающим от сенсоров различных видов</a></li>
<li><a class="reference internal" href="#id92">Пример использования программных функций библиотеки для интеграции функций библиотеки для системы технического зрения морского робототехнического комплекса с одиночной камерой</a></li>
<li><a class="reference internal" href="#id93">Пример использования программных функций библиотеки для интеграции функций библиотеки для системы технического зрения морского робототехнического комплекса со стереокамерой</a></li>
<li><a class="reference internal" href="#id94">Пример использования программных функций библиотеки для определения пространственного расположения объектов интереса</a></li>
<li><a class="reference internal" href="#id95">Пример использования программных функций библиотеки для реализации алгоритма оценки параметров идентифицированных объектов заданной формы</a></li>
<li><a class="reference internal" href="#id96">Пример использования программных функций библиотеки для предварительной обработки изображений (удаление шумов, морфологическая обработка)</a></li>
<li><a class="reference internal" href="#id97">Пример использования программных функций библиотеки для анализа изображений для выявления изменения состояния подводных археологических объектов</a></li>
<li><a class="reference internal" href="#id98">Пример использования программных функций библиотеки для реализации алгоритма оценки геометрических размеров (габаритов) видимой части идентифицированных объектов</a></li>
<li><a class="reference internal" href="#arm">Пример использования адаптированных программные функций библиотеки для детекции и идентификации объектов с использованием процессоров ARM</a></li>
<li><a class="reference internal" href="#cuda">Пример использования адаптированных программных функций библиотеки для детекции и идентификации объектов с использованием технологии CUDA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id99">Демонстрационные примеры на Python</a><ul>
<li><a class="reference internal" href="#objcourse-py">Описание скрипта objcourse.py: определение курса на объект</a></li>
<li><a class="reference internal" href="#yolov5-py">Описание скрипта <code class="docutils literal notranslate"><span class="pre">yolov5.py</span></code></a></li>
<li><a class="reference internal" href="#roi-py">Описание Скрипта <code class="docutils literal notranslate"><span class="pre">roi.py</span></code></a></li>
<li><a class="reference internal" href="#vae-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">vae.py</span></code></a></li>
<li><a class="reference internal" href="#segmentation-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">segmentation.py</span></code></a></li>
<li><a class="reference internal" href="#clustering-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">clustering.py</span></code></a></li>
<li><a class="reference internal" href="#disparity-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">disparity.py</span></code></a></li>
<li><a class="reference internal" href="#dscene-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">3dscene.py</span></code></a></li>
<li><a class="reference internal" href="#imgpreprocessing-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">imgpreprocessing.py</span></code></a></li>
<li><a class="reference internal" href="#comparing-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">comparing.py</span></code></a></li>
<li><a class="reference internal" href="#detectorautotrain-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">detectorautotrain.py</span></code></a></li>
<li><a class="reference internal" href="#augmentation-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">augmentation.py</span></code></a></li>
<li><a class="reference internal" href="#morphologyimage-py">Описание для скрипта <code class="docutils literal notranslate"><span class="pre">morphologyimage.py</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id100">Руководство для контрибьюторов</a><ul>
<li><a class="reference internal" href="#id101">Получение исходного кода</a></li>
<li><a class="reference internal" href="#mrcv">Необходимые зависимости для установки библиотеки mrcv</a></li>
<li><a class="reference internal" href="#windows-linux-mrcv">Инструкция по установке Windows/Linux версии библиотеки mrcv</a></li>
<li><a class="reference internal" href="#id102">Оформление изменений</a></li>
<li><a class="reference internal" href="#id103">Отчёты об ошибках</a></li>
<li><a class="reference internal" href="#id104">Рекомендации по контрибьюции</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Marine Robotics Computer Vision</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Marine Robotics Computer Vision</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="marine-robotics-computer-vision">
<h1>Marine Robotics Computer Vision<a class="headerlink" href="#marine-robotics-computer-vision" title="Link to this heading"></a></h1>
<p>Открытая библиотека компьютерного зрения для морских робототехнических систем Marine Robotics Computer Vision (MRCV).</p>
<p>Библиотека, в первую очередь, предназначена для разработчиков роботизированных систем морского назначения, оснащенных системами технического зрения:</p>
<ul class="simple">
<li><p>морские надводные поисковые дроны;</p></li>
<li><p>морские подводные телеуправляемые и автономные аппараты для проведения поисковых, исследовательских, спасательных и археологических работ;</p></li>
<li><p>морские подводные роботизированные комплексы для проведения осмотровых, сварочных и мониторинговых работ.</p></li>
</ul>
<p>В тоже время, библиотека может полезна разработчикам наземных и воздушных роботизированных систем с системами технического зрения таких как:</p>
<ul class="simple">
<li><p>роботы доставщики;</p></li>
<li><p>воздушные дроны, используемые для мониторинговых задач;</p></li>
<li><p>беспилотные транспортные средства.</p></li>
</ul>
<p>В состав библиотеки входят как интеллектуальные алгоритмы компьютерного зрения, так и набор алгоритмов, необходимых для подготовки и тестирования аппаратной части комплексов (работа с видеокамерами).</p>
<p>Примеры использования функций модулей размещены в папке <cite>examples</cite></p>
<p>Особенность библиотеки состоит в простоте использования и универсальности предлагаемых решений, что в значительной степени должно упростить и ускорить разработку аппаратных комплексов и транспортных систем, оснащенных системами компьютерного зрения.</p>
<p>Проект выполнен при грантовой поддержке Фонда содействия развитию малых форм предприятий в научно-технической сфере.</p>
</section>
<section id="id1">
<h1>Дополнительные ссылки<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>Репозиторий проекта: <a class="reference external" href="https://github.com/valabsoft/code-ai-400393">https://github.com/valabsoft/code-ai-400393</a></p></li>
<li><p>Датасет изображений: <a class="reference external" href="https://huggingface.co/datasets/saigon-89/code-ai-400393">https://huggingface.co/datasets/saigon-89/code-ai-400393</a></p></li>
<li><p>Предобученные модели: <a class="reference external" href="https://huggingface.co/saigon-89/code-ai-400393">https://huggingface.co/saigon-89/code-ai-400393</a></p></li>
<li><p>Страница проекта: <a class="reference external" href="https://vasoftlab.ru/mrcv/">https://vasoftlab.ru/mrcv/</a></p></li>
</ul>
</section>
<section id="id2">
<h1>Рекомедуемая минимальная конфигурация<a class="headerlink" href="#id2" title="Link to this heading"></a></h1>
<p>Для использования библиотеки рекомендуются следующие конфигурации аппаратных средств и операционных систем:</p>
<p><strong>Мини-компьютер</strong></p>
<ul class="simple">
<li><p>процессор: AMD Ryzen 7 5800H</p></li>
<li><p>количество ядер/потоков: 8/16</p></li>
<li><p>частота базовая/boost: 3.2 ГГц / 4.4 ГГц</p></li>
<li><p>оперативная память DDR4: 16 ГБ</p></li>
<li><p>видеокарта: NVIDIA GeForce RTX4070 12 ГБ</p></li>
<li><p>ОС: Linux Ubuntu 22.04</p></li>
</ul>
<p><strong>Одноплатный компьютер</strong></p>
<ul class="simple">
<li><p>процессор: ARM Cortex A78AE v8.2 64-разрядный, 1.5 МБ L2 + 4 МБ L3, 1.5 ГГц</p></li>
<li><p>количество ядер/потоков: 6</p></li>
<li><p>частота базовая: 1.5 ГГц</p></li>
<li><p>оперативная память DDR4: 8 ГБ</p></li>
<li><p>видеокарта: NVIDIA Ampere с 1024 ядрами и 32 ядрами Tensor, 625 МГц, 4 ГБ</p></li>
<li><p>ОС: Linux Ubuntu 18.04</p></li>
</ul>
<p><strong>Одноплатный компьютер (без CUDA)</strong></p>
<ul class="simple">
<li><p>процессор: Broadcom BCM2712 2.4GHz, четыре ядра 64-bit Arm Cortex-A76 CPU, с графическим расширением, 512 КБ на ядро уровня L2 кэш и 2 МБ уровня L3 кэш</p></li>
<li><p>количество ядер/потоков: 4</p></li>
<li><p>частота базовая: 2.4 ГГц</p></li>
<li><p>оперативная память LPDDR4X: 8 ГБ</p></li>
<li><p>видеокарта: VideoCore VII GPU с поддержкой OpenGL ES 3.1, Vulkan 1.2, декодирование HEVC 4Kp60, 256 МБ</p></li>
<li><p>ОС: Linux Ubuntu 22.04</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>В случае использования одноплатного компьютера с архитектурой ARM, для полноценной работы всех функций библиотеки, не рекомендуется использование конфигураций, не поддерживающих технологию CUDA. Для таких конфигураций рекомендуется использование только Python-версии библиотеки.</p>
</div>
</section>
<section id="id3">
<h1>Описание служебных структур<a class="headerlink" href="#id3" title="Link to this heading"></a></h1>
<p>Ниже приведены основные структуры, перечисления и параметры, используемые в библиотеке Marine Robotics Computer Vision для хранения данных, настройки алгоритмов и конфигурации камер.</p>
<section id="id4">
<h2>Перечисления:<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<p><strong>enum class METOD_MORF</strong> — методы морфологических преобразований:
- <cite>OPEN</cite>, <cite>CLOSE</cite>, <cite>GRADIENT</cite>, <cite>ERODE</cite>, <cite>DILAT</cite></p>
<p><strong>enum class CODEC</strong> — поддерживаемые видео-кодеки:
- <cite>XVID</cite>, <cite>MJPG</cite>, <cite>mp4v</cite>, <cite>h265</cite></p>
<p><strong>enum class LOGTYPE</strong> — типы записей в лог-файл:
- <cite>DEBUG</cite>, <cite>ERROR</cite>, <cite>EXCEPTION</cite>, <cite>INFO</cite>, <cite>WARNING</cite></p>
<p><strong>enum class METOD_INCREASE_IMAGE_CONTRAST</strong> — методы повышения контрастности изображения:
- <cite>EQUALIZE_HIST</cite>, <cite>CLAHE</cite>, <cite>CONTRAST_BALANCING</cite>, <cite>CONTRAST_EXTENSION</cite></p>
<p><strong>enum class COLOR_MODEL</strong> — цветовые модели:
- <cite>CM_RGB</cite>, <cite>CM_HSV</cite>, <cite>CM_LAB</cite>, <cite>CM_YCBCR</cite></p>
<p><strong>enum class METOD_IMAGE_PERPROCESSIN</strong> — методы предобработки изображений:
- <cite>NONE</cite>, <cite>CONVERTING_BGR_TO_GRAY</cite>, … <em>(см. исходный код для полного списка)</em></p>
<p><strong>enum class METOD_DISPARITY</strong> — методы расчёта карты диспаратности:
- <cite>MODE_NONE</cite>, <cite>MODE_BM</cite>, <cite>MODE_SGBM</cite>, <cite>MODE_SGBM_3WAY</cite>, <cite>MODE_HH</cite>, <cite>MODE_HH4</cite></p>
<p><strong>enum class AUGMENTATION_METHOD</strong> — методы аугментации изображений:
- <cite>FLIP_HORIZONTAL</cite>, <cite>FLIP_VERTICAL</cite>, <cite>ROTATE_IMAGE_90</cite>, и др.</p>
<p><strong>enum class DISPARITY_TYPE</strong> — типы выходных данных по диспаратности:
- <cite>ALL</cite>, <cite>BASIC_DISPARITY</cite>, <cite>BASIC_HEATMAP</cite>, и др.</p>
</section>
<section id="id5">
<h2>Структуры:<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<p><strong>cameraParameters</strong> — параметры одной камеры</p>
<p><strong>cameraStereoParameters</strong> — параметры стерео-камеры</p>
<p><strong>pointsData</strong> — структура данных для хранения облака точек и их проекций</p>
<p><strong>parameters3dSceene</strong> — параметры построения и отображения 3D сцены</p>
<p><strong>CalibrationParametersMono / Stereo</strong> — результат калибровки камеры</p>
<p><strong>CalibrationConfig</strong> — параметры для загрузки и настройки калибровки</p>
<p><strong>trainTricks</strong> — параметры, влияющие на поведение нейросетевого обучения</p>
<p><strong>settingsMetodDisparity</strong> — параметры алгоритма расчёта карты диспаратности</p>
</section>
</section>
<section id="id6">
<h1>Модуль служебных функций<a class="headerlink" href="#id6" title="Link to this heading"></a></h1>
<p><em>В данном модуле реализованы вспомогательные функции для работы с изображениями, видео, калибровкой камер и логированием.</em></p>
<section id="id7">
<h2>Функции работы с изображениями<a class="headerlink" href="#id7" title="Link to this heading"></a></h2>
<p><strong>Функция сравнения изображений</strong></p>
<p><em>Сравнивает два изображения и возвращает процент различий.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">compareImages</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">img1</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">img2</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">methodCompare</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">img1</span></code> - первое изображение для сравнения</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img2</span></code> - второе изображение для сравнения</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">methodCompare</span></code> - метод сравнения (true/false)</p></li>
</ul>
<p><strong>Возвращает:</strong> процент различий между изображениями</p>
<p><strong>Функция морфологического преобразования</strong></p>
<p><em>Применяет морфологические операции к изображению.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">morphologyImage</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">METOD_MORF</span><span class="w"> </span><span class="n">metod</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">morph_size</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">image</span></code> - входное изображение
- <code class="docutils literal notranslate"><span class="pre">out</span></code> - путь для сохранения результата
- <code class="docutils literal notranslate"><span class="pre">metod</span></code> - тип морфологической операции (OPEN, CLOSE, GRADIENT, ERODE, DILAT)
- <code class="docutils literal notranslate"><span class="pre">morph_size</span></code> - размер ядра преобразования</p>
</section>
<section id="id8">
<h2>Функции работы с видео<a class="headerlink" href="#id8" title="Link to this heading"></a></h2>
<p><strong>Запись видеопотока</strong></p>
<p><em>Записывает видео с камеры в файл.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">recordVideo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cameraID</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">recorderInterval</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fileName</span><span class="p">,</span><span class="w"> </span><span class="n">CODEC</span><span class="w"> </span><span class="n">codec</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">cameraID</span></code> - идентификатор камеры
- <code class="docutils literal notranslate"><span class="pre">recorderInterval</span></code> - интервал записи в секундах
- <code class="docutils literal notranslate"><span class="pre">fileName</span></code> - имя файла для сохранения
- <code class="docutils literal notranslate"><span class="pre">codec</span></code> - используемый кодек (XVID, MJPG, mp4v, h265)</p>
<p><strong>Возвращает:</strong> код результата (0 - успех)</p>
</section>
<section id="id9">
<h2>Функции калибровки камер<a class="headerlink" href="#id9" title="Link to this heading"></a></h2>
<p><strong>Калибровка одиночной камеры</strong></p>
<p><em>Выполняет калибровку одной камеры по изображениям шахматной доски.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">cameraCalibrationMono</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">images</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathToImages</span><span class="p">,</span>
<span class="w">                               </span><span class="n">CalibrationParametersMono</span><span class="o">&amp;</span><span class="w"> </span><span class="n">calibrationParameters</span><span class="p">,</span>
<span class="w">                               </span><span class="kt">int</span><span class="w"> </span><span class="n">chessboardColCount</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chessboardRowCount</span><span class="p">,</span>
<span class="w">                               </span><span class="kt">float</span><span class="w"> </span><span class="n">chessboardSquareSize</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">images</span></code> - вектор имен файлов изображений</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathToImages</span></code> - путь к папке с изображениями</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calibrationParameters</span></code> - структура для хранения параметров калибровки</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chessboardColCount</span></code> - количество углов по горизонтали</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chessboardRowCount</span></code> - количество углов по вертикали</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chessboardSquareSize</span></code> - размер клетки шахматной доски в мм</p></li>
</ul>
<p><strong>Калибровка стереопары</strong></p>
<p><em>Выполняет калибровку стереопары камер.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">cameraCalibrationStereo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">imagesL</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">imagesR</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathToImagesL</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathToImagesR</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">CalibrationParametersStereo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">calibrationParameters</span><span class="p">,</span>
<span class="w">                                 </span><span class="kt">int</span><span class="w"> </span><span class="n">chessboardColCount</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chessboardRowCount</span><span class="p">,</span>
<span class="w">                                 </span><span class="kt">float</span><span class="w"> </span><span class="n">chessboardSquareSize</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">imagesL</span></code>, <code class="docutils literal notranslate"><span class="pre">imagesR</span></code> - векторы имен файлов для левой и правой камер</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathToImagesL</span></code>, <code class="docutils literal notranslate"><span class="pre">pathToImagesR</span></code> - пути к папкам с изображениями</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calibrationParameters</span></code> - структура для хранения параметров калибровки</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chessboardColCount</span></code>, <code class="docutils literal notranslate"><span class="pre">chessboardRowCount</span></code> - количество углов доски</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chessboardSquareSize</span></code> - размер клетки в мм</p></li>
</ul>
</section>
<section id="id10">
<h2>Функции логирования<a class="headerlink" href="#id10" title="Link to this heading"></a></h2>
<p><strong>Запись в лог-файл</strong></p>
<p><em>Записывает сообщение в лог-файл с указанием типа.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">writeLog</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">logText</span><span class="p">,</span><span class="w"> </span><span class="n">LOGTYPE</span><span class="w"> </span><span class="n">logType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOGTYPE</span><span class="o">::</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">logText</span></code> - текст сообщения</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logType</span></code> - тип сообщения (DEBUG, ERROR, EXCEPTION, INFO, WARNING)</p></li>
</ul>
<p><strong>Генерация уникального имени файла</strong></p>
<p><em>Создает уникальное имя файла на основе текущего времени.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">generateUniqueFileName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fileName</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fileExtension</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fileName</span></code> - префикс имени файла</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fileExtension</span></code> - расширение файла</p></li>
</ul>
<p><strong>Возвращает:</strong> строку с уникальным именем файла</p>
</section>
<section id="id11">
<h2>Функции работы с изображениями из интернета<a class="headerlink" href="#id11" title="Link to this heading"></a></h2>
<p><strong>Загрузка изображений с Яндекса</strong></p>
<p><em>Скачивает изображения по запросу из Яндекс.Картинок.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">getImagesFromYandex</span><span class="p">(</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">query</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">minWidth</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">minHeight</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">nameTemplate</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">outputFolder</span><span class="p">,</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">separateDataset</span><span class="p">,</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">trainsetPercentage</span><span class="p">,</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">countFoto</span><span class="p">,</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">money</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">key</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">secretKey</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code> - строка поискового запроса</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minWidth</span></code>, <code class="docutils literal notranslate"><span class="pre">minHeight</span></code> - минимальные размеры изображений</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nameTemplate</span></code> - шаблон имени файла</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outputFolder</span></code> - папка для сохранения</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">separateDataset</span></code> - флаг разделения на train/test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trainsetPercentage</span></code> - процент для обучающей выборки</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">countFoto</span></code> - количество изображений для скачивания</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">money</span></code> - флаг платного API</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code>, <code class="docutils literal notranslate"><span class="pre">secretKey</span></code> - ключи API</p></li>
</ul>
</section>
<section id="id12">
<h2>Функции построения карты диспаратности<a class="headerlink" href="#id12" title="Link to this heading"></a></h2>
<p><strong>Построение карты диспаратности</strong></p>
<p><em>Строит карту диспаратности для стереопары изображений.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">disparityMap</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageLeft</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageRight</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">int</span><span class="w"> </span><span class="n">minDisparity</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">numDisparities</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">blockSize</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">DISPARITY_TYPE</span><span class="w"> </span><span class="n">disparityType</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">int</span><span class="w"> </span><span class="n">colorMap</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">saveToFile</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">showImages</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">map</span></code> - выходная карта диспаратности</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageLeft</span></code>, <code class="docutils literal notranslate"><span class="pre">imageRight</span></code> - изображения стереопары</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minDisparity</span></code> - минимальная диспаратность</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numDisparities</span></code> - количество уровней диспаратности</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blockSize</span></code> - размер блока для сравнения</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code> - параметры фильтрации</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">disparityType</span></code> - тип выходной карты</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">colorMap</span></code> - цветовая схема</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saveToFile</span></code> - флаг сохранения в файл</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">showImages</span></code> - флаг отображения окон</p></li>
</ul>
<p><strong>Возвращает:</strong> код результата (0 - успех)</p>
</section>
</section>
<section id="id13">
<h1>Модуль аугментации<a class="headerlink" href="#id13" title="Link to this heading"></a></h1>
<p><em>В модуле представлены функции, позволяющие выполнять базовые трансформации изображений, включая поворот, отражение, а также массовую аугментацию.</em></p>
<section id="id14">
<h2>Функция поворота изображения<a class="headerlink" href="#id14" title="Link to this heading"></a></h2>
<p><em>Поворачивает изображение на определённый угол с использованием центральной точки.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">rotateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">angle</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание параметров:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">imageInput</span></code> — входное (исходное) изображение <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageOutput</span></code> — выходное (преобразованное) изображение <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">angle</span></code> — угол поворота в градусах.</p></li>
</ul>
<p><strong>return</strong> — код результата работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> — успех,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> — пустое изображение,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> — неизвестный формат изображения,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> — неизвестная ошибка.</p></li>
</ul>
</section>
<section id="id15">
<h2>Функция отражения изображения<a class="headerlink" href="#id15" title="Link to this heading"></a></h2>
<p><em>Отражает изображение по горизонтали, вертикали или обеим осям.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">flipImage</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flipCode</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание параметров:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">imageInput</span></code> — входное (исходное) изображение <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageOutput</span></code> — выходное (преобразованное) изображение <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flipCode</span></code> — код отражения:
- <code class="docutils literal notranslate"><span class="pre">0</span></code> — вертикальное отражение
- <code class="docutils literal notranslate"><span class="pre">1</span></code> — горизонтальное отражение
- <code class="docutils literal notranslate"><span class="pre">-1</span></code> — обе стороны</p></li>
</ul>
<p><strong>return</strong> — код результата работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> — успех,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> — пустое изображение,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> — неизвестный формат изображения,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> — неизвестная ошибка.</p></li>
</ul>
</section>
<section id="id16">
<h2>Функция аугментации изображений<a class="headerlink" href="#id16" title="Link to this heading"></a></h2>
<p><em>Выполняет аугментацию набора входных изображений с использованием заданных методов и сохраняет результаты в директорию.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">augmetation</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">inputImagesAugmetation</span><span class="p">,</span>
<span class="w">                      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">outputImagesAugmetation</span><span class="p">,</span>
<span class="w">                      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">&gt;</span><span class="w"> </span><span class="n">augmetationMethod</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание параметров:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inputImagesAugmetation</span></code> — вектор входных изображений (<code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>) для аугментации.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outputImagesAugmetation</span></code> — вектор, в который сохраняются преобразованные изображения.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">augmetationMethod</span></code> — вектор методов аугментации <code class="docutils literal notranslate"><span class="pre">mrcv::AUGMENTATION_METHOD</span></code>.</p></li>
</ul>
<p><strong>return</strong> — код результата работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> — успех,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> — исключение (OpenCV или файловой системы, или неизвестная ошибка).</p></li>
</ul>
</section>
<section id="id17">
<h2>Поддерживаемые методы аугментации:<a class="headerlink" href="#id17" title="Link to this heading"></a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AUGMENTATION_METHOD</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">NONE</span><span class="p">,</span>
<span class="w">    </span><span class="n">FLIP_HORIZONTAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FLIP_VERTICAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">FLIP_HORIZONTAL_AND_VERTICAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">ROTATE_IMAGE_90</span><span class="p">,</span>
<span class="w">    </span><span class="n">ROTATE_IMAGE_45</span><span class="p">,</span>
<span class="w">    </span><span class="n">ROTATE_IMAGE_270</span><span class="p">,</span>
<span class="w">    </span><span class="n">ROTATE_IMAGE_315</span><span class="p">,</span>
<span class="w">    </span><span class="n">TEST</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Каждому из методов соответствует операция трансформации изображения с возможностью сохранения результата на диск.</p>
</section>
</section>
<section id="id18">
<h1>Модуль кластеризации<a class="headerlink" href="#id18" title="Link to this heading"></a></h1>
<p><em>В данном модуле реализованы алгоритмы кластеризации 3D-точек, полученных из данных стереокамер. Модуль основан на расчёте евклидовых расстояний между точками и оценке их взаимной близости.</em></p>
<section id="id19">
<h2>Загрузка данных из файла<a class="headerlink" href="#id19" title="Link to this heading"></a></h2>
<p><em>Загружает координаты 3D-точек из текстового файла и сохраняет их во внутреннюю структуру данных.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">DenseStereo</span><span class="o">::</span><span class="n">loadDataFromFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong>
- <code class="docutils literal notranslate"><span class="pre">filename</span></code> — путь к текстовому файлу с координатами.</p>
<p><strong>Назначение:</strong> очищает внутренние данные и заполняет список <code class="docutils literal notranslate"><span class="pre">xyz</span></code> из файла.</p>
</section>
<section id="id20">
<h2>Кластеризация загруженных данных<a class="headerlink" href="#id20" title="Link to this heading"></a></h2>
<p><em>Выполняет кластеризацию точек в 3D пространстве на основе расстояний между ними.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">DenseStereo</span><span class="o">::</span><span class="n">makeClustering</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Назначение:</strong>
- рассчитывает матрицу расстояний между всеми точками,
- нормализует расстояния,
- формирует логическую матрицу близости <code class="docutils literal notranslate"><span class="pre">L</span></code>,
- группирует точки в кластеры,
- присваивает каждой точке индекс её кластера,
- сохраняет результат в файл <code class="docutils literal notranslate"><span class="pre">files/clusters_data.txt</span></code>.</p>
<p><strong>Внутренние параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">IDX</span></code> — вектор, содержащий индексы кластеров для каждой точки.</p>
<p><strong>Промежуточные структуры:</strong> используются многопоточность, нормализация, логические маски.</p>
</section>
<section id="id21">
<h2>Печать информации о кластерах<a class="headerlink" href="#id21" title="Link to this heading"></a></h2>
<p><em>Формирует и записывает в лог информацию о результатах кластеризации.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">DenseStereo</span><span class="o">::</span><span class="n">printClusters</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Назначение:</strong>
- выводит количество точек и количество найденных кластеров в лог.</p>
<p><strong>Тип логирования:</strong>
- <code class="docutils literal notranslate"><span class="pre">LOGTYPE::INFO</span></code></p>
<p>Для хранения результата кластеризации используются поля класса:
- <code class="docutils literal notranslate"><span class="pre">IDX</span></code> — список принадлежности точек к кластерам,
- <code class="docutils literal notranslate"><span class="pre">vuxyzrgb.xyz</span></code> — координаты исходных точек.</p>
</section>
</section>
<section id="id22">
<h1>Модуль сравнения изображений<a class="headerlink" href="#id22" title="Link to this heading"></a></h1>
<p><em>Модуль предназначен для сравнения двух изображений с использованием различных методов. Поддерживаются два режима: сравнение по HSV-гистограммам и по L2-норме между изображениями.</em></p>
<section id="id23">
<h2>Сравнение изображений<a class="headerlink" href="#id23" title="Link to this heading"></a></h2>
<p><em>Выполняет сравнение двух изображений с помощью выбранного метода и возвращает степень их различия.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">compareImages</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">img1</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">img2</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">methodCompare</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">img1</span></code> — первое входное изображение (cv::Mat).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img2</span></code> — второе входное изображение (cv::Mat).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">methodCompare</span></code> — флаг выбора метода сравнения:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> — сравнение по HSV-гистограммам,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> — сравнение по L2-норме.</p></li>
</ul>
<p><strong>Назначение:</strong></p>
<ul class="simple">
<li><p>При <code class="docutils literal notranslate"><span class="pre">methodCompare</span> <span class="pre">==</span> <span class="pre">true</span></code>:
- переводит изображения в цветовое пространство HSV,
- вычисляет 2D-гистограммы по каналам Hue и Saturation,
- нормализует гистограммы и сравнивает их методом корреляции (HISTCMP_CORREL).</p></li>
<li><p>При <code class="docutils literal notranslate"><span class="pre">methodCompare</span> <span class="pre">==</span> <span class="pre">false</span></code>:
- вычисляет евклидово расстояние (L2-норма) между изображениями,
- нормализует результат по количеству пикселей.</p></li>
</ul>
<p><strong>Возвращаемое значение:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">double</span></code> — степень схожести изображений:
- при HSV-сравнении: значение корреляции (в диапазоне от -1 до 1),
- при L2-сравнении: значение от <code class="docutils literal notranslate"><span class="pre">0</span></code> (максимальное различие) до <code class="docutils literal notranslate"><span class="pre">1</span></code> (идентичность).</p></li>
</ul>
<p><strong>Промежуточные структуры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hsv1</span></code>, <code class="docutils literal notranslate"><span class="pre">hsv2</span></code> — изображения в HSV-пространстве,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hist1</span></code>, <code class="docutils literal notranslate"><span class="pre">hist2</span></code> — рассчитанные гистограммы для сравнения.</p></li>
</ul>
</section>
</section>
<section id="id24">
<h1>Модуль детекции изображений<a class="headerlink" href="#id24" title="Link to this heading"></a></h1>
<p><em>Модуль реализует полную архитектуру сверточной нейронной сети YOLO для задач детекции объектов. Предусмотрены функции обучения, валидации, предсказания, загрузки весов, работы с аннотациями, подготовки датасета, и визуализации результатов.</em></p>
<section id="id25">
<h2>Инициализация детектора<a class="headerlink" href="#id25" title="Link to this heading"></a></h2>
<p><em>Задает параметры устройства, загружает список меток и подготавливает модель для работы.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="o">::</span><span class="n">Initialize</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">gpuID</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">nameListPath</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gpuID</span></code> — индекс устройства GPU (-1 — использовать CPU).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> — ширина входного изображения (должна быть кратна 32).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height</span></code> — высота входного изображения (должна быть кратна 32).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nameListPath</span></code> — путь к файлу с названиями классов.</p></li>
</ul>
<p><strong>Назначение:</strong> загружает имена классов, настраивает вычислительное устройство и инициализирует модель <code class="docutils literal notranslate"><span class="pre">YoloBody_tiny</span></code>.</p>
</section>
<section id="id26">
<h2>Загрузка предобученной модели<a class="headerlink" href="#id26" title="Link to this heading"></a></h2>
<p><em>Загружает веса модели из заданного файла.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="o">::</span><span class="n">LoadPretrained</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pretrainedPath</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Назначение:</strong> частично загружает веса, исключая выходные слои <code class="docutils literal notranslate"><span class="pre">yolo_head</span></code>, и копирует параметры в текущую модель.</p>
</section>
<section id="id27">
<h2>Обучение модели<a class="headerlink" href="#id27" title="Link to this heading"></a></h2>
<p><em>Обучает модель на обучающем датасете.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="o">::</span><span class="n">Train</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">trainValPath</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">imageType</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">int</span><span class="w"> </span><span class="n">numEpochs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">batchSize</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">learningRate</span><span class="p">,</span>
<span class="w">                          </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">savePath</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pretrainedPath</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Назначение:</strong></p>
<ul class="simple">
<li><p>загружает датасет в формате XML,</p></li>
<li><p>запускает цикл обучения и валидации,</p></li>
<li><p>на каждом этапе сохраняет веса модели в <code class="docutils literal notranslate"><span class="pre">savePath</span></code>,</p></li>
<li><p>использует функции потерь <code class="docutils literal notranslate"><span class="pre">YOLOLossImpl</span></code>.</p></li>
</ul>
<p><strong>Внутренние зависимости:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DetDataset</span></code> — загрузка и предобработка данных,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YOLOLossImpl</span></code> — расчёт функции потерь,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YoloBody_tiny</span></code> — модель YOLO.</p></li>
</ul>
</section>
<section id="id28">
<h2>Автоматический подбор гиперпараметров<a class="headerlink" href="#id28" title="Link to this heading"></a></h2>
<p><em>Выполняет автоматический перебор комбинаций параметров обучения и выбирает наилучшие.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="o">::</span><span class="n">AutoTrain</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">trainValPath</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">imageType</span><span class="p">,</span>
<span class="w">                              </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">epochsList</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">batchSizes</span><span class="p">,</span>
<span class="w">                              </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">learningRates</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pretrainedPath</span><span class="p">,</span>
<span class="w">                              </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">savePath</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Назначение:</strong> выбирает комбинацию <code class="docutils literal notranslate"><span class="pre">epochs</span></code>, <code class="docutils literal notranslate"><span class="pre">batchSize</span></code> и <code class="docutils literal notranslate"><span class="pre">learningRate</span></code> с минимальной ошибкой на валидации.</p>
</section>
<section id="id29">
<h2>Предсказание и визуализация<a class="headerlink" href="#id29" title="Link to this heading"></a></h2>
<p><em>Выполняет предсказание объектов на изображении и сохраняет визуализацию.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="o">::</span><span class="n">Predict</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">show</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">confThresh</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">nmsThresh</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Назначение:</strong></p>
<ul class="simple">
<li><p>выполняет предсказание с использованием модели,</p></li>
<li><p>масштабирует результат обратно к исходному изображению,</p></li>
<li><p>применяет NMS (Non-Maximum Suppression),</p></li>
<li><p>отображает или сохраняет результат визуализации (файл <code class="docutils literal notranslate"><span class="pre">prediction.jpg</span></code>).</p></li>
</ul>
<p><strong>Тип логирования:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LOGTYPE::INFO</span></code> при успешной обработке,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOGTYPE::ERROR</span></code> при ошибках устройства, путей и пр.</p></li>
</ul>
<p><strong>Промежуточные функции:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DecodeBox</span></code> — расшифровка выхода YOLO,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nonMaximumSuppression</span></code> — удаление пересекающихся боксов,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">showBbox</span></code> — отображение результатов детекции.</p></li>
</ul>
<section id="id30">
<h3>Валидация модели<a class="headerlink" href="#id30" title="Link to this heading"></a></h3>
<p><em>Оценивает модель на отложенном датасете и возвращает среднюю ошибку.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="o">::</span><span class="n">Validate</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">valDataPath</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">imageType</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">batchSize</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Назначение:</strong> используется при автоматическом подборе гиперпараметров и в процессе отладки модели.</p>
</section>
</section>
</section>
<section id="id31">
<h1>Модуль предварительной обработки изображений<a class="headerlink" href="#id31" title="Link to this heading"></a></h1>
<p><em>Данный модуль содержит функции для предварительной обработки изображений, включая коррекцию яркости, контраста, резкости, фильтрацию шумов и геометрическую коррекцию.</em></p>
<section id="id32">
<h2>Функция создания изображения с сообщением об ошибке<a class="headerlink" href="#id32" title="Link to this heading"></a></h2>
<p><em>Создаёт изображение с текстом ошибки для отображения при возникновении проблем.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">getErrorImage</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">textError</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">textError</span></code> - текст сообщения об ошибке.</p></li>
</ul>
<p><strong>Возвращаемое значение:</strong>
- Изображение размером 600x960 с текстом ошибки.</p>
</section>
<section id="id33">
<h2>Коррекция яркости изображения<a class="headerlink" href="#id33" title="Link to this heading"></a></h2>
<p><em>Применяет гамма-коррекцию для изменения яркости изображения.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">changeImageBrightness</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gamma</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">imageInput</span></code> - входное изображение.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageOutput</span></code> - выходное изображение после коррекции.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gamma</span></code> - параметр гамма-коррекции (значения &lt;1 увеличивают яркость, &gt;1 уменьшают).</p></li>
</ul>
<p><strong>Возвращаемые коды:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - успешное выполнение</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - пустое входное изображение</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> - необработанное исключение</p></li>
</ul>
</section>
<section id="id34">
<h2>Увеличение резкости (метод Лапласа)<a class="headerlink" href="#id34" title="Link to this heading"></a></h2>
<p><em>Увеличивает резкость изображения с использованием оператора Лапласа.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">sharpeningImage01</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gainFactorHighFrequencyComponent</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gainFactorHighFrequencyComponent</span></code> - коэффициент усиления высокочастотных компонент.</p></li>
</ul>
<p><strong>Возвращаемые коды:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - успешное выполнение</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - пустое входное изображение</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> - необработанное исключение</p></li>
</ul>
</section>
<section id="id35">
<h2>Увеличение резкости (метод Гаусса)<a class="headerlink" href="#id35" title="Link to this heading"></a></h2>
<p><em>Увеличивает резкость изображения с использованием размытия по Гауссу.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">sharpeningImage02</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="w"> </span><span class="n">filterSize</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sigmaFilter</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gainFactorHighFrequencyComponent</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">filterSize</span></code> - размер ядра фильтра.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigmaFilter</span></code> - параметр размытия.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gainFactorHighFrequencyComponent</span></code> - коэффициент усиления высокочастотных компонент.</p></li>
</ul>
</section>
<section id="id36">
<h2>Основная функция предварительной обработки<a class="headerlink" href="#id36" title="Link to this heading"></a></h2>
<p><em>Применяет последовательность методов обработки к изображению согласно переданному списку.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">preprocessingImage</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">&gt;</span><span class="w"> </span><span class="n">metodImagePerProcessing</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pathToFileCameraParametrs</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Поддерживаемые методы обработки:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONVERTING_BGR_TO_GRAY</span></code> - преобразование в градации серого</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BRIGHTNESS_LEVEL_UP/DOWN</span></code> - коррекция яркости</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BALANCE_CONTRAST_*</span></code> - различные методы коррекции контраста</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHARPENING_*</span></code> - методы увеличения резкости</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NOISE_FILTERING_*</span></code> - методы фильтрации шумов</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORRECTION_GEOMETRIC_DEFORMATION</span></code> - геометрическая коррекция</p></li>
</ul>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metodImagePerProcessing</span></code> - вектор методов обработки для применения.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathToFileCameraParametrs</span></code> - путь к файлу параметров камеры для геометрической коррекции.</p></li>
</ul>
</section>
<section id="id37">
<h2>Увеличение контраста изображения<a class="headerlink" href="#id37" title="Link to this heading"></a></h2>
<p><em>Применяет различные методы увеличения контраста в разных цветовых пространствах.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">increaseImageContrast</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_INCREASE_IMAGE_CONTRAST</span><span class="w"> </span><span class="n">metodIncreaseContrast</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">COLOR_MODEL</span><span class="w"> </span><span class="n">colorSpace</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">clipLimitCLAHE</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="w"> </span><span class="n">gridSizeCLAHE</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">percentContrastBalance</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mContrastExtantion</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">eContrastExtantion</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Поддерживаемые методы:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">EQUALIZE_HIST</span></code> - эквализация гистограммы</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CLAHE</span></code> - адаптивная эквализация гистограммы</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONTRAST_BALANCING</span></code> - балансировка контраста</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONTRAST_EXTENSION</span></code> - расширение контраста</p></li>
</ul>
<p><strong>Поддерживаемые цветовые пространства:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CM_HSV</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CM_LAB</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CM_YCBCR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CM_RGB</span></code></p></li>
</ul>
</section>
<section id="id38">
<h2>Балансировка контраста<a class="headerlink" href="#id38" title="Link to this heading"></a></h2>
<p><em>Выполняет балансировку контраста изображения по заданному проценту.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">contrastBalancing</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">planeArray</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">percent</span></code> - процент обрезки гистограммы (0-100).</p></li>
</ul>
</section>
<section id="id39">
<h2>Расширение контраста<a class="headerlink" href="#id39" title="Link to this heading"></a></h2>
<p><em>Применяет нелинейное преобразование для расширения динамического диапазона.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">contrastExtantion</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">planeArray</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">m</span></code> - среднее значение (если &lt;0, вычисляется автоматически)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code> - параметр экспоненты</p></li>
</ul>
</section>
</section>
<section id="id40">
<h1>Модуль морфологических преобразований<a class="headerlink" href="#id40" title="Link to this heading"></a></h1>
<p><em>Данный модуль содержит функции для выполнения морфологических операций над изображениями, включая открытие, закрытие, эрозию, расширение и градиент.</em></p>
<section id="id41">
<h2>Основная функция морфологических преобразований<a class="headerlink" href="#id41" title="Link to this heading"></a></h2>
<p><em>Применяет выбранную морфологическую операцию к изображению.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">morphologyImage</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_MORF</span><span class="w"> </span><span class="n">metod</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">morph_size</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">image</span></code> - входное изображение для обработки</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> - путь для сохранения результата</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metod</span></code> - тип морфологической операции:
- <code class="docutils literal notranslate"><span class="pre">OPEN</span></code> - открытие
- <code class="docutils literal notranslate"><span class="pre">CLOSE</span></code> - закрытие
- <code class="docutils literal notranslate"><span class="pre">DILAT</span></code> - расширение
- <code class="docutils literal notranslate"><span class="pre">ERODE</span></code> - эрозия
- <code class="docutils literal notranslate"><span class="pre">GRADIENT</span></code> - градиент</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">morph_size</span></code> - размер структурного элемента</p></li>
</ul>
<p><strong>Возвращаемое значение:</strong>
- 0 - успешное выполнение</p>
</section>
<section id="id42">
<h2>Функция морфологического открытия<a class="headerlink" href="#id42" title="Link to this heading"></a></h2>
<p><em>Выполняет операцию открытия (эрозия с последующим расширением).</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">openingMorphological</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Описание параметров:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">element</span></code> - структурный элемент для операции</p></li>
</ul>
</section>
<section id="id43">
<h2>Функция морфологического закрытия<a class="headerlink" href="#id43" title="Link to this heading"></a></h2>
<p><em>Выполняет операцию закрытия (расширение с последующей эрозией).</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">closingMorphological</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id44">
<h2>Функция морфологического градиента<a class="headerlink" href="#id44" title="Link to this heading"></a></h2>
<p><em>Выполняет операцию морфологического градиента (разница между расширением и эрозией).</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">gradientMorphological</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id45">
<h2>Функция морфологической эрозии<a class="headerlink" href="#id45" title="Link to this heading"></a></h2>
<p><em>Выполняет операцию эрозии (сужение светлых областей).</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">erodeMorphological</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id46">
<h2>Функция морфологического расширения<a class="headerlink" href="#id46" title="Link to this heading"></a></h2>
<p><em>Выполняет операцию расширения (расширение светлых областей).</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">dilationMorphological</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
<p>Все функции:</p>
<ol class="arabic simple">
<li><p>Создают структурный элемент заданного размера</p></li>
<li><p>Применяют соответствующую морфологическую операцию</p></li>
<li><p>Сохраняют результат по указанному пути</p></li>
<li><p>Возвращают 0 при успешном выполнении</p></li>
</ol>
<p><strong>Типы структурных элементов:</strong></p>
<ul class="simple">
<li><p>Используется прямоугольный элемент (MORPH_RECT)</p></li>
<li><p>Размер элемента вычисляется как 2*morph_size + 1</p></li>
</ul>
</section>
</section>
<section id="id47">
<h1>Модуль расчета курса объекта<a class="headerlink" href="#id47" title="Link to this heading"></a></h1>
<p><em>Данный модуль реализует функционал для детекции объектов и расчета курса движения относительно обнаруженных целей с использованием нейронных сетей.</em></p>
<section id="objcourse">
<h2>Класс ObjCourse<a class="headerlink" href="#objcourse" title="Link to this heading"></a></h2>
<p><strong>Основные функции:</strong></p>
</section>
<section id="id48">
<h2>Инициализация нейронной сети<a class="headerlink" href="#id48" title="Link to this heading"></a></h2>
<p><em>Загружает модель нейронной сети и файл с классами объектов.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">ObjCourse</span><span class="o">::</span><span class="n">initNN</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathToModel</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathToClasses</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">pathToModel</span></code> - путь к файлу модели ONNX
- <code class="docutils literal notranslate"><span class="pre">pathToClasses</span></code> - путь к файлу с классами объектов</p>
<p><strong>Возвращаемые значения:</strong>
- 0 - успешная инициализация
- ENETDOWN - ошибка загрузки модели
- ENOENT - ошибка загрузки файла классов</p>
</section>
<section id="id49">
<h2>Основной процесс обработки<a class="headerlink" href="#id49" title="Link to this heading"></a></h2>
<p><em>Выполняет полный цикл обработки изображения: предобработку, детекцию и постобработку.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">ObjCourse</span><span class="o">::</span><span class="n">mainProcess</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Возвращаемое значение:</strong>
- Обработанное изображение с отмеченными объектами</p>
</section>
<section id="id50">
<h2>Расчет курса<a class="headerlink" href="#id50" title="Link to this heading"></a></h2>
<p><em>Определяет угол между центром кадра и обнаруженным объектом.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">ObjCourse</span><span class="o">::</span><span class="n">getObjectCourse</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">frameWidth</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">cameraAngle</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">frame</span></code> - входное изображение
- <code class="docutils literal notranslate"><span class="pre">frameWidth</span></code> - ширина кадра
- <code class="docutils literal notranslate"><span class="pre">cameraAngle</span></code> - угол обзора камеры</p>
<p><strong>Возвращаемое значение:</strong>
- Угол отклонения объекта от центра (в градусах)</p>
<p><strong>Вспомогательные функции:</strong></p>
</section>
<section id="id51">
<h2>Предобработка изображения<a class="headerlink" href="#id51" title="Link to this heading"></a></h2>
<p><em>Подготавливает изображение для подачи в нейронную сеть.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ObjCourse</span><span class="o">::</span><span class="n">preProcess</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">dnn</span><span class="o">::</span><span class="n">Net</span><span class="o">&amp;</span><span class="w"> </span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id52">
<h2>Постобработка результатов<a class="headerlink" href="#id52" title="Link to this heading"></a></h2>
<p><em>Анализирует выход нейронной сети и выделяет обнаруженные объекты.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">ObjCourse</span><span class="o">::</span><span class="n">postProcess</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">outputs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">classNames</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id53">
<h2>Отрисовка меток<a class="headerlink" href="#id53" title="Link to this heading"></a></h2>
<p><em>Добавляет подписи к обнаруженным объектам на изображении.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">ObjCourse</span><span class="o">::</span><span class="n">drawLabel</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">top</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Технические параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_inputWidth</span></code>, <code class="docutils literal notranslate"><span class="pre">_inputHeight</span></code> - размеры входного изображения для нейросети</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_scoreThreshold</span></code> - порог уверенности для детекции</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_nmsThreshold</span></code> - порог для подавления немаксимумов</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_confidenceThreshold</span></code> - минимальный уровень достоверности</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_cameraAngle</span></code> - угол обзора камеры</p></li>
</ul>
</section>
</section>
<section id="id54">
<h1>Модуль сегментации изображений<a class="headerlink" href="#id54" title="Link to this heading"></a></h1>
<p><em>Модуль реализует функционал семантической сегментации изображений с использованием архитектуры FPN (Feature Pyramid Network) на базе предобученных моделей ResNet.</em></p>
<section id="fpn">
<h2>Архитектура FPN<a class="headerlink" href="#fpn" title="Link to this heading"></a></h2>
<p><strong>FPNImpl</strong> - основной класс, реализующий архитектуру Feature Pyramid Network.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FPNImpl</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">nn</span><span class="o">::</span><span class="n">Module</span>
</pre></div>
</div>
<p><strong>Компоненты:</strong>
- Энкодер (ResNet) для извлечения признаков
- Декодер для построения пирамиды признаков
- Голова сегментации для генерации масок</p>
<p><strong>Инициализация:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FPNImpl</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">_numberClasses</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">encoderName</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pretrainedPath</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">encoderDepth</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">decoderChannelPyramid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">decoderChannelsSegmentation</span><span class="p">,</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">decoderMergePolicy</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">decoder_dropout</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">upsampling</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">_numberClasses</span></code> - количество классов сегментации
- <code class="docutils literal notranslate"><span class="pre">encoderName</span></code> - имя модели энкодера (resnet18, resnet34, resnet50)
- <code class="docutils literal notranslate"><span class="pre">pretrainedPath</span></code> - путь к предобученным весам
- <code class="docutils literal notranslate"><span class="pre">encoderDepth</span></code> - глубина энкодера (3-5)</p>
</section>
<section id="segmentor">
<h2>Класс Segmentor<a class="headerlink" href="#segmentor" title="Link to this heading"></a></h2>
<p><strong>Основной интерфейс для работы с сегментацией:</strong></p>
<p><strong>Инициализация</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">Segmentor</span><span class="o">::</span><span class="n">Initialize</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">gpu_id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_height</span><span class="p">,</span>
<span class="w">                         </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;&amp;</span><span class="w"> </span><span class="n">_listName</span><span class="p">,</span>
<span class="w">                         </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">encoderName</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pretrainedPath</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">gpu_id</span></code> - идентификатор GPU (-1 для CPU)
- <code class="docutils literal notranslate"><span class="pre">_width</span></code>, <code class="docutils literal notranslate"><span class="pre">_height</span></code> - размеры входного изображения
- <code class="docutils literal notranslate"><span class="pre">_listName</span></code> - список классов сегментации
- <code class="docutils literal notranslate"><span class="pre">encoderName</span></code> - имя модели энкодера
- <code class="docutils literal notranslate"><span class="pre">pretrainedPath</span></code> - путь к предобученным весам</p>
<p><strong>Обучение модели</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">Segmentor</span><span class="o">::</span><span class="n">Train</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">learning_rate</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">epochs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">batch_size</span><span class="p">,</span>
<span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">train_val_path</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">imageType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">save_path</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры обучения:</strong>
- <code class="docutils literal notranslate"><span class="pre">learning_rate</span></code> - начальная скорость обучения
- <code class="docutils literal notranslate"><span class="pre">epochs</span></code> - количество эпох
- <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> - размер батча
- <code class="docutils literal notranslate"><span class="pre">train_val_path</span></code> - путь к данным обучения/валидации
- <code class="docutils literal notranslate"><span class="pre">imageType</span></code> - расширение изображений (“.jpg”, “.png”)
- <code class="docutils literal notranslate"><span class="pre">save_path</span></code> - путь для сохранения модели</p>
<p><strong>Загрузка весов</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">Segmentor</span><span class="o">::</span><span class="n">LoadWeight</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathWeight</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Предсказание</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">Segmentor</span><span class="o">::</span><span class="n">Predict</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">which_class</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong>
- <code class="docutils literal notranslate"><span class="pre">image</span></code> - входное изображение
- <code class="docutils literal notranslate"><span class="pre">which_class</span></code> - имя класса для визуализации</p>
</section>
<section id="id55">
<h2>Вспомогательные классы<a class="headerlink" href="#id55" title="Link to this heading"></a></h2>
<p><strong>SegDataset</strong>
<em>Класс для работы с данными сегментации</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SegDataset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">data</span><span class="o">::</span><span class="n">Dataset</span><span class="o">&lt;</span><span class="n">SegDataset</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Функционал:</strong>
- Загрузка изображений и масок
- Аугментация данных
- Преобразование в тензоры</p>
<p><strong>Augmentations</strong></p>
<p><em>Класс для аугментации данных</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Augmentations</span>
</pre></div>
</div>
<p><strong>Методы:</strong>
- <code class="docutils literal notranslate"><span class="pre">Resize</span></code> - изменение размера изображения и маски</p>
</section>
<section id="id56">
<h2>Функции потерь<a class="headerlink" href="#id56" title="Link to this heading"></a></h2>
<p><strong>DiceLoss</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">DiceLoss</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">prediction</span><span class="p">,</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">classNum</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>CELoss</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">CELoss</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">prediction</span><span class="p">,</span><span class="w"> </span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="d">
<h1>Модуль создания 3D сцен<a class="headerlink" href="#d" title="Link to this heading"></a></h1>
<p><em>Модуль предоставляет функционал для обработки стереоизображений, построения 3D сцен и работы с облаками точек. Включает методы калибровки, построения карт диспаратности, сегментации объектов и визуализации.</em></p>
<section id="id57">
<h2>Формирование стереопары<a class="headerlink" href="#id57" title="Link to this heading"></a></h2>
<p><em>Объединяет изображения с двух камер в единое изображение для обработки.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">makingStereoPair</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inputImageCamera01</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inputImageCamera02</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">outputStereoPair</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inputImageCamera01</span></code> - изображение с левой камеры (CV_8UC3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inputImageCamera02</span></code> - изображение с правой камеры (CV_8UC3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outputStereoPair</span></code> - результирующее объединенное изображение</p></li>
</ul>
<p><strong>Возвращаемые значения:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - успех</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - пустое изображение</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> - ошибка</p></li>
</ul>
<p><strong>Особенности:</strong></p>
<ul class="simple">
<li><p>Автоматический расчет размеров выходного изображения</p></li>
<li><p>Горизонтальное объединение изображений</p></li>
<li><p>Поддержка разных размеров входных изображений</p></li>
</ul>
</section>
<section id="id58">
<h2>Построение карты диспаратности<a class="headerlink" href="#id58" title="Link to this heading"></a></h2>
<p><em>Вычисляет карту различий между стереоизображениями.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">find3dPointsADS</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inputImageCamera01</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inputImageCamera02</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">pointsData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">points3D</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">settingsMetodDisparity</span><span class="o">&amp;</span><span class="w"> </span><span class="n">settingsMetodDisparity</span><span class="p">,</span>
<span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">disparityMap</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">cameraStereoParameters</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cameraParameters</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">limitOutPoints</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">limitsOutlierArea</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Методы построения:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MODE_BM</span></code> - блочное сопоставление (быстрый)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MODE_SGBM</span></code> - полуглобальное сопоставление</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MODE_HH</span></code> - двухпроходный алгоритм</p></li>
</ul>
<p><strong>Особенности:</strong></p>
<ul class="simple">
<li><p>Фильтрация выбросов по заданной области</p></li>
<li><p>Ограничение количества выходных точек</p></li>
<li><p>Поддержка различных цветовых карт</p></li>
</ul>
</section>
<section id="id59">
<h2>Сегментация объектов<a class="headerlink" href="#id59" title="Link to this heading"></a></h2>
<p><em>Обнаружение и сегментация объектов нейронной сетью.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">detectingSegmentsNeuralNet</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageInput</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">imageOutput</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">replyMasks</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filePathToModelYoloNeuralNet</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filePathToClasses</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Особенности:</strong></p>
<ul class="simple">
<li><p>Использование модели YOLO</p></li>
<li><p>Возврат бинарных масок объектов</p></li>
<li><p>Настройка порогов уверенности</p></li>
<li><p>Морфологическая постобработка масок</p></li>
</ul>
</section>
<section id="id60">
<h2>Визуализация 3D сцены<a class="headerlink" href="#id60" title="Link to this heading"></a></h2>
<p><em>Проецирование 3D точек на 2D изображение.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">getImage3dSceene</span><span class="p">(</span><span class="n">mrcv</span><span class="o">::</span><span class="n">pointsData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">points3D</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">parameters3dSceene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">parameters3dSceene</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">cameraStereoParameters</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cameraParameters</span><span class="p">,</span>
<span class="w">    </span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">outputImage3dSceene</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры сцены:</strong></p>
<ul class="simple">
<li><p>Углы поворота (angX/Y/Z)</p></li>
<li><p>Смещение (tX/Y/Z)</p></li>
<li><p>Масштаб (scale)</p></li>
<li><p>Расстояние до центра (dZ)</p></li>
</ul>
</section>
<section id="id61">
<h2>Сохранение результатов<a class="headerlink" href="#id61" title="Link to this heading"></a></h2>
<p><em>Экспорт данных о 3D точках.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">saveInFile3dPointsInObjectsSegments</span><span class="p">(</span><span class="n">pointsData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">points3D</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="w"> </span><span class="n">pathToFile</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Формат данных:</strong></p>
<ul class="simple">
<li><p>Координаты пикселей и 3D координаты</p></li>
<li><p>Цвет точек</p></li>
<li><p>Идентификаторы сегментов</p></li>
</ul>
</section>
</section>
<section id="yolov5">
<h1>Модуль работы с YOLOv5<a class="headerlink" href="#yolov5" title="Link to this heading"></a></h1>
<p><em>Модуль предоставляет инструменты для работы с моделями YOLOv5, включая интерактивную разметку данных, генерацию конфигурационных файлов и настройку гиперпараметров.</em></p>
<section id="id62">
<h2>Интерактивная разметка данных<a class="headerlink" href="#id62" title="Link to this heading"></a></h2>
<p><em>Инструмент для создания разметки объектов на изображениях в формате YOLO.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5LabelerProcessing</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">inputDir</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">outputDir</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inputDir</span></code> - путь к директории с исходными изображениями</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outputDir</span></code> - путь для сохранения файлов разметки</p></li>
</ul>
<p><strong>Функционал:</strong></p>
<ul class="simple">
<li><p>Поддержка форматов JPG и PNG</p></li>
<li><p>Интерактивный интерфейс с возможностью:
- Рисования bounding box’ов
- Редактирования существующих рамок
- Изменения класса объектов
- Удаления ошибочных разметок</p></li>
<li><p>Автоматическое сохранение в YOLO-формате (нормализованные координаты)</p></li>
</ul>
</section>
<section id="id63">
<h2>Генерация конфигурации модели<a class="headerlink" href="#id63" title="Link to this heading"></a></h2>
<p><em>Создание конфигурационного файла модели YOLOv5 в формате YAML.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5GenerateConfig</span><span class="p">(</span><span class="n">YOLOv5Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">outputFile</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Поддерживаемые модели:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">YOLOv5n</span></code> - nano (наименьшая)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YOLOv5s</span></code> - small</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YOLOv5m</span></code> - medium</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YOLOv5l</span></code> - large</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YOLOv5x</span></code> - extra large</p></li>
</ul>
<p><strong>Содержимое конфига:</strong></p>
<ul class="simple">
<li><p>Параметры масштабирования (depth/width multiple)</p></li>
<li><p>Якорные рамки (anchors)</p></li>
<li><p>Архитектура backbone и head сети</p></li>
<li><p>Количество классов (nc)</p></li>
</ul>
</section>
<section id="id64">
<h2>Генерация гиперпараметров<a class="headerlink" href="#id64" title="Link to this heading"></a></h2>
<p><em>Создание файла с оптимальными гиперпараметрами для обучения.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5GenerateHyperparameters</span><span class="p">(</span><span class="n">YOLOv5Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">imgWidth</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">imgHeight</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">outputFile</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Настраиваемые параметры:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">weight_decay</span></code> - коэффициент регуляризации</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">box/cls/obj</span></code> - веса для разных компонентов loss-функции</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anchor_t</span></code> - порог для якорных рамок</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fl_gamma</span></code> - параметр focal loss</p></li>
</ul>
<p><strong>Особенности:</strong></p>
<ul class="simple">
<li><p>Автоматическая адаптация под:
- Размер модели
- Разрешение изображений
- Количество классов</p></li>
<li><p>Сохранение в YAML-формате</p></li>
</ul>
</section>
</section>
<section id="id65">
<h1>Подготовка к работе<a class="headerlink" href="#id65" title="Link to this heading"></a></h1>
<section id="id66">
<h2>Установка и настройка зависимостей<a class="headerlink" href="#id66" title="Link to this heading"></a></h2>
<p>Для работы с библиотекой используется версия <em>OpenCV 4.10</em>, которая должна быть предварительно собрана и установлена на исполняемой платформе с операционными системами Windows или Linux. Для поддержки CUDA сборка OpenCV должна проводиться с установленными <em>CUDA 12.4</em> и <em>cuDNN 9.3</em>. Для сборки должна быть использована версия <em>CMake</em> не ниже 3.14. Также для работы с библиотекой требуется <em>libtorch 2.4.0</em>. При этом сборка с CUDA или без определяется установочным пакетом от разработчиков <em>libtorch</em>.</p>
</section>
<section id="id67">
<h2>Установка и первоначальная настройка библиотеки<a class="headerlink" href="#id67" title="Link to this heading"></a></h2>
<section id="windows-cuda">
<h3>Для операционной системы Windows без поддержки CUDA<a class="headerlink" href="#windows-cuda" title="Link to this heading"></a></h3>
<p>Необходимо выполнить следующий ряд действий:</p>
<ul>
<li><p>Установить необходимые компоненты:</p>
<ol class="arabic">
<li><p>CMake GUI 3.30.0-rc4 или новее с официального сайта (доступен по ссылке <a class="reference external" href="https://cmake.org/download/">https://cmake.org/download/</a>)</p></li>
<li><p>Git Bash (доступен по ссылке <a class="reference external" href="https://gitforwindows.org/">https://gitforwindows.org/</a>)</p></li>
<li><p>Visual Studio 2022 Community Edition с компонентом <strong>Desktop development with C++</strong> (доступен по ссылке <a class="reference external" href="https://visualstudio.microsoft.com/">https://visualstudio.microsoft.com/</a>)</p></li>
<li><p>yaml-cpp при помощи консольных инструкций:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\</span>
<span class="go">git clone https://github.com/jbeder/yaml-cpp.git</span>
<span class="go">cd yaml-cpp</span>
<span class="go">mkdir build</span>
<span class="go">cd build</span>
<span class="go">cmake .. -DYAML_CPP_BUILD_TESTS=OFF -DYAML_CPP_INSTALL=ON</span>
<span class="go">cmake --build . --config Release</span>
<span class="go">cmake --install . --prefix &quot;C:\yaml-cpp&quot;</span>
</pre></div>
</div>
</li>
<li><p>LibTorch 2.4.0 без поддержки CUDA
(<a class="reference external" href="https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-2.4.0%2Bcpu.zip">https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-2.4.0%2Bcpu.zip</a>). После скачивания архива распакуйте его содержимое в папку <code class="docutils literal notranslate"><span class="pre">C:\libtorch-12.4</span></code>, переименуйте папку <code class="docutils literal notranslate"><span class="pre">C:\libtorch-12.4\libtorch</span></code> в <code class="docutils literal notranslate"><span class="pre">C:\libtorch-12.4\Release</span></code>.</p></li>
</ol>
</li>
<li><p>скачайте готовую сборку OpenCV 4.10.0 с официального сайта (<a class="reference external" href="https://opencv.org/releases/">https://opencv.org/releases/</a>). Распакуйте содержимое папки build архива и скопируйте в <code class="docutils literal notranslate"><span class="pre">C:\opencv-4.10.0-build\install</span></code></p></li>
</ul>
<p>Для установки библиотеки MRCV необходимо выполнить следующие действия:</p>
<ul>
<li><p>Клонировать актуальную версию проекта, используя команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone --branch main https://github.com/valabsoft/code-ai-400393.git</span>
</pre></div>
</div>
</li>
<li><p>Установить зависимости: libtorch, OpenCV, yaml-cpp (отображены рекомендованные пути для ОС Windows):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>C:\
├───libtorch-12.4
├───opencv-4.10.0-build
└───yaml-cpp
</pre></div>
</div>
</li>
<li><p>Для корректной работы библиотеки под управлением операционной системы Windows необходимо прописать системные пути в переменные окружения:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>C:\opencv-4.10.0-build\install\x64\vc17\bin\
C:\libtorch-12.4\Release\bin\
</pre></div>
</div>
</li>
<li><p>Настроить сборку, отключив поддержку CUDA. Для этого отредактировать CMakeLists.txt проекта</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>option(USE_CUDA &quot;Use CUDA Build&quot; OFF)
</pre></div>
</div>
</li>
<li><p>Запустить проект от имени администратора и открыть mrcv как локальную папку (File → Open → Folder)</p></li>
<li><p>Настройте CMakeLists.txt и CMakeLists.txt в каждом примере в папке examples, убедившись, что пути к libtorch, opencv и yaml-cpp указаны корректно (см. пример ниже)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>if(USE_CUDA)
   # Добавляем макрос MRCV_CUDA_ENABLED
   target_compile_definitions(mrcv PRIVATE MRCV_CUDA_ENABLED)
   if(WIN32)
      set(CMAKE_PREFIX_PATH &quot;C:/libtorch-12.4-cuda/Release;C:/yaml-cpp&quot;)
      set(OpenCV_DIR &quot;C:/opencv-4.10.0-build-cuda/install&quot;)
      set(Torch_DIR &quot;C:/libtorch-12.4-cuda/Release/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;C:/opencv-4.10.0-build-cuda/install/include&quot;)
      set(OpenCV_LIB_DIR &quot;C:/opencv-4.10.0-build-cuda/install/x64/vc17/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;C:/libtorch-12.4-cuda/Release/include&quot;)
      set(Torch_LIB_DIR &quot;C:/libtorch-12.4-cuda/Release/lib&quot;)
   else()
      set(Torch_DIR &quot;/opt/libtorch/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;/usr/local/include/opencv4&quot;)
      set(OpenCV_LIB_DIR &quot;/usr/local/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;/usr/local/include/torch&quot;)
      set(Torch_LIB_DIR &quot;/usr/local/lib&quot;)

   endif()
else()
   if(WIN32)
      set(CMAKE_PREFIX_PATH &quot;C:/libtorch-12.4/Release;C:/yaml-cpp&quot;)
      set(OpenCV_DIR &quot;C:/opencv-4.10.0-build/install&quot;)
      set(Torch_DIR &quot;C:/libtorch-12.4/Release/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;C:/opencv-4.10.0-build/install/include&quot;)
      set(OpenCV_LIB_DIR &quot;C:/opencv-4.10.0-build/install/x64/vc17/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;C:/libtorch-12.4/Release/include&quot;)
      set(Torch_LIB_DIR &quot;C:/libtorch-12.4/Release/lib&quot;)
   else()
      set(Torch_DIR &quot;/opt/libtorch/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;/usr/local/include/opencv4&quot;)
      set(OpenCV_LIB_DIR &quot;/usr/local/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;/usr/local/include/torch&quot;)
      set(Torch_LIB_DIR &quot;/usr/local/lib&quot;)
   endif()
endif()
</pre></div>
</div>
</li>
<li><p>Выбрать в Visual Studio конфигурацию сборки dev-win;</p></li>
<li><p>В разделе «Сборка» выбрать «Собрать проект»;</p></li>
<li><p>После успешной сборки в разделе «Сборка» выбрать «Установить mrcv».</p></li>
</ul>
</section>
<section id="id68">
<h3>Для операционной системы Windows с поддержкой CUDA<a class="headerlink" href="#id68" title="Link to this heading"></a></h3>
<p>Необходимо выполнить следующий ряд действий:</p>
<ul>
<li><p>Установить необходимые компоненты:</p>
<ol class="arabic">
<li><p>CMake GUI 3.30.0-rc4 или новее с официального сайта (доступен по ссылке <a class="reference external" href="https://cmake.org/download/">https://cmake.org/download/</a>)</p></li>
<li><p>Git Bash (доступен по ссылке <a class="reference external" href="https://gitforwindows.org/">https://gitforwindows.org/</a>)</p></li>
<li><p>Visual Studio 2022 Community Edition с компонентом <strong>Desktop development with C++</strong> (доступен по ссылке <a class="reference external" href="https://visualstudio.microsoft.com/">https://visualstudio.microsoft.com/</a>)</p></li>
<li><p>yaml-cpp при помощи консольных инструкций:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\</span>
<span class="go">git clone https://github.com/jbeder/yaml-cpp.git</span>
<span class="go">cd yaml-cpp</span>
<span class="go">mkdir build</span>
<span class="go">cd build</span>
<span class="go">cmake .. -DYAML_CPP_BUILD_TESTS=OFF -DYAML_CPP_INSTALL=ON</span>
<span class="go">cmake --build . --config Release</span>
<span class="go">cmake --install . --prefix &quot;C:\yaml-cpp&quot;</span>
</pre></div>
</div>
</li>
<li><p>LibTorch 2.4.0 с поддержкой CUDA 12.4
(доступна по ссылке:
<a class="reference external" href="https://download.pytorch.org/libtorch/cu124/libtorch-win-shared-with-deps-2.4.0%2Bcu124.zip">https://download.pytorch.org/libtorch/cu124/libtorch-win-shared-with-deps-2.4.0%2Bcu124.zip</a>). После скачивания архива распакуйте его содержимое в папку <code class="docutils literal notranslate"><span class="pre">C:\libtorch-12.4-cuda</span></code>, переименуйте папку <code class="docutils literal notranslate"><span class="pre">C:\libtorch-12.4\libtorch</span></code> в <code class="docutils literal notranslate"><span class="pre">C:\libtorch-12.4\Release</span></code>.</p></li>
<li><p>CUDA Toolkit 12.4
(доступ по ссылке <a class="reference external" href="https://developer.nvidia.com/cuda-12-4-0-download-archive">https://developer.nvidia.com/cuda-12-4-0-download-archive</a>). Установите CUDA Toolkit в папку по умолчанию: <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\NVIDIA</span> <span class="pre">GPU</span> <span class="pre">Computing</span> <span class="pre">Toolkit\CUDA\v12.4</span></code>.</p></li>
<li><p>cuDNN 9.3.0
(доступ по ссылке <a class="reference external" href="https://developer.nvidia.com/cudnn-9-3-0-download-archive?target_os=Windows&amp;target_arch=x86_64">https://developer.nvidia.com/cudnn-9-3-0-download-archive?target_os=Windows&amp;target_arch=x86_64</a>)
Необходимо скачать архив с тремя папками: bin, include, lib. Их нужно скопировать в папку установки CUDA Toolkit 12.4.
Путь по умолчанию:
<code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\NVIDIA</span> <span class="pre">GPU</span> <span class="pre">Computing</span> <span class="pre">Toolkit\CUDA\v12.4</span></code>.</p></li>
</ol>
</li>
<li><p>Клонировать репозитории с версией OpenCV 4.10:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://github.com/opencv/opencv.git -b &quot;4.10.0&quot;</span>
<span class="go">git clone https://github.com/opencv/opencv_contrib.git -b &quot;4.10.0&quot;</span>
</pre></div>
</div>
</li>
<li><p>Создайте папку <code class="docutils literal notranslate"><span class="pre">C:\opencv-4.10.0-build-cuda\install</span></code> и перенесите в нее скачанные opencv и opencv_contrib.</p></li>
<li><p>Создать пустые директории для сборки библиотеки <code class="docutils literal notranslate"><span class="pre">C:\opencv-4.10.0-build-cuda\install\opencv\build</span></code> и <code class="docutils literal notranslate"><span class="pre">C:\opencv-4.10.0-build-cuda\install\bin</span></code>.</p></li>
<li><p>Запустить CMake-GUI.</p></li>
<li><p>Выбрать компилятор Visual Studio 17 2022.</p>
<img alt="Окно выбора компилятора" src="_images/compiler_selection.jpg" />
</li>
<li><p>В полях <strong>Where is the source code</strong> и <strong>Where is the build binaries</strong> указать пути к папке с исходниками OpenCV и созданной папке build.
Например, папка <code class="docutils literal notranslate"><span class="pre">install</span></code> содержит собранные материалы библиотеки OpenCV и экстра модулей.</p>
<img alt="Окно выбора каталога" src="_images/directory_selection.jpg" />
</li>
<li><p>Нажать <strong>Configure</strong>.</p></li>
<li><p>После успешного конфигурирования найти и выставить параметры:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">C:/opencv-4.10.0-build-cuda/install</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXECUTABLE_OUTPUT_PATH</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">C:/opencv-4.10.0-build-cuda/install/bin</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OPENCV_EXTRA_MODULES_PATH</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">C:/opencv-4.10.0-build-cuda/install/opencv_contrib/modules</span></code></p></li>
<li><p>Отметить галочкой <code class="docutils literal notranslate"><span class="pre">WITH_CUDA</span></code></p></li>
</ul>
<p><strong>Примечание:</strong> Если переменные отсутствуют в перечне, нужно поставить галочку в пункте Advanced.</p>
</li>
<li><p>Нажать <strong>Configure</strong> и выставить дополнительные параметры:</p>
<ul class="simple">
<li><p>Отметить <code class="docutils literal notranslate"><span class="pre">CUDA_FAST_MATH</span></code>, <code class="docutils literal notranslate"><span class="pre">OPENCV_DNN_CUDA</span></code>, <code class="docutils literal notranslate"><span class="pre">ENABLE_FAST_MATH</span></code>, <code class="docutils literal notranslate"><span class="pre">WITH_OPENGL</span></code></p></li>
<li><p>Снять галочки с <code class="docutils literal notranslate"><span class="pre">WITH_NVCUVENC</span></code>, <code class="docutils literal notranslate"><span class="pre">WITH_NVCUVID</span></code>, <code class="docutils literal notranslate"><span class="pre">WITH_VTK</span></code></p></li>
<li><p>Указать архитектуру видеокарты в <code class="docutils literal notranslate"><span class="pre">CUDA_ARCH_BIN</span></code> (например, 7.5 для NVIDIA RTX 20xx)</p></li>
<li><p>Если cuDNN установлен в нестандартном месте, указать пути:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CUDNN_LIBRARY</span></code> -&gt; путь к файлу <code class="docutils literal notranslate"><span class="pre">cudnn.lib</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CUDNN_INCLUDE_DIR</span></code> -&gt; путь к папке <code class="docutils literal notranslate"><span class="pre">include</span></code> cuDNN</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Нажать <strong>Generate</strong>.</p></li>
<li><p>После генерации нажать <strong>Open Project</strong> для запуска проекта Visual Studio.</p></li>
<li><p>В обозревателе решений Visual Studio в папке CMakeTargets нажать правой кнопкой на <strong>ALL_BUILD</strong> и выбрать <strong>Build</strong>.</p>
<img alt="Окно обозревателя решений" src="_images/solution_explorer.jpg" />
</li>
<li><p>После успешной сборки выполнить сборку конфигурации <strong>INSTALL</strong>.</p></li>
</ul>
<p>Для установки библиотеки MRCV необходимо выполнить следующие действия:</p>
<ul>
<li><p>Клонировать актуальную версию проекта, используя команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone --branch main https://github.com/valabsoft/code-ai-400393.git</span>
</pre></div>
</div>
</li>
<li><p>Установить зависимости (CUDA Toolkit 12.4 и cuDNN 9.3) библиотеки, указанные ранее: libtorch, OpenCV, yaml-cpp (отображены рекомендованные пути для ОС Windows):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>C:\
├───libtorch-12.4-cuda
├───opencv-4.10.0-build-cuda
└───yaml-cpp
</pre></div>
</div>
</li>
<li><p>Для корректной работы библиотеки под управлением операционной системы Windows необходимо прописать системные пути в переменные окружения:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>C:\opencv-4.10.0-build-cuda\install\x64\vc17\bin
C:\libtorch-12.4-cuda\Release\bin
C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.4\bin
</pre></div>
</div>
</li>
<li><p>Настроить сборку, установив ключ поддержки CUDA. Для этого отредактировать CMakeLists.txt проекта</p></li>
</ul>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>option(USE_CUDA &quot;Use CUDA Build&quot; ON)
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>Запустить проект от имени администратора и открыть mrcv как локальную папку (File → Open → Folder);</p></li>
<li><p>Настройте CMakeLists.txt и CMakeLists.txt в каждом примере в папке examples, убедившись, что пути к libtorch, opencv и yaml-cpp указаны корректно (см. пример ниже)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>if(USE_CUDA)
   # Добавляем макрос MRCV_CUDA_ENABLED
   target_compile_definitions(mrcv PRIVATE MRCV_CUDA_ENABLED)
   if(WIN32)
      set(CMAKE_PREFIX_PATH &quot;C:/libtorch-12.4-cuda/Release;C:/yaml-cpp&quot;)
      set(OpenCV_DIR &quot;C:/opencv-4.10.0-build-cuda/install&quot;)
      set(Torch_DIR &quot;C:/libtorch-12.4-cuda/Release/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;C:/opencv-4.10.0-build-cuda/install/include&quot;)
      set(OpenCV_LIB_DIR &quot;C:/opencv-4.10.0-build-cuda/install/x64/vc17/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;C:/libtorch-12.4-cuda/Release/include&quot;)
      set(Torch_LIB_DIR &quot;C:/libtorch-12.4-cuda/Release/lib&quot;)
   else()
      set(Torch_DIR &quot;/opt/libtorch/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;/usr/local/include/opencv4&quot;)
      set(OpenCV_LIB_DIR &quot;/usr/local/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;/usr/local/include/torch&quot;)
      set(Torch_LIB_DIR &quot;/usr/local/lib&quot;)

   endif()
else()
   if(WIN32)
      set(CMAKE_PREFIX_PATH &quot;C:/libtorch-12.4/Release;C:/yaml-cpp&quot;)
      set(OpenCV_DIR &quot;C:/opencv-4.10.0-build/install&quot;)
      set(Torch_DIR &quot;C:/libtorch-12.4/Release/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;C:/opencv-4.10.0-build/install/include&quot;)
      set(OpenCV_LIB_DIR &quot;C:/opencv-4.10.0-build/install/x64/vc17/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;C:/libtorch-12.4/Release/include&quot;)
      set(Torch_LIB_DIR &quot;C:/libtorch-12.4/Release/lib&quot;)
   else()
      set(Torch_DIR &quot;/opt/libtorch/share/cmake/Torch&quot;)

      set(OpenCV_INCLUDE_DIRS &quot;/usr/local/include/opencv4&quot;)
      set(OpenCV_LIB_DIR &quot;/usr/local/lib&quot;)

      set(Torch_INCLUDE_DIRS &quot;/usr/local/include/torch&quot;)
      set(Torch_LIB_DIR &quot;/usr/local/lib&quot;)
   endif()
endif()
</pre></div>
</div>
</li>
<li><p>Выбрать конфигурацию сборки dev-win;</p></li>
<li><p>В разделе «Сборка» выбрать «Собрать проект»;</p></li>
<li><p>После успешной сборки в разделе «Сборка» выбрать «Установить mrcv».</p></li>
</ul>
</section>
<section id="linux-ubuntu-cuda">
<h3>Для операционной системы Linux (Ubuntu) без поддержки CUDA (пошаговая версия)<a class="headerlink" href="#linux-ubuntu-cuda" title="Link to this heading"></a></h3>
<p>Необходимо выполнить следующий ряд действий:</p>
<p><strong>Установить зависимости с помощью набора команд</strong></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt update</span>
<span class="go">sudo apt install -y unzip wget curl build-essential cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libdc1394-dev</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Установить библиотеку yaml-cpp</strong></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone https://github.com/jbeder/yaml-cpp.git</span>
<span class="go">cd yaml-cpp</span>
<span class="go">cmake .</span>
<span class="go">make -j$(nproc)</span>
<span class="go">sudo make install</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Установить библиотеку OpenCV</strong></p>
<p>Выполнить команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone https://github.com/opencv/opencv.git -b &quot;4.10.0&quot;</span>
<span class="go">git clone https://github.com/opencv/opencv_contrib.git -b &quot;4.10.0&quot;</span>
<span class="go">mkdir -p opencv/build &amp;&amp; cd opencv/build</span>
<span class="go">cmake -D CMAKE_BUILD_TYPE=Release \</span>
<span class="go">      -D CMAKE_INSTALL_PREFIX=/usr/local \</span>
<span class="go">      -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib/modules \</span>
<span class="go">      ..</span>
<span class="go">sudo make -j$(nproc)</span>
<span class="go">sudo make install</span>
</pre></div>
</div>
<p>Сборка осуществляется в папке build. При возникновении ошибок необходимо очистить папки build и .cache.</p>
<p><strong>Установить библиотеку LibTorch</strong></p>
<p>Скачать соответсвующий архив с библиотекой:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">curl -L &quot;https://download.pytorch.org/libtorch/cpu/libtorch-cxx11-abi-shared-with-deps-2.4.0%2Bcpu.zip&quot; -o libtorch-library.zip</span>
</pre></div>
</div>
</div></blockquote>
<p>Распаковать архив libtorch-library.zip с помощью команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo unzip -o libtorch-library.zip -d /opt/</span>
</pre></div>
</div>
<p>Добавить путь к libtorch в динамический компоновщик с помощью команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo sh -c &quot;echo &#39;/opt/libtorch/lib&#39; &gt;&gt; /etc/ld.so.conf.d/libtorch.conf&quot;</span>
</pre></div>
</div>
<p>Обновить кэш динамического компоновщика с помощью команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ldconfig</span>
</pre></div>
</div>
<p>Добавить путь к заголовочным файлам и библиотекам в переменные окружения, отредактировав файл ~/.bashrc, открыв его при помощи команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo nano  ~/.bashrc</span>
</pre></div>
</div>
<p>и записав конец следующие строки:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export TORCH_INCLUDE=/opt/libtorch/include</span>
<span class="go">export TORCH_LIB=/opt/libtorch/lib</span>
<span class="go">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$TORCH_LIB</span>
<span class="go">export CPATH=$CPATH:$TORCH_INCLUDE</span>
<span class="go">export Torch_DIR=/opt/libtorch/share/cmake/Torch</span>
</pre></div>
</div>
<p>затем сохранив (Ctrl + O, Ctrl + X) необходимо активировать изменения при помощи команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source ~/.bashrc</span>
</pre></div>
</div>
<p>Убедиться в правильности установки можно используя инструкцию <a class="reference external" href="https://docs.pytorch.org/cppdocs/installing.html">https://docs.pytorch.org/cppdocs/installing.html</a>.
При нехватке системных ресурсов при сборке рекомендуется запускать сборку через make без указания параметра -j.</p>
<p>Для установки библиотеки MRCV необходимо выполнить следующие действия:</p>
<ul>
<li><p>Клонировать актуальную версию проекта, используя команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone --branch main https://github.com/valabsoft/code-ai-400393.git</span>
</pre></div>
</div>
</li>
<li><p>Установить библиотеки, указанные ранее</p></li>
<li><p>Выполнить команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/code-ai-400393</span>
<span class="go">mkdir -p build &amp;&amp; cd build</span>
<span class="go">cmake ..</span>
<span class="go">make -j$(nproc)</span>
<span class="go">sudo make install</span>
<span class="go">sudo ldconfig -v</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id69">
<h3>Для операционной системы Linux (Ubuntu) без поддержки CUDA (версия с помощью скрипта)<a class="headerlink" href="#id69" title="Link to this heading"></a></h3>
<p>Для установки библиотеки MRCV вместе с требующимися зависимостями возможно запустить shell-скрипт. Для этого нужно создать файл с помощью последовательности команд</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">nano install_cpu.sh</span>
</pre></div>
</div>
</div></blockquote>
<p>Вставить код, предстваленный ниже, в файл</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span><span class="w"> </span>-e

sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>unzip<span class="w"> </span>wget<span class="w"> </span>curl<span class="w"> </span>build-essential<span class="w"> </span>cmake<span class="w"> </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>libgtk2.0-dev<span class="w"> </span>pkg-config<span class="w"> </span>libavcodec-dev<span class="w"> </span>libavformat-dev<span class="w"> </span>libswscale-dev<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>libtbb2<span class="w"> </span>libtbb-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>libpng-dev<span class="w"> </span>libtiff-dev<span class="w"> </span>libdc1394-dev

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>yaml-cpp<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/jbeder/yaml-cpp.git
<span class="k">fi</span>
<span class="nb">cd</span><span class="w"> </span>yaml-cpp
cmake<span class="w"> </span>.
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
sudo<span class="w"> </span>make<span class="w"> </span>install

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span>libtorch-library.zip<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>curl<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;https://download.pytorch.org/libtorch/cpu/libtorch-cxx11-abi-shared-with-deps-2.4.0%2Bcpu.zip&quot;</span><span class="w"> </span>-o<span class="w"> </span>libtorch-library.zip
<span class="k">fi</span>
sudo<span class="w"> </span>unzip<span class="w"> </span>-o<span class="w"> </span>libtorch-library.zip<span class="w"> </span>-d<span class="w"> </span>/opt/

<span class="nv">TORCH_CONF</span><span class="o">=</span><span class="s2">&quot;/etc/ld.so.conf.d/libtorch.conf&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;/opt/libtorch/lib&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TORCH_CONF</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/opt/libtorch/lib&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TORCH_CONF</span><span class="s2">&quot;</span>
<span class="w">   </span>sudo<span class="w"> </span>ldconfig
<span class="k">fi</span>

<span class="nv">BASHRC</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.bashrc&quot;</span>
<span class="nv">ENV_MARK</span><span class="o">=</span><span class="s2">&quot;# BEGIN TORCH ENV&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_MARK</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_MARK</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export TORCH_INCLUDE=/opt/libtorch/include&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export TORCH_LIB=/opt/libtorch/lib&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export LD_LIBRARY_PATH=\$LD_LIBRARY_PATH:\$TORCH_LIB&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export CPATH=\$CPATH:\$TORCH_INCLUDE&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export Torch_DIR=/opt/libtorch/share/cmake/Torch&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# END TORCH ENV&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>opencv<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/opencv/opencv.git<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;4.10.0&quot;</span>
<span class="k">fi</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>opencv_contrib<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/opencv/opencv_contrib.git<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;4.10.0&quot;</span>
<span class="k">fi</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>opencv/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opencv/build

cmake<span class="w"> </span>-D<span class="w"> </span><span class="nv">CMAKE_BUILD_TYPE</span><span class="o">=</span>Release<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-D<span class="w"> </span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="o">=</span>/usr/local<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-D<span class="w"> </span><span class="nv">OPENCV_EXTRA_MODULES_PATH</span><span class="o">=</span>../../opencv_contrib/modules<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>..

sudo<span class="w"> </span>make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>code-ai-400393<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>main<span class="w"> </span>https://github.com/valabsoft/code-ai-400393.git
<span class="k">fi</span>
<span class="nb">cd</span><span class="w"> </span>code-ai-400393
mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build

cmake<span class="w"> </span>..
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig<span class="w"> </span>-v
</pre></div>
</div>
</div></blockquote>
<p>Сохранить содержимое файла <em>Ctrl + O</em> и закрыть файл <em>Ctrl + X</em>. Сделать файл исполняемым с помощью команды</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">chmod +x install_cpu.sh</span>
</pre></div>
</div>
</div></blockquote>
<p>Запустить скрипт</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./install_cpu.sh</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="id70">
<h3>Для операционной системы Linux (Ubuntu) с поддержкой CUDA (пошаговая версия)<a class="headerlink" href="#id70" title="Link to this heading"></a></h3>
<p>Необходимо выполнить следующий ряд действий:</p>
<p><strong>Установить зависимости с помощью набора команд</strong></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt update</span>
<span class="go">sudo apt install -y unzip wget curl build-essential cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libdc1394-dev</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Установить библиотеку yaml-cpp</strong></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone https://github.com/jbeder/yaml-cpp.git</span>
<span class="go">cd yaml-cpp</span>
<span class="go">cmake .</span>
<span class="go">make -j$(nproc)</span>
<span class="go">sudo make install</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Установить CUDA Toolkit 12.4</strong></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">wget https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb</span>
<span class="go">sudo dpkg -i cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb</span>
<span class="go">sudo cp /var/cuda-repo-ubuntu2204-12-4-local/cuda-*-keyring.gpg /usr/share/keyrings/</span>
<span class="go">sudo apt-get update</span>
<span class="go">sudo apt-get -y install cuda-toolkit-12-4</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Установить cuDNN 9.3</strong></p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">wget https://developer.download.nvidia.com/compute/cudnn/9.3.0/local_installers/cudnn-local-repo-ubuntu2204-9.3.0_1.0-1_amd64.deb</span>
<span class="go">sudo dpkg -i cudnn-local-repo-ubuntu2204-9.3.0_1.0-1_amd64.deb</span>
<span class="go">sudo cp /var/cudnn-local-repo-ubuntu2204-9.3.0/cudnn-*-keyring.gpg /usr/share/keyrings/</span>
<span class="go">sudo apt-get update</span>
<span class="go">sudo apt-get -y install cudnn</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Установить библиотеку OpenCV</strong></p>
<p>Выполнить последовательность команд</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone https://github.com/opencv/opencv.git -b &quot;4.10.0&quot;</span>
<span class="go">git clone https://github.com/opencv/opencv_contrib.git -b &quot;4.10.0&quot;</span>
<span class="go">mkdir -p opencv/build &amp;&amp; cd opencv/build</span>
<span class="go">sudo cmake .. \</span>
<span class="go">   -D CMAKE_INSTALL_PREFIX=/usr/local/ \</span>
<span class="go">   -D CMAKE_CXX_COMPILER=/usr/bin/g++-11 \</span>
<span class="go">   -D ENABLE_FAST_MATH=ON \</span>
<span class="go">   -D CUDA_FAST_MATH=ON \</span>
<span class="go">   -D WITH_CUBLAS=ON \</span>
<span class="go">   -D WITH_CUDA=ON \</span>
<span class="go">   -D WITH_CUDNN=ON \</span>
<span class="go">   -D CUDA_ARCH_BIN=8.6 \</span>
<span class="go">   -D WITH_OPENGL=ON \</span>
<span class="go">   -D BUILD_opencv_cudacodec=ON \</span>
<span class="go">   -D BUILD_opencv_world=OFF \</span>
<span class="go">   -D OPENCV_GENERATE_PKGCONFIG=ON \</span>
<span class="go">   -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib/modules \</span>
<span class="go">   -D CMAKE_CONFIGURATION_TYPES=Release</span>
<span class="go">sudo make -j$(nproc)</span>
<span class="go">sudo make install</span>
</pre></div>
</div>
<p>Сборка осуществляется в папке build. При возникновении ошибок необходимо очистить папки build и .cache.</p>
<p><strong>Установить библиотеку LibTorch</strong></p>
<p>Скачать соответсвующий архив с библиотекой</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">curl -L &quot;https://download.pytorch.org/libtorch/cu124/libtorch-cxx11-abi-shared-with-deps-2.4.0%2Bcu124.zip&quot; -o libtorch-library.zip</span>
</pre></div>
</div>
</div></blockquote>
<p>Распаковать архив libtorch-library.zip с помощью команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo unzip -o libtorch-library.zip -d /opt/</span>
</pre></div>
</div>
<p>Добавить путь к libtorch в динамический компоновщик с помощью команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo sh -c &quot;echo &#39;/opt/libtorch/lib&#39; &gt;&gt; /etc/ld.so.conf.d/libtorch.conf&quot;</span>
</pre></div>
</div>
<p>Обновить кэш динамического компоновщика с помощью команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo ldconfig</span>
</pre></div>
</div>
<p>Добавить путь к заголовочным файлам и библиотекам в переменные окружения, отредактировав файл ~/.bashrc, открыв его при помощи команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo nano  ~/.bashrc</span>
</pre></div>
</div>
<p>и записать в конец файла следующие строки</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export TORCH_INCLUDE=/opt/libtorch/include</span>
<span class="go">export TORCH_LIB=/opt/libtorch/lib</span>
<span class="go">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$TORCH_LIB</span>
<span class="go">export CPATH=$CPATH:$TORCH_INCLUDE</span>
<span class="go">export Torch_DIR=/opt/libtorch/share/cmake/Torch</span>
</pre></div>
</div>
<p>Сохранить изменения <em>Ctrl + O</em> и закрыть файл <em>Ctrl + X</em>. Активировать изменения с помощью команды</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source ~/.bashrc</span>
</pre></div>
</div>
<p>Убедиться в правильности установки можно используя инструкцию <a class="reference external" href="https://docs.pytorch.org/cppdocs/installing.html">https://docs.pytorch.org/cppdocs/installing.html</a>.
При нехватке системных ресурсов при сборке рекомендуется запускать сборку через make без указания параметра -j.</p>
<p>Для установки библиотеки MRCV необходимо выполнить следующие действия:</p>
<ul>
<li><p>Клонировать актуальную версию проекта, используя команды:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">git clone --branch main https://github.com/valabsoft/code-ai-400393.git</span>
</pre></div>
</div>
</li>
<li><p>Установить библиотеки, указанные ранее</p></li>
<li><p>Выполнить последовательность команд</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/code-ai-400393</span>
<span class="go">sed -i &#39;s/option(USE_CUDA &quot;Use CUDA Build&quot; OFF)/option(USE_CUDA &quot;Use CUDA Build&quot; ON)/&#39; CMakeLists.txt</span>
<span class="go">mkdir -p build &amp;&amp; cd build</span>
<span class="go">sudo cmake -DCMAKE_CUDA_COMPILER:PATH=/usr/local/cuda/bin/nvcc ..</span>
<span class="go">sudo make -j$(nproc)</span>
<span class="go">sudo make install</span>
<span class="go">sudo ldconfig -v</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id71">
<h3>Для операционной системы Linux (Ubuntu) с поддержкой CUDA (версия с помощью скрипта)<a class="headerlink" href="#id71" title="Link to this heading"></a></h3>
<p>Для установки библиотеки MRCV вместе с требующимися зависимостями возможно запустить shell-скрипт.
Для этого необходимо создать файл с помощью команды</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">nano install_cuda.sh</span>
</pre></div>
</div>
</div></blockquote>
<p>В созданный файл вставить содержимое, представленное ниже</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">set</span><span class="w"> </span>-e

sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>unzip<span class="w"> </span>wget<span class="w"> </span>curl<span class="w"> </span>build-essential<span class="w"> </span>cmake<span class="w"> </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>libgtk2.0-dev<span class="w"> </span>pkg-config<span class="w"> </span>libavcodec-dev<span class="w"> </span>libavformat-dev<span class="w"> </span>libswscale-dev<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>libtbb2<span class="w"> </span>libtbb-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>libpng-dev<span class="w"> </span>libtiff-dev<span class="w"> </span>libdc1394-dev

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>yaml-cpp<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/jbeder/yaml-cpp.git
<span class="k">fi</span>
<span class="nb">cd</span><span class="w"> </span>yaml-cpp
cmake<span class="w"> </span>.
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
sudo<span class="w"> </span>make<span class="w"> </span>install

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span>cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
wget<span class="w"> </span>https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb
<span class="k">fi</span>
sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>cuda-repo-ubuntu2204-12-4-local_12.4.0-550.54.14-1_amd64.deb
sudo<span class="w"> </span>cp<span class="w"> </span>/var/cuda-repo-ubuntu2204-12-4-local/cuda-*-keyring.gpg<span class="w"> </span>/usr/share/keyrings/
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>cuda-toolkit-12-4

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span>cudnn-local-repo-ubuntu2204-9.3.0_1.0-1_amd64.deb<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
wget<span class="w"> </span>https://developer.download.nvidia.com/compute/cudnn/9.3.0/local_installers/cudnn-local-repo-ubuntu2204-9.3.0_1.0-1_amd64.deb
<span class="k">fi</span>
sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>cudnn-local-repo-ubuntu2204-9.3.0_1.0-1_amd64.deb
sudo<span class="w"> </span>cp<span class="w"> </span>/var/cudnn-local-repo-ubuntu2204-9.3.0/cudnn-*-keyring.gpg<span class="w"> </span>/usr/share/keyrings/
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>cudnn

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>opencv<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/opencv/opencv.git<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;4.10.0&quot;</span>
<span class="k">fi</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>opencv_contrib<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/opencv/opencv_contrib.git<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;4.10.0&quot;</span>
<span class="k">fi</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>opencv/build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opencv/build

sudo<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="o">=</span>/usr/local/<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">CMAKE_CXX_COMPILER</span><span class="o">=</span>/usr/bin/g++-11<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">ENABLE_FAST_MATH</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">CUDA_FAST_MATH</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">WITH_CUBLAS</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">WITH_CUDA</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">WITH_CUDNN</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">CUDA_ARCH_BIN</span><span class="o">=</span><span class="m">8</span>.6<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">WITH_OPENGL</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">BUILD_opencv_cudacodec</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">BUILD_opencv_world</span><span class="o">=</span>OFF<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">OPENCV_GENERATE_PKGCONFIG</span><span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">OPENCV_EXTRA_MODULES_PATH</span><span class="o">=</span>../../opencv_contrib/modules<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-D<span class="w"> </span><span class="nv">CMAKE_CONFIGURATION_TYPES</span><span class="o">=</span>Release

sudo<span class="w"> </span>make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span>libtorch-library.zip<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>curl<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;https://download.pytorch.org/libtorch/cu124/libtorch-cxx11-abi-shared-with-deps-2.4.0%2Bcu124.zip&quot;</span><span class="w"> </span>-o<span class="w"> </span>libtorch-library.zip
<span class="k">fi</span>
sudo<span class="w"> </span>unzip<span class="w"> </span>-o<span class="w"> </span>libtorch-library.zip<span class="w"> </span>-d<span class="w"> </span>/opt/

<span class="nv">TORCH_CONF</span><span class="o">=</span><span class="s2">&quot;/etc/ld.so.conf.d/libtorch.conf&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;/opt/libtorch/lib&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TORCH_CONF</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/opt/libtorch/lib&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TORCH_CONF</span><span class="s2">&quot;</span>
<span class="w">   </span>sudo<span class="w"> </span>ldconfig
<span class="k">fi</span>

<span class="nv">BASHRC</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.bashrc&quot;</span>
<span class="nv">ENV_MARK</span><span class="o">=</span><span class="s2">&quot;# BEGIN TORCH ENV&quot;</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_MARK</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_MARK</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export TORCH_INCLUDE=/opt/libtorch/include&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export TORCH_LIB=/opt/libtorch/lib&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export LD_LIBRARY_PATH=\$LD_LIBRARY_PATH:\$TORCH_LIB&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export CPATH=\$CPATH:\$TORCH_INCLUDE&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export Torch_DIR=/opt/libtorch/share/cmake/Torch&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# END TORCH ENV&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASHRC</span><span class="s2">&quot;</span>

<span class="nb">cd</span><span class="w"> </span>~
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>code-ai-400393<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>main<span class="w"> </span>https://github.com/valabsoft/code-ai-400393.git
<span class="k">fi</span>
<span class="nb">cd</span><span class="w"> </span>code-ai-400393
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/option(USE_CUDA &quot;Use CUDA Build&quot; OFF)/option(USE_CUDA &quot;Use CUDA Build&quot; ON)/&#39;</span><span class="w"> </span>CMakeLists.txt
mkdir<span class="w"> </span>-p<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build

sudo<span class="w"> </span>cmake<span class="w"> </span>-DCMAKE_CUDA_COMPILER:PATH<span class="o">=</span>/usr/local/cuda/bin/nvcc<span class="w"> </span>..
sudo<span class="w"> </span>make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig<span class="w"> </span>-v
</pre></div>
</div>
</div></blockquote>
<p>Сохранить содержимое файла <em>Ctrl + O</em> и закрыть файл <em>Ctrl + X</em>.</p>
<p>Сделать файл исполняемым с помощью последовательности команд</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">chmod +x install_cuda.sh</span>
</pre></div>
</div>
</div></blockquote>
<p>Запустить скрипт</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./install_cuda.sh</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="python-mrcv">
<h2>Инструкция по установке Python версии библиотеки mrcv<a class="headerlink" href="#python-mrcv" title="Link to this heading"></a></h2>
<p>Минимальная версия Python для работы с библиотекой - 3.10.</p>
<p>Проверить, установлен ли Python</p>
<blockquote>
<div><p>python3 –version</p>
</div></blockquote>
<p>Если Python отсутствует, установить с помощью команды</p>
<blockquote>
<div><p>sudo apt-get update
sudo apt-get install python3</p>
</div></blockquote>
<p>Проверить, установлена ли поддержка Git</p>
<blockquote>
<div><p>git –version</p>
</div></blockquote>
<p>Если Git не установлен, установить с помощью команды</p>
<blockquote>
<div><p>sudo apt-get install git</p>
</div></blockquote>
<p>Клонировать репозиторий кода из ветки <strong>main</strong></p>
<blockquote>
<div><p>git clone –branch main <a class="reference external" href="https://github.com/valabsoft/code-ai-400393.git">https://github.com/valabsoft/code-ai-400393.git</a></p>
</div></blockquote>
<p>Локальная копия репозитория создана на вашем устройстве.</p>
<p>Перейти в локальную копию репозитория на устройстве</p>
<blockquote>
<div><p>cd code-ai-400393/python</p>
</div></blockquote>
<p>Рекомендуется использовать виртуальное окружение для изоляции зависимостей. Для этого необходимо выполнить следующие действия.</p>
<p>Создайте виртуальное окружение с именем <em>venv</em></p>
<blockquote>
<div><p>python3 -m venv venv</p>
</div></blockquote>
<p>Активировать окружение</p>
<blockquote>
<div><p>source venv/bin/activate</p>
</div></blockquote>
<p>После этого в терминале появится <em>venv</em>, что указывает на активное окружение.</p>
<p>В директории есть файл requirements.txt с необходимыми библиотеками:</p>
<p>Если файл находится в корневой директории, выполнить команду</p>
<blockquote>
<div><p>pip install -r requirements.txt</p>
</div></blockquote>
<p>Установите библиотеку с помощью команды</p>
<blockquote>
<div><p>pip install -e .</p>
</div></blockquote>
<p>Перейти в директорию с примерами с помощью команды</p>
<blockquote>
<div><p>cd python/examples</p>
</div></blockquote>
<p>Выбрать папку модуля и запустить пример. Предварительно убедиться, что в папке присутствуют файлы, использующиеся в качестве исходных данных</p>
<blockquote>
<div><p>cd python/examples/comparing/
python comparing.py</p>
</div></blockquote>
</section>
<section id="mini">
<h2>Для mini-ПК<a class="headerlink" href="#mini" title="Link to this heading"></a></h2>
<p>Использование функций библиотеки доступно на мини-ПК типа NVIDIA Jetson, Raspberry Pi и др. Для предварительной настройки библиотеки на этом классе устройств рекомендуется воспользоваться рекомендациям, изложенными в разделе <a class="reference external" href="#mrcv-python-version">Установка Python версии</a>.</p>
</section>
<section id="id72">
<h2>Подготовка данных для работы с примерами<a class="headerlink" href="#id72" title="Link to this heading"></a></h2>
<p>При знакомстве с библиотекой mrcv, после изучения состава модулей библиотеки, рекомендуется обратиться к демонстрационным примерам. Все примеры библиотеки снабжены необходимыми файлами, которые используются в качестве входных данных. После сборки примера рекомендуется скопировать в папку сборки примера папку <em>files</em> из репозитория кода. После копирования исходных данных выполнить запуски примера.</p>
<p><em>Пример</em></p>
<p>Демонстрация работы функций модуля сегментации (для операционной системы Windows).
Код примера находится в папке <em>code-ai-400393\examples\segmentationtest</em></p>
<p>Порядок работы:</p>
<ul class="simple">
<li><p>Собрать исполняемый файл примера. В случае успешной сборки, исполняемый файл примера будет создан в папке <em>code-ai-400393\build\examples\segmentationtest</em></p></li>
<li><p>Скопировать папку <em>files</em> с исходными данными из папки <em>code-ai-400393\examples\segmentationtest\files</em> в папку <em>code-ai-400393\build\examples\segmentationtest\files</em></p></li>
<li><p>Запустить исполняемый файл примера <em>mrcv-segmentationtest.exe</em></p></li>
<li><p>В результате работы функции будет открыто два окна с исходным изображением и с изображением, полученным в результате работы функции сегмнетации</p></li>
</ul>
<p><em>Исходное изображение</em></p>
<blockquote>
<div><img alt="Исходное изображение" src="_images/seg-source.jpg" />
</div></blockquote>
<p><em>Результат работы функции</em></p>
<blockquote>
<div><img alt="Исходное изображение" src="_images/seg-prediction.jpg" />
</div></blockquote>
<ul class="simple">
<li><p>После работы с исходными данными примера по-умолчанию, внести изменения в код примера, указав собственные входные данные или настройки параметров функции</p></li>
</ul>
<p><em>Например</em></p>
<p>Изменить путь к исходному файлу с изображением</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">segmentor</span><span class="p">.</span><span class="n">Predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ship&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>или отключить показ окон, изменив параметры функции</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">segmentor</span><span class="p">.</span><span class="n">Predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ship&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id73">
<h2>Запуск примеров библиотеки<a class="headerlink" href="#id73" title="Link to this heading"></a></h2>
<p>Запуск демонстрационного примера augmentation (остальные примеры запускаются по аналогии)</p>
<ol class="arabic simple">
<li><p>Перейти в папку <em>build/examples</em> любым удобным способом</p></li>
<li><p>Выбрать папку примера</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd augmentation</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Скопировать папку <em>files</em> из <em>examples/augmentation</em> в <em>build/examples/augmentation</em></p></li>
<li><p>Запустить исполняемый файл</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./mrcv-augmentation</span>
</pre></div>
</div>
</section>
</section>
<section id="id74">
<h1>Демонстрационные примеры<a class="headerlink" href="#id74" title="Link to this heading"></a></h1>
<section id="id75">
<h2>Программные функции библиотеки для подсчета количества объектов интереса по данным видеопотока в реальном масштабе времени и определения курса роботизированного аппарата на объект интереса<a class="headerlink" href="#id75" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/objcourse</span></code> библиотеки. В папке files находятся необходимые входные данные для демонстрации работы функции:</p>
<ul class="simple">
<li><p>ship.onnx – обученная модель в формате YOLO5;</p></li>
<li><p>ship.names – текстовый файл с именами классов объектов интереса.</p></li>
</ul>
<p>Создание экземпляра класса осуществляется с помощью вызова конструктора:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">ObjCourse</span><span class="w"> </span><span class="o">*</span><span class="n">objcourse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">ObjCourse</span><span class="p">(</span><span class="n">modelPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span><span class="w"> </span><span class="n">classPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">());</span>
</pre></div>
</div>
<p>В качестве входных данных конструктор принимает полный путь к модели, полный путь к файлу с классами модели и размеры детектора.</p>
<p>Тестирование проводилось на синтетическом изображении — модели кадра видеопотока, содержащего объект интереса.
Режим отображения меток используется только в режиме отладки при включенном флаге <code class="docutils literal notranslate"><span class="pre">IS_DEBUG_LOG_ENABLED</span></code>.</p>
<p>Результат работы детектора:</p>
<a class="reference internal image-reference" href="_images/objcourse_result.jpg"><img alt="Тестовое изображение с результатом работы" src="_images/objcourse_result.jpg" style="width: 200px;" /></a>
<p>Для выполнения основных функций модуля используются вызовы методов класса <code class="docutils literal notranslate"><span class="pre">ObjCourse</span></code>, как показано ниже.
Подразумевается, что тестовое изображение предварительно загружено в переменную <code class="docutils literal notranslate"><span class="pre">cv::Mat</span> <span class="pre">frameShip</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Подсчет объектов</span>
<span class="kt">int</span><span class="w"> </span><span class="n">objCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objcourse</span><span class="o">-&gt;</span><span class="n">getObjectCount</span><span class="p">(</span><span class="n">frameShip</span><span class="p">);</span>

<span class="c1">// Расчет курса</span>
<span class="kt">float</span><span class="w"> </span><span class="n">objAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objcourse</span><span class="o">-&gt;</span><span class="n">getObjectCourse</span><span class="p">(</span><span class="n">frameShip</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">);</span>
</pre></div>
</div>
<p>Метод <code class="docutils literal notranslate"><span class="pre">getObjectCount</span></code> принимает на вход кадр видеофрейма в формате <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>
и возвращает количество найденных объектов.</p>
<p>Метод <code class="docutils literal notranslate"><span class="pre">getObjectCourse</span></code> принимает кадр видеофрейма, разрешение камеры по горизонтали (в пикселях) и угол обзора камеры,
возвращая угловую поправку на текущий курс с учетом знака смещения.</p>
</section>
<section id="id76">
<h2>Пример использования программных функций библиотеки для автоматической настройки параметров обучения нейросети с архитектурой YOLOv5<a class="headerlink" href="#id76" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/configuration</span></code> библиотеки.</p>
<p><em>Генерация конфигурационного файла для YOLOv5s с 80 классами представлена ниже</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">try</span>
<span class="p">{</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5GenerateHyperparameters</span><span class="p">(</span><span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5Model</span><span class="o">::</span><span class="n">YOLOv5s</span><span class="p">,</span>
<span class="w">                                          </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yolov5s-hyp.yaml&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
<span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>При успешной генерации без исключений, содержимое созданного конфигурационного файла <em>yolov5s-hyp.yaml</em> приведено ниже:</p>
<p><code class="docutils literal notranslate"><span class="pre">weight_decay:</span> <span class="pre">0.00050000000000000001</span></code>
<code class="docutils literal notranslate"><span class="pre">box:</span> <span class="pre">0.075000000000000011</span></code>
<code class="docutils literal notranslate"><span class="pre">cls:</span> <span class="pre">0.52500000000000002</span></code>
<code class="docutils literal notranslate"><span class="pre">cls_pw:</span> <span class="pre">1</span></code>
<code class="docutils literal notranslate"><span class="pre">obj:</span> <span class="pre">1</span></code>
<code class="docutils literal notranslate"><span class="pre">obj_pw:</span> <span class="pre">1</span></code>
<code class="docutils literal notranslate"><span class="pre">anchor_t:</span> <span class="pre">4</span></code>
<code class="docutils literal notranslate"><span class="pre">fl_gamma:</span> <span class="pre">0.17004397181410924</span></code>
Здесь можно заметить обозначенные ранее параметры, которые необходимы для обучения моделей детекторов и классификаторов <em>YOLOv5</em>.</p>
</section>
<section id="id77">
<h2>Пример использования программных функций библиотеки для автоматической генерации конфигурационных файлов для моделей детекторов и классификаторов<a class="headerlink" href="#id77" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/configuration</span></code> библиотеки.</p>
<p>Генерация конфигурационного файла для YOLOv5s с 80 классами представлена ниже:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">try</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5GenerateConfig</span><span class="p">(</span><span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5Model</span><span class="o">::</span><span class="n">YOLOv5s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yolov5s-coco.yaml&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>При успешной генерации без исключений, содержимое созданного конфигурационного файла <code class="docutils literal notranslate"><span class="pre">yolov5s-coco.yaml</span></code> приведено ниже:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">depth_multiple</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.33000000000000002</span>
<span class="nt">width_multiple</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">anchors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">10</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">13</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">30</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">33</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">23</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">30</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">61</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">62</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">45</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">59</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">119</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">116</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">90</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">156</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">198</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">373</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">326</span><span class="p p-Indicator">]</span>
<span class="nt">backbone</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">[[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">64</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">128</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">128</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">256</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">256</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">512</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">9</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">512</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1024</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1024</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">SPPF</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1024</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">5</span><span class="p p-Indicator">]]]</span>
<span class="nt">head</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">[[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">512</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">nn.Upsample</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">None</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">nearest</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Concat</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">512</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">False</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">256</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">nn.Upsample</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">None</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">nearest</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Concat</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">256</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">False</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">256</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">14</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Concat</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">512</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">False</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Conv</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">512</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">10</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Concat</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[</span><span class="nv">-1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1024</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">False</span><span class="p p-Indicator">]],</span>
<span class="w">   </span><span class="p p-Indicator">[[</span><span class="nv">17</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">23</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Detect</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">nc</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">anchors</span><span class="p p-Indicator">]]]</span>
</pre></div>
</div>
<p>Здесь можно заметить обозначенные ранее атрибуты, которые необходимы для конфигурации моделей детекторов и классификаторов YOLOv5.</p>
</section>
<section id="id78">
<h2>Пример использования программных функций библиотеки для автоматического обучения нейронной сети для детекции и идентификации объектов<a class="headerlink" href="#id78" title="Link to this heading"></a></h2>
<p>Пример использования модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/detectorautotrain</span></code> библиотеки.</p>
<p>В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся входные данные для демонстрации работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">autodetector.pt</span></code> – обученная модель в формате YOLO4_tiny;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">voc_classes.txt</span></code> – текстовый файл с именами классов объектов интереса;</p></li>
<li><p>изображения в формате <code class="docutils literal notranslate"><span class="pre">.jpg</span></code> для обучения и валидации модели;</p></li>
<li><p>файлы меток классов к изображениям в формате <code class="docutils literal notranslate"><span class="pre">.xml</span></code>.</p></li>
</ul>
<p>Для выполнения основных функций модуля используются вызовы методов класса <code class="docutils literal notranslate"><span class="pre">mrcv::Detector</span></code>, как это показано ниже.
Сперва необходимо объявление экземпляра класса <code class="docutils literal notranslate"><span class="pre">mrcv::Deteсtor</span> <span class="pre">detector</span></code>, после чего вызов метода
<code class="docutils literal notranslate"><span class="pre">detector.Initialize(devID,</span> <span class="pre">width,</span> <span class="pre">height,</span> <span class="pre">nameListPath)</span></code> для инициализации модели.</p>
<p>Входные аргументы:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">devID</span></code> – ID устройства, на котором будет исполняться функционал модели,
ID &lt; 0 – исполнение на CPU, ID &gt;= 0 – исполнение на GPU с выбором конкретного устройства;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span> <span class="pre">×</span> <span class="pre">height</span></code> – разрешение входного изображения после масштабирования;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nameListPath</span></code> – путь к текстовому файлу с именами классов объектов интереса.</p></li>
</ul>
<p>Метод <code class="docutils literal notranslate"><span class="pre">AutoTrain</span></code> библиотеки принимает:</p>
<ul class="simple">
<li><p>путь к обучающей и валидационной выборкам;</p></li>
<li><p>тип изображения в этих выборках (например, <code class="docutils literal notranslate"><span class="pre">.jpg</span></code>, <code class="docutils literal notranslate"><span class="pre">.png</span></code> и др.);</p></li>
<li><p>векторы значений гиперпараметров: количества эпох, размеров батча, скорости обучения;</p></li>
<li><p>путь к предварительно обученной модели и путь для сохранения итоговой модели.</p></li>
</ul>
<p>Пример использования методов:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="w"> </span><span class="n">detector</span><span class="p">;</span>
<span class="n">detector</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">416</span><span class="p">,</span><span class="w"> </span><span class="mi">416</span><span class="p">,</span><span class="w"> </span><span class="n">vocClassesPath</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
<span class="n">detector</span><span class="p">.</span><span class="n">AutoTrain</span><span class="p">(</span>
<span class="w">    </span><span class="n">datasetPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="s">&quot;.jpg&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="mf">0.001</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0E-4F</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="n">pretrainedModelPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">modelSavePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Тестирование производилось на взятой из открытого источника выборке, состоящей из <strong>3224 изображений для обучения</strong> и <strong>907 изображений для валидации</strong>.</p>
<p>Результат работы функции автоматического обучения:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Training with epochs: 10, batch size: 4, learning rate: 0.001
Epoch: 0, Training Loss: 9.74461
Epoch: 0, Valid Loss: 1.067471
...
Epoch: 9, Training Loss: 0.498858
Epoch: 9, Valid Loss: 0.688751

Training with epochs: 10, batch size: 4, learning rate: 0.0001
...
Epoch: 9, Training Loss: 0.295652
Epoch: 9, Valid Loss: 0.416149

Training with epochs: 10, batch size: 8, learning rate: 0.001
...
Epoch: 9, Training Loss: 0.169151
Epoch: 9, Valid Loss: 0.1421471

Training with epochs: 10, batch size: 8, learning rate: 0.0001
...
Epoch: 9, Training Loss: 0.1198785
Epoch: 9, Valid Loss: 0.1454247

Training with epochs: 15, batch size: 4, learning rate: 0.001
...
Epoch: 14, Training Loss: 0.367891
Epoch: 14, Valid Loss: 0.549404

Training with epochs: 15, batch size: 4, learning rate: 0.0001
...
Epoch: 14, Training Loss: 0.208666
Epoch: 14, Valid Loss: 0.542158

Training with epochs: 15, batch size: 8, learning rate: 0.001
...
Epoch: 14, Training Loss: 0.1019419
Epoch: 14, Valid Loss: 0.1554376

Training with epochs: 15, batch size: 8, learning rate: 0.0001
...
Epoch: 14, Training Loss: 0.0939302
Epoch: 14, Valid Loss: 0.1397133

Training with epochs: 30, batch size: 4, learning rate: 0.001
...
Epoch: 29, Training Loss: 0.2111429
Epoch: 29, Valid Loss: 0.655723

Training with epochs: 30, batch size: 4, learning rate: 0.0001
...
Epoch: 29, Training Loss: 0.0957526
Epoch: 29, Valid Loss: 0.643364

Training with epochs: 30, batch size: 8, learning rate: 0.001
...
Epoch: 29, Training Loss: 0.1048645
Epoch: 29, Valid Loss: 0.1644395

Training with epochs: 30, batch size: 8, learning rate: 0.0001
...
Epoch: 29, Training Loss: 0.0414545
Epoch: 29, Valid Loss: 0.173299

Best hyperparameters:
Epochs: 30
Batch size: 8
Learning rate: 0.001
Best validation loss: 0.127668

Epoch: 0, Training Loss: 0.1494259
Epoch: 0, Valid Loss: 0.1652038
...
Epoch: 29, Training Loss: 0.1037284
Epoch: 29, Valid Loss: 0.136483
</pre></div>
</div>
<p>Вывод:
Из текста вывода видно, что за время работы функции было проведено <strong>13 итераций обучения</strong>, включая итоговую.
При заданных значениях гиперпараметров <strong>минимальное значение функции потерь (0.127668)</strong> было достигнуто с использованием следующих параметров:</p>
<ul class="simple">
<li><p>Количество эпох: 30</p></li>
<li><p>Размер батча: 8</p></li>
<li><p>Темп обучения: 0.001</p></li>
</ul>
<p>Время обучения составило <strong>6 часов 13 минут</strong> при указанных параметрах.</p>
</section>
<section id="id79">
<h2>Пример использования программных функций библиотеки для детектирования аварийной ситуации технологического объекта<a class="headerlink" href="#id79" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/emergency_detector</span></code> библиотеки.</p>
<p>В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> представлены выборки с данными о повреждёнными трубами (<code class="docutils literal notranslate"><span class="pre">pipes</span></code>).
Из выборки взяты изображения для демонстрации работы функции. В той же директории находятся входные данные:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pipes/test/burst_augment_56_blur45_jpg.rf.714ba15fef8cf1f9ebcc19bbdb07dd2a.jpg</span></code> – изображение с повреждённым объектом;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emergency_detector.pt</span></code> – обученная модель в формате YOLO4_tiny;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipes/voc_classes.txt</span></code> – текстовый файл с именами классов, характеризующих возможные аварийные ситуации.</p></li>
</ul>
<p>Рисунок А.4.3 – Тестовое изображение для демонстрации работы функции:</p>
<img alt="Тестовое изображение с повреждённой трубой" class="align-center" src="_images/figure452.jpg" />
<p>Использование функций</p>
<p>Для выполнения основных функций модуля используются вызовы методов класса <code class="docutils literal notranslate"><span class="pre">mrcv::Detector</span></code>, как это показано ниже.
Сначала необходимо создать экземпляр класса <code class="docutils literal notranslate"><span class="pre">mrcv::Detector</span> <span class="pre">detector</span></code>, затем вызвать метод
<code class="docutils literal notranslate"><span class="pre">detector.Initialize(devID,</span> <span class="pre">width,</span> <span class="pre">height,</span> <span class="pre">nameListPath)</span></code> для инициализации модели.</p>
<p><strong>Аргументы метода инициализации:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">devID</span></code> – ID устройства, на котором будет исполняться модель:
<code class="docutils literal notranslate"><span class="pre">ID</span> <span class="pre">&lt;</span> <span class="pre">0</span></code> – исполнение на CPU, <code class="docutils literal notranslate"><span class="pre">ID</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> – на GPU с выбором конкретного устройства;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span> <span class="pre">×</span> <span class="pre">height</span></code> – разрешение входного изображения после масштабирования;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nameListPath</span></code> – путь к файлу с именами классов объектов интереса.</p></li>
</ul>
<p><strong>Предполагается, что тестовое изображение предварительно загружено в переменную</strong> <code class="docutils literal notranslate"><span class="pre">cv::Mat</span> <span class="pre">image</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Детекция объектов на изображении</span>
<span class="n">detector</span><span class="p">.</span><span class="n">Predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Параметры метода</strong> <code class="docutils literal notranslate"><span class="pre">Predict</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv::Mat</span> <span class="pre">image</span></code> – изображение;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> – флаг отображения ограничивающих рамок (bounding box);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0.1</span></code> – порог доверительности (confidence threshold);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0.3</span></code> – порог для NMS (Non-Maximum Suppression).</p></li>
</ul>
<p>Фрагмент технического лога</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>15:44:02 | INFO | Device is GPU 0
15:44:02 | INFO | Model initializing is complete!
15:44:03 | INFO | Starting detector...
15:44:03 | INFO | Boxes detected: 0 with 0.954479 confidence
15:44:03 | INFO | Boxes detected: 1 with 0.930952 confidence
15:44:03 | INFO | Detector is complete!
</pre></div>
</div>
<p>Из текста лога и на рисунке А.4.3 видно два обнаруженных места повреждения трубы.
Доверительная вероятность обнаружения составила <strong>более 90%</strong>.
Время работы:</p>
<ul class="simple">
<li><p>на системе с <strong>GPU</strong>: ~12,2 минуты;</p></li>
<li><p>на системе с <strong>CPU</strong>: более <strong>2 часов</strong>.</p></li>
</ul>
</section>
<section id="id80">
<h2>Пример использования программных функций библиотеки для сопровождения объекта по данным системы компьютерного зрения с применением нейросетевого подхода к предсказанию положения объекта<a class="headerlink" href="#id80" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/roi</span></code> библиотеки.</p>
<p>Создание экземпляра класса осуществляется с помощью вызова конструктора:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">Predictor</span><span class="w"> </span><span class="nf">predictor</span><span class="p">(</span><span class="n">hiddenSize</span><span class="p">,</span><span class="w"> </span><span class="n">layersNum</span><span class="p">,</span><span class="w"> </span><span class="n">predictorTrainPointsNum</span><span class="p">,</span><span class="w"> </span><span class="n">imgSize</span><span class="p">,</span><span class="w"> </span><span class="n">maxDeviation</span><span class="p">,</span><span class="w"> </span><span class="n">deviationThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">avgScale</span><span class="p">);</span>
</pre></div>
</div>
<p>В качестве входных данных конструктор принимает:</p>
<ul class="simple">
<li><p>размер скрытых слоев сети,</p></li>
<li><p>количество слоев сети,</p></li>
<li><p>количество точек, на которых проводится первичное обучение сети,</p></li>
<li><p>размер изображения, на котором сопровождается объект интереса,</p></li>
<li><p>максимальное отклонение предсказания от предсказываемой величины,</p></li>
<li><p>количество успешных предсказаний, при котором считается, что сеть достаточно натренирована,</p></li>
<li><p>размер выборки для определения скользящего среднего предсказания.</p></li>
</ul>
<p>Для выполнения требований по быстродействию сети и точности предсказания определены следующие оптимальные значения параметров нейронной сети:</p>
<ul class="simple">
<li><p>размер скрытых слоев сети: <strong>20–25</strong></p></li>
<li><p>количество слоев сети: <strong>1</strong></p></li>
<li><p>максимальное отклонение сильно варьируется в зависимости от характера перемещения объекта на изображении.
Для быстрых объектов оптимально значение не меньше <strong>150–200</strong>, для медленных — <strong>10–30</strong>.</p></li>
</ul>
<p>Остальные параметры либо зависят от контекста применения, либо предварительно инициализируются с оптимальными значениями.</p>
<p>Тестирование проводилось на синтетических данных — предсказывались траектории синусоиды и окружности.
Эти виды траекторий выбраны из-за простоты настройки и их нелинейной зависимости параметров, что усложняет предсказание и имитирует реальные условия.</p>
<p>Обучение модели производится методом:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">predictor</span><span class="p">.</span><span class="n">trainLSTMNet</span><span class="p">(</span><span class="n">coordinates</span><span class="p">);</span>
</pre></div>
</div>
<p>Метод принимает параметр с набором пар координат размером <code class="docutils literal notranslate"><span class="pre">pointsNumber</span></code>.</p>
<p>В основном цикле программы для определения следующего положения объекта вызывается:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">predictor</span><span class="p">.</span><span class="n">predictNextCoordinate</span><span class="p">();</span>
</pre></div>
</div>
<p>Он возвращает пару следующих координат объекта.</p>
<p>После получения реальной координаты вызывается:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">predictor</span><span class="p">.</span><span class="n">continueTraining</span><span class="p">(</span><span class="n">realCoordinate</span><span class="p">);</span>
</pre></div>
</div>
<p>Он принимает текущую реальную координату и выполняет дообучение модели.</p>
<p>Дополнительно можно запрашивать состояние сети и среднее отклонение предсказания:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">predictor</span><span class="p">.</span><span class="n">isWorkState</span><span class="p">();</span>
</pre></div>
</div>
<p>Метод возвращает <code class="docutils literal notranslate"><span class="pre">true</span></code>, если ошибка предсказаний остаётся ниже заданного порога <code class="docutils literal notranslate"><span class="pre">failsafeDeviation</span></code> в течение <code class="docutils literal notranslate"><span class="pre">failsafeDeviationThreshold</span></code> итераций.</p>
<p>Пример предсказания положения для траекторий синуса и окружности представлены на рисунке А.4.4:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure462.jpg"><img alt="_images/figure462.jpg" class="align-center" src="_images/figure462.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure462a.jpg"><img alt="_images/figure462a.jpg" class="align-center" src="_images/figure462a.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>а)                                      б)</p>
<p>Рисунок А.4.4 – Пример работы модуля предсказания положения для траекторий
(а) – движение по синусу; (б) – движение по окружности</p>
<p>По результатам выполнения методов предсказания координат на примерах видно:
по мере дообучения предсказанные координаты (траектория <strong>синего цвета</strong>) приближаются к реальным (траектория <strong>красного цвета</strong>).
Среднее отклонение составило <strong>7 пикселей</strong>.
Время предсказания — <strong>33.3 мс</strong>, что соответствует <strong>30 кадрам/с</strong> видеопотока.</p>
</section>
<section id="roi">
<h2>Пример использования программных функций библиотеки для построения региона интереса (ROI) с использованием предсказания перемещения объекта интереса на исходном изображении<a class="headerlink" href="#roi" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/roi</span></code> библиотеки.</p>
<p>Создание объекта класса <code class="docutils literal notranslate"><span class="pre">Optimizer</span></code> производится при помощи конструктора:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">Optimizer</span><span class="w"> </span><span class="nf">optimizer</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">,</span><span class="w"> </span><span class="n">epochs</span><span class="p">);</span>
</pre></div>
</div>
<p>В качестве входных данных конструктор принимает:</p>
<ul class="simple">
<li><p>количество наборов синтетических данных для обучения;</p></li>
<li><p>количество эпох обучения сети.</p></li>
</ul>
<p>В основном цикле программы, когда состояние предиктора положения становится <code class="docutils literal notranslate"><span class="pre">true</span></code>
(<code class="docutils literal notranslate"><span class="pre">predictor.isWorkState()</span></code>), необходимо вызвать метод:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">roiSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optimizer</span><span class="p">.</span><span class="n">optimizeRoiSize</span><span class="p">(</span>
<span class="w">    </span><span class="n">realCoordinate</span><span class="p">,</span>
<span class="w">    </span><span class="n">predictedCoordinate</span><span class="p">,</span>
<span class="w">    </span><span class="n">objectSize</span><span class="p">,</span>
<span class="w">    </span><span class="n">predictor</span><span class="p">.</span><span class="n">getMovingAverageDeviation</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Если значение размера региона интереса (ROI) отлично от нуля, значит определение размера прошло успешно,
и размер ROI соответствует критерию:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>roiSize ≥ objectSize * 1.1
</pre></div>
</div>
<p>Проверим работу оптимизатора для объекта размером <strong>100 пикселей</strong>,
данные о его перемещении получим из примера работы предиктора:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Optimized ROI size: 153.083
</pre></div>
</div>
<p>Выведем регион интереса с координатами центра, полученными при помощи методов класса <code class="docutils literal notranslate"><span class="pre">Predictor</span></code>
и размером, полученным при помощи класса <code class="docutils literal notranslate"><span class="pre">Optimizer</span></code>. Для получения ROI воспользуемся функцией:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">extractROI</span><span class="p">(</span><span class="n">imgR</span><span class="p">,</span><span class="w"> </span><span class="n">toPoint</span><span class="p">(</span><span class="n">predictedCoordinate</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">roiSize</span><span class="p">,</span><span class="w"> </span><span class="n">roiSize</span><span class="p">});</span>
</pre></div>
</div>
<p>В функцию передаются:</p>
<ul class="simple">
<li><p>исходное изображение,</p></li>
<li><p>предсказанные координаты объекта интереса,</p></li>
<li><p>оптимальный размер ROI.</p></li>
</ul>
<p>Регион имеет <strong>квадратную форму</strong>, поскольку объект представляет собой <strong>окружность диаметром 100 пикселей</strong>.
Полученный ROI представлен на рисунке А.4.5:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure472.jpg"><img alt="_images/figure472.jpg" class="align-center" src="_images/figure472.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure472a.jpg"><img alt="_images/figure472a.jpg" class="align-center" src="_images/figure472a.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>(а)                                     (б)</p>
<p>Рисунок А.4.5 – Результат вычисления региона интереса (ROI)
(а) – траектория; (б) – объект</p>
<p><strong>Вывод:</strong>
Из результатов построения следует, что размер ROI подобран <strong>оптимально</strong>,
так как при работе предиктора объект <strong>не выходил за пределы региона интереса</strong>.</p>
</section>
<section id="id81">
<h2>Пример использования программных функций библиотеки для предварительной обработки изображений (автоматическая коррекция контраста и яркости, исправление геометрических искажений)<a class="headerlink" href="#id81" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/imgpreprocessing/</span></code> библиотеки.</p>
<p>Для подготовки входных параметров функции предобработки <code class="docutils literal notranslate"><span class="pre">preprocessingImage()</span></code> производится загрузка исходного изображения:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">imageIn</span><span class="p">;</span>
<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">imageOut</span><span class="p">;</span>
<span class="n">imageIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="s">&quot;./files/seabed.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
<span class="n">imageOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageIn</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">writeLog</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> imageIn channels = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">imageIn</span><span class="p">.</span><span class="n">channels</span><span class="p">()));</span>
</pre></div>
</div>
<p>Формируется список применяемых методов предобработки:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">&gt;</span><span class="w"> </span><span class="n">metodImagePerProcessinBrightnessContrast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">::</span><span class="n">NOISE_FILTERING_01_MEDIAN_FILTER</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">::</span><span class="n">BALANCE_CONTRAST_10_LAB_CLAHE</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">::</span><span class="n">SHARPENING_02</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">::</span><span class="n">BRIGHTNESS_LEVEL_DOWN</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">::</span><span class="n">NONE</span><span class="p">,</span>
<span class="w">    </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">::</span><span class="n">CORRECTION_GEOMETRIC_DEFORMATION</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Далее, применяется функция предобработки:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">preprocessingImage</span><span class="p">(</span><span class="n">imageOut</span><span class="p">,</span><span class="w"> </span><span class="n">metodImagePerProcessin</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;./files/fileCameraParameters.xml&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Сохранение результата в файл:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="w"> </span><span class="n">imageOutputFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./files/outImages/test.png&quot;</span><span class="p">;</span>
<span class="n">cv</span><span class="o">::</span><span class="n">imwrite</span><span class="p">(</span><span class="n">imageOutputFilePath</span><span class="p">,</span><span class="w"> </span><span class="n">imageOut</span><span class="p">);</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">writeLog</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> результат преодобработки сохранён: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">imageOutputFilePath</span><span class="p">);</span>
</pre></div>
</div>
<p>Отображение результатов на экране:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">CoefShowWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">imageIn</span><span class="p">,</span><span class="w"> </span><span class="n">imageIn</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="kt">double</span><span class="p">(</span><span class="n">imageIn</span><span class="p">.</span><span class="n">cols</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CoefShowWindow</span><span class="p">),</span>
<span class="w">                                      </span><span class="kt">double</span><span class="p">(</span><span class="n">imageIn</span><span class="p">.</span><span class="n">rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CoefShowWindow</span><span class="p">)),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">INTER_LINEAR</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">imageOut</span><span class="p">,</span><span class="w"> </span><span class="n">imageOut</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="kt">double</span><span class="p">(</span><span class="n">imageOut</span><span class="p">.</span><span class="n">cols</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CoefShowWindow</span><span class="p">),</span>
<span class="w">                                        </span><span class="kt">double</span><span class="p">(</span><span class="n">imageOut</span><span class="p">.</span><span class="n">rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CoefShowWindow</span><span class="p">)),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">INTER_LINEAR</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&quot;imageIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">WINDOW_AUTOSIZE</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">&quot;imageIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">imageIn</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&quot;imageOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">WINDOW_AUTOSIZE</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">&quot;imageOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">imageOut</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>Результаты предобработки подводных изображений:</p>
<a class="reference internal image-reference" href="_images/preprocessing.jpg"><img alt="Исходное изображение, результат предобработки" class="align-center" src="_images/preprocessing.jpg" style="width: 200px;" /></a>
<p>Пример фрагмента log-файла во время запуска примера:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>16:59:43 | INFO |  === НОВЫЙ ЗАПУСК ===
16:59:43 | INFO | загружено изображение: ./files/img02.jfif :: 960x600x3
16:59:43 | INFO | imageIn.channels = 3
16:59:43 | INFO | NOISE_FILTERING_01_MEDIAN_FILTER, state = 0
16:59:43 | INFO | BALANCE_CONTRAST_10_LAB_CLAHE, state = 0
16:59:43 | INFO | SHARPENING_02, state = 0
16:59:43 | INFO | BRIGHTNESS_LEVEL_DOWN, state = 0
16:59:43 | INFO | CORRECTION_GEOMETRIC_DEFORMATION, state = 0
16:59:43 | INFO | Предобработка изображения завершена (успешно)
16:59:43 | INFO | результат предобработки сохранён: ./files/img02.jfif
</pre></div>
</div>
</section>
<section id="d-3d">
<h2>Пример использования программных функций библиотеки для компьютерного стереозрения для определения координат 3D точек в сегментах идентифицированных объектов и восстановления 3D сцены по двумерным изображениям<a class="headerlink" href="#d-3d" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/3dscene</span></code> библиотеки.</p>
<ul class="simple">
<li><p>L1000.bmp, R1000.bmp – набор исходных изображений;</p></li>
<li><p>(66a)_(960p)_NewCamStereoModule_Air.xml – xml-файл с параметрами камеры.</p></li>
</ul>
<p><strong>Подготовка входных данных</strong></p>
<p>Для подготовки входных параметров функции <code class="docutils literal notranslate"><span class="pre">readCameraStereoParametrsFromFile()</span></code>
необходимо загрузить исходные изображения и параметры камеры.
Также необходимо провести инициализацию параметров, как указано в примере использования.</p>
<p><strong>Основная функция</strong></p>
<p>Для определения координат 3D точек в сегментах идентифицированных объектов
и восстановления 3D сцены по двумерным изображениям используется функция:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">find3dPointsInObjectsSegments</span><span class="p">(</span>
<span class="w">    </span><span class="n">inputImageCamera01</span><span class="p">,</span><span class="w"> </span><span class="n">inputImageCamera02</span><span class="p">,</span><span class="w"> </span><span class="n">cameraParameters</span><span class="p">,</span>
<span class="w">    </span><span class="n">inputImageCamera01Remap</span><span class="p">,</span><span class="w"> </span><span class="n">inputImageCamera02Remap</span><span class="p">,</span>
<span class="w">    </span><span class="n">settingsMetodDisparity</span><span class="p">,</span><span class="w"> </span><span class="n">disparityMap</span><span class="p">,</span><span class="w"> </span><span class="n">points3D</span><span class="p">,</span><span class="w"> </span><span class="n">replyMasks</span><span class="p">,</span>
<span class="w">    </span><span class="n">outputImage</span><span class="p">,</span><span class="w"> </span><span class="n">outputImage3dSceene</span><span class="p">,</span><span class="w"> </span><span class="n">parameters3dSceene</span><span class="p">,</span>
<span class="w">    </span><span class="n">filePathModelYoloNeuralNet</span><span class="p">,</span><span class="w"> </span><span class="n">filePathClasses</span><span class="p">,</span>
<span class="w">    </span><span class="n">limitOutPoints</span><span class="p">,</span><span class="w"> </span><span class="n">limitsOutlierArea</span>
<span class="p">);</span>
</pre></div>
</div>
<p><strong>Результаты работы</strong></p>
<a class="reference internal image-reference" href="_images/figure10_1.jpg"><img alt="Фотография экспериментального стенда и стереопара со стереокамеры" src="_images/figure10_1.jpg" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="_images/figure10_2.jpg"><img alt="Карта диспаратности и бинарные маски сегментов" src="_images/figure10_2.jpg" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="_images/figure10_3.jpg"><img alt="Результат обнаружения объектов с координатой по Z" src="_images/figure10_3.jpg" style="width: 200px;" /></a>
<a class="inline-images reference internal image-reference" href="_images/figure10_4.jpg"><img alt="Изображения 3D сцены" class="inline-images" src="_images/figure10_4.jpg" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="_images/figure10_5.jpg"><img alt="Изображения 3D сцены" src="_images/figure10_5.jpg" style="width: 200px;" /></a>
<p><strong>Фрагмент лог-файла</strong></p>
<p>Ниже приведён фрагмент из лог-файла библиотеки во время запуска примера использования:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>14:51:16 | INFO | === НОВЫЙ ЗАПУСК ===
14:51:16 | INFO | 1. Загрузка изображений из файла (успешно)
14:51:16 | INFO |     загружено изображение: ./files/L1000.bmp :: 960x600x3
14:51:16 | INFO |     загружено изображение: ./files/R1000.bmp :: 960x600x3
14:51:16 | INFO | 2. Загрузка параметров стереокамеры из файла (успешно)
14:51:16 | INFO | A1. Выравнивание изображения камера 01 (успешно)
14:51:16 | INFO | A2. Облако 3D точек сцены найдено (успешно)
14:51:16 | INFO |     points3D.numPoints0 = 312718
14:51:16 | INFO |     points3D.numPoints = 8018
...
14:51:17 | INFO | 4.8 Вывод проекции 3D сцены на экран (успешно)
</pre></div>
</div>
</section>
<section id="id82">
<h2>Пример использования программных функций библиотеки для служебных утилит работы с видеокамерами, в т.ч. калибровка (одиночная камера и стереокамера)<a class="headerlink" href="#id82" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля представлен в папках:
<code class="docutils literal notranslate"><span class="pre">examples/recordvideo</span></code>, <code class="docutils literal notranslate"><span class="pre">examples/calibration</span></code> и <code class="docutils literal notranslate"><span class="pre">examples/disparitymap</span></code>.</p>
<p>Пример логирования</p>
<p>Функция логирования создает файл с расширением <code class="docutils literal notranslate"><span class="pre">*.log</span></code> в одноимённой папке <code class="docutils literal notranslate"><span class="pre">log</span></code>,
которая создается автоматически в корневой директории. Имя файла формируется как <code class="docutils literal notranslate"><span class="pre">dd-mm-yyyy.log</span></code>.</p>
<p>Типы сообщений:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LOGTYPE</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DEBUG</span><span class="p">,</span><span class="w">      </span><span class="c1">// Отладка        DEBG</span>
<span class="w">    </span><span class="n">ERROR</span><span class="p">,</span><span class="w">      </span><span class="c1">// Ошибка         ERRR</span>
<span class="w">    </span><span class="n">EXCEPTION</span><span class="p">,</span><span class="w">  </span><span class="c1">// Исключение     EXCP</span>
<span class="w">    </span><span class="n">INFO</span><span class="p">,</span><span class="w">       </span><span class="c1">// Информация     INFO</span>
<span class="w">    </span><span class="n">WARNING</span><span class="w">     </span><span class="c1">// Предупреждение WARN</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Примеры вызова логирования:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">writeLog</span><span class="p">(</span><span class="s">&quot;Create folder: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rightFramePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">());</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">writeLog</span><span class="p">(</span><span class="s">&quot;Can&#39;t open the camera ID = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">rightCameraID</span><span class="p">),</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">LOGTYPE</span><span class="o">::</span><span class="n">ERROR</span><span class="p">);</span>
</pre></div>
</div>
<p>Пример содержимого лог-файла:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>16:48:21 | DEBG | Images count: 5
16:48:21 | INFO | Path to images: calibration_images
16:48:21 | DEBG | Chessboard columns count: 9
16:48:21 | DEBG | Chessboard rows count: 6
16:48:21 | INFO | Square size: 20.100000
16:58:47 | INFO | Path to file: c:\SourceCode\code-ai-400393\build\examples\calibr
</pre></div>
</div>
<p>Пример записи видео</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">videoThread</span><span class="p">(</span><span class="n">mrcv</span><span class="o">::</span><span class="n">recordVideo</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sarganCV&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">CODEC</span><span class="o">::</span><span class="n">XVID</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">counterThread</span><span class="p">(</span><span class="n">consoleCounter</span><span class="p">);</span>
<span class="n">videoThread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<span class="n">counterThread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
</pre></div>
</div>
<p>После выполнения будут созданы файлы вида: <code class="docutils literal notranslate"><span class="pre">sarganCV_12102024_000124.avi</span></code>.</p>
<p>Пример калибровки камеры</p>
<p>Параметры задаются в файле <code class="docutils literal notranslate"><span class="pre">config.dat</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">image_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">50</span>
<span class="na">folder_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;calibration_images&quot;</span>
<span class="na">keypoints_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">9</span>
<span class="na">keypoints_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">6</span>
<span class="na">square_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">24</span>
</pre></div>
</div>
<p>После калибровки создается файл <code class="docutils literal notranslate"><span class="pre">calibration.xml</span></code> и сохраняются изображения в папках <code class="docutils literal notranslate"><span class="pre">L</span></code> и <code class="docutils literal notranslate"><span class="pre">R</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0.png
1.png
...
N.png
</pre></div>
</div>
<p>На рисунке А.4.14 представлен процесс интерактивной калибровки:</p>
<a class="reference internal image-reference" href="_images/figure410.jpg"><img alt="_images/figure410.jpg" src="_images/figure410.jpg" style="width: 100%;" /></a>
<p>(а) – консольный вывод приложения;</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure410a.jpg"><img alt="_images/figure410a.jpg" src="_images/figure410a.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure410b.jpg"><img alt="_images/figure410b.jpg" src="_images/figure410b.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>б)                                      в)</p>
<p>Рисунок А.4.14 – Процесс интерактивной калибровки камеры:
(б) – захват калибровочного шаблона левой камерой;
(в) – захват шаблона правой камерой.</p>
<p>Пример построения карты диспаратности</p>
<p>Вызов функции:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">disparityMap</span><span class="p">(</span>
<span class="w">    </span><span class="n">disparitymap</span><span class="p">,</span><span class="w"> </span><span class="n">imageLeft</span><span class="p">,</span><span class="w"> </span><span class="n">imageRight</span><span class="p">,</span>
<span class="w">    </span><span class="n">minDisparity</span><span class="p">,</span><span class="w"> </span><span class="n">numDisparities</span><span class="p">,</span><span class="w"> </span><span class="n">blockSize</span><span class="p">,</span>
<span class="w">    </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span>
<span class="w">    </span><span class="n">disparityType</span><span class="p">,</span><span class="w"> </span><span class="n">colorMap</span><span class="p">,</span>
<span class="w">    </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span>
<span class="p">);</span>
</pre></div>
</div>
<p><strong>Параметры функции:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">disparitymap</span></code> – выходная карта (<code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageLeft</span></code>, <code class="docutils literal notranslate"><span class="pre">imageRight</span></code> – входные изображения;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minDisparity</span></code> – рекомендовано <code class="docutils literal notranslate"><span class="pre">16</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numDisparities</span></code> – рекомендовано <code class="docutils literal notranslate"><span class="pre">160</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code> – параметры фильтрации (<code class="docutils literal notranslate"><span class="pre">sigma</span></code> ≈ <code class="docutils literal notranslate"><span class="pre">15</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">disparityType</span></code> – варианты: <code class="docutils literal notranslate"><span class="pre">ALL</span></code>, <code class="docutils literal notranslate"><span class="pre">BASIC_DISPARITY</span></code>, <code class="docutils literal notranslate"><span class="pre">BASIC_HEATMAP</span></code>, <code class="docutils literal notranslate"><span class="pre">FILTERED_DISPARITY</span></code>, <code class="docutils literal notranslate"><span class="pre">FILTERED_HEATMAP</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">colorMap</span></code> – например: <code class="docutils literal notranslate"><span class="pre">cv::COLORMAP_JET</span></code>, <code class="docutils literal notranslate"><span class="pre">VIRIDIS</span></code>, <code class="docutils literal notranslate"><span class="pre">TURBO</span></code>, <code class="docutils literal notranslate"><span class="pre">HOT</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">saveToFile</span></code> – сохранять ли карту;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">showImages</span></code> – отображать ли окна.</p></li>
</ul>
<p>Результаты работы представлены на рисунке А.4.15:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure410a1.jpg"><img alt="_images/figure410a1.jpg" src="_images/figure410a1.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure410a2.jpg"><img alt="_images/figure410a2.jpg" src="_images/figure410a2.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal image-reference" href="_images/figure410a3.jpg"><img alt="_images/figure410a3.jpg" src="_images/figure410a3.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure410a4.jpg"><img alt="_images/figure410a4.jpg" src="_images/figure410a4.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure410a5.jpg"><img alt="_images/figure410a5.jpg" src="_images/figure410a5.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure410a6.jpg"><img alt="_images/figure410a6.jpg" src="_images/figure410a6.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>а) LEFT  б) RIGHT    в) BASIC_DISPARITY  г) BASIC_HEATMAP    д) FILTERED_DISPARITY  е) FILTERED_HEATMAP</p>
<p>Рисунок А.4.15 – Построение карты диспаратности:
(а) – левое изображение;
(б) – правое изображение;
(в) – карта в оттенках серого;
(г) – цветная карта (TURBO);
(д) – отфильтрованная карта в сером;
(е) – отфильтрованная цветная карта.</p>
<p><strong>Примечание:</strong>
Параметры карты должны быть настроены под конкретную стереопару.
При использовании значений по умолчанию возможна потеря детализации.</p>
</section>
<section id="id83">
<h2>Пример использования программных функций библиотеки для автоматического создания датасетов для обучения нейросети<a class="headerlink" href="#id83" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/imgcollection</span></code> библиотеки.</p>
<p>Для запуска примера необходимо использовать основную функцию:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">getImagesFromYandex</span>
</pre></div>
</div>
<p>Описание параметров</p>
<p>Функция принимает следующие входные параметры:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">queryString</span></code> – строка поискового запроса;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">minWidth</span></code> – минимальная ширина изображения;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">minHeight</span></code> – минимальная высота изображения;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">templateName</span></code> – шаблон имени файла;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">outputFolder</span></code> – путь к папке для сохранения изображений;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">separateDataset</span></code> – разделить выборку по папкам (<code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">trainsetPercentage</span></code> – процент изображений для тренировочного набора;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">countFoto</span></code> – максимальное количество изображений;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">money</span></code> – режим использования API (платный/бесплатный);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">key</span></code> – ключ доступа Yandex Cloud;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">secretKey</span></code> – секретный ключ Yandex Cloud.</p></li>
</ul>
<p>Пример вызова функции:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">getImagesFromYandex</span><span class="p">(</span>
<span class="w">    </span><span class="n">queryString</span><span class="p">,</span>
<span class="w">    </span><span class="n">minWidth</span><span class="p">,</span>
<span class="w">    </span><span class="n">minHeight</span><span class="p">,</span>
<span class="w">    </span><span class="n">templateName</span><span class="p">,</span>
<span class="w">    </span><span class="n">outputFolder</span><span class="p">,</span>
<span class="w">    </span><span class="n">separateDataset</span><span class="p">,</span>
<span class="w">    </span><span class="n">trainsetPercentage</span><span class="p">,</span>
<span class="w">    </span><span class="n">countFoto</span><span class="p">,</span>
<span class="w">    </span><span class="n">money</span><span class="p">,</span>
<span class="w">    </span><span class="n">key</span><span class="p">,</span>
<span class="w">    </span><span class="n">secretKey</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id84">
<h2>Пример использования программных функций библиотеки для интеллектуальной сегментации объектов интереса на изображениях<a class="headerlink" href="#id84" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папках <code class="docutils literal notranslate"><span class="pre">examples/segmentationtest</span></code> и <code class="docutils literal notranslate"><span class="pre">examples/segmentationtrain</span></code> библиотеки.</p>
<p>В папке <code class="docutils literal notranslate"><span class="pre">file</span></code> находятся необходимые входные данные:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – изображения для проверки правильности обучения сети;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train</span></code> – изображения для обучения сети;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weights</span></code> – файлы с весами обученной модели.</p></li>
</ul>
<p>Для подготовки набора данных использовались <strong>полигональные аннотации произвольной формы в формате VOC</strong>.
Тестовые данные были размечены с использованием программы <a class="reference external" href="https://www.labelme.io/">Labelme</a>.</p>
<p>Пример размеченного файла (формат <code class="docutils literal notranslate"><span class="pre">.json</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
  &quot;version&quot;: &quot;4.5.7&quot;,
  &quot;flags&quot;: {},
  &quot;shapes&quot;: [
    {
      &quot;label&quot;: &quot;ship&quot;,
      &quot;points&quot;: [
        [158.83582089552237, 831.3134328358209],
        ...
        [164.8059701492537, 871.6119402985074]
      ],
      &quot;group_id&quot;: null,
      &quot;shape_type&quot;: &quot;polygon&quot;,
      &quot;flags&quot;: {}
    }
  ]
}
</pre></div>
</div>
<p>Обучение модели</p>
<p>Для обучения модели используется функция:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Train</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">learningRate</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">epochs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">batchSize</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">train_valPath</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">imageType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">savePath</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Параметры метода Train:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">learningRate</span></code> – скорость обучения;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epochs</span></code> – количество эпох;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">batchSize</span></code> – размер батча;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_valPath</span></code> – путь к изображениям;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageType</span></code> – тип изображений (напр., <code class="docutils literal notranslate"><span class="pre">.jpg</span></code>, <code class="docutils literal notranslate"><span class="pre">.png</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">savePath</span></code> – путь к сохранению весов модели.</p></li>
</ul>
<p>Прогнозирование</p>
<p>Для выполнения сегментации используется функция <code class="docutils literal notranslate"><span class="pre">Predict</span></code>.
Пример вызова:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">segmentor</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="mi">320</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;background&quot;</span><span class="p">,</span><span class="s">&quot;ship&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;resnet34&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;../weights/resnet34.pt&quot;</span><span class="p">);</span>
<span class="n">segmentor</span><span class="p">.</span><span class="n">LoadWeight</span><span class="p">(</span><span class="s">&quot;../weights/segmentor.pt&quot;</span><span class="p">);</span>
<span class="n">segmentor</span><span class="p">.</span><span class="n">Predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ship&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Результат</strong> – маска изображения, в которой <strong>по пикселям</strong> определяется наличие объекта.</p>
<p>Оценка качества</p>
<p>Для количественной оценки эффективности методов сегментации использовалась <strong>Dice Coefficient Loss</strong>,
которая показала результат:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Dice Score: 0.92%
</pre></div>
</div>
</section>
<section id="id85">
<h2>Пример использования программных функций библиотеки для реализации модифицированного алгоритма выделения связных компонент для кластеризации облака 3D точек<a class="headerlink" href="#id85" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/clustering</span></code> библиотеки.</p>
<p><em>Реализует алгоритмы кластеризации 3D-точек на основе данных стереокамер.</em></p>
<p><strong>Загрузка данных</strong></p>
<p><em>Загружает данные для кластеризации из файла.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">DenseStereo</span><span class="o">::</span><span class="n">loadDataFromFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Выполнение кластеризации</strong></p>
<p><em>Выполняет кластеризацию загруженных данных.</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">DenseStereo</span><span class="o">::</span><span class="n">makeClustering</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id86">
<h2>Пример использования программных функций библиотеки для предварительной обработки изображений для модуля аугментации данных<a class="headerlink" href="#id86" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке examples/augmentation библиотеки. Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/augmentation</span></code> библиотеки.</p>
<p>Модуль включает три основных этапа обработки данных: загрузку изображений, указание методов аугментации, сохранение результатов преобразования.
На первом этапе осуществляется загрузка входных изображений в вектор с использованием функции <code class="docutils literal notranslate"><span class="pre">cv::imread</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;</span><span class="w"> </span><span class="n">inputImagesAugmetation</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="n">inputImagesAugmetation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="s">&quot;files</span><span class="se">\\</span><span class="s">img0.jpg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
<span class="n">inputImagesAugmetation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="s">&quot;files</span><span class="se">\\</span><span class="s">img1.jpg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">inputImagesAugmetation</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="s">&quot;files</span><span class="se">\\</span><span class="s">img9.jpg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
</pre></div>
</div>
<p>На этапе задания методов аугментации задаются названия методов, которые будут применяться к входным изображениям. В качестве методов преобразования могут выступать: поворот изображения на 45, 90, 270 или 315 градусов; зеркальное отображение по горизонтали, вертикали или по обоим направлениям.
Ниже приведены методы аугментации изображений:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">&gt;</span><span class="w"> </span><span class="n">augmetationMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">ROTATE_IMAGE_90</span><span class="p">,</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">FLIP_HORIZONTAL</span><span class="p">,</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">FLIP_VERTICAL</span><span class="p">,</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">ROTATE_IMAGE_45</span><span class="p">,</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">ROTATE_IMAGE_315</span><span class="p">,</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">ROTATE_IMAGE_270</span><span class="p">,</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">FLIP_HORIZONTAL_AND_VERTICAL</span><span class="p">};</span>
</pre></div>
</div>
<p>Далее осуществляется вызов функции аугментации в формате</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">augmetation</span><span class="p">(</span><span class="n">inputImagesAugmetation</span><span class="p">,</span><span class="w"> </span><span class="n">outputImagesAugmetation</span><span class="p">,</span><span class="w"> </span><span class="n">augmetationMethod</span><span class="p">);</span>
</pre></div>
</div>
<p>После выполнения всех операций, модифицированные изображения сохраняются на диск с использованием функции <code class="docutils literal notranslate"><span class="pre">cv::imwrite(ss.str(),</span> <span class="pre">resultImage)</span></code></p>
<p>Результат работы функции аугментации :</p>
<a class="inline-images reference internal image-reference" href="_images/augmentation1.jpg"><img alt="Пример результата обработки" class="inline-images" src="_images/augmentation1.jpg" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="_images/augmentation2.jpg"><img alt="Пример результата обработки" src="_images/augmentation2.jpg" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="_images/augmentation3.jpg"><img alt="Пример результата обработки" src="_images/augmentation3.jpg" style="width: 200px;" /></a>
</section>
<section id="id87">
<h2>Пример использования программных функций библиотеки для полуавтоматической разметки для аугментации данных с помощью нейронной сети<a class="headerlink" href="#id87" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/objcourse</span></code> библиотеки.</p>
<p>В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся необходимые входные данные для демонстрации работы:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">images</span></code> – папка с датасетом для обучения автоэнкодера;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code> – папка для сохранения результатов работы;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ship.onnx</span></code> – обученная модель в формате YOLOv5;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ship.names</span></code> – текстовый файл с именами классов.</p></li>
</ul>
<p>Генерация изображения</p>
<p>Функция генерации изображения, выдающая итоговый тензор, вызывается следующим образом:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span><span class="w"> </span><span class="n">gentensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">neuralNetworkAugmentationAsTensor</span><span class="p">(</span>
<span class="w">    </span><span class="n">imagePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mf">3E-4</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Чтобы получить изображение после выполнения в виде объекта <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="w"> </span><span class="n">genImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">neuralNetworkAugmentationAsMat</span><span class="p">(</span>
<span class="w">    </span><span class="n">imagePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mf">3E-4</span>
<span class="p">);</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p>путь к изображению;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code> – размеры изображения;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">200</span></code> – размерность скрытого пространства;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> – размерность латентного пространства;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3000</span></code> – размер пакета;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">32</span></code> – количество итераций;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3E-4</span></code> – коэффициент скорости обучения.</p></li>
</ul>
<p>Результат работы функции приведен на рисунке А.4.20:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure415a.jpg"><img alt="_images/figure415a.jpg" class="align-center" src="_images/figure415a.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure415b.jpg"><img alt="_images/figure415b.jpg" class="align-center" src="_images/figure415b.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p>Рисунок А.4.20 – Сгенерированное изображение после работы функции</p>
<p>Полуавтоматическая разметка</p>
<p>Функция полуавтоматической разметки вызывается следующим образом:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">semiAutomaticLabeler</span><span class="p">(</span>
<span class="w">    </span><span class="n">colorGenImage</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span>
<span class="w">    </span><span class="n">resultPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">modelPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">classPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p><strong>Параметры:</strong></p>
<ul class="simple">
<li><p>цветное изображение;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height</span></code>, <code class="docutils literal notranslate"><span class="pre">width</span></code> – размеры изображения;</p></li>
<li><p>путь к папке для сохранения результата;</p></li>
<li><p>путь к модели и классам YOLO.</p></li>
</ul>
<p>Также доступна перегрузка функции для работы с уже сохранённым изображением:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">semiAutomaticLabeler</span><span class="p">(</span>
<span class="w">    </span><span class="n">colorGenImage</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span>
<span class="w">    </span><span class="n">resultPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">modelPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">classPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p>После выполнения в папке <code class="docutils literal notranslate"><span class="pre">result</span></code> будет файл с разметкой <strong>в формате YOLO</strong> и изображение с нанесённой меткой.</p>
<p>Результат работы функции приведён на рисунке А.4.21:</p>
<p>Рисунок А.4.21 – Размеченное изображение после работы функции</p>
<p><strong>Содержание файла разметки:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 0.435937 0.422656 0.825 0.807813
</pre></div>
</div>
<p>Первое значение – номер класса,
остальные четыре – координаты (x, y, width, height) в относительных значениях.</p>
<p>Фрагмент технического лога</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>22:56:28 | INFO | Loaded Images: 21
22:56:29 | INFO | Training...
22:57:18 | INFO | Training is DONE!
22:57:18 | INFO | Encoding...
22:57:18 | INFO | Decoding...
22:57:18 | INFO | Generated image is DONE!
22:58:55 | INFO | Confidences: 0.508250
22:58:55 | INFO | Inference time: 0.455822
22:58:56 | INFO | Labeling image is DONE!
</pre></div>
</div>
<p>Из текста лога видно, что время обнаружения составило <strong>0.45 сек.</strong></p>
</section>
<section id="id88">
<h2>Пример использования программных функций библиотеки для утилиты обработки и визуальной разметки изображений модуля аугментации данных<a class="headerlink" href="#id88" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/labeler</span></code> библиотеки.</p>
<p>Код, вызывающий утилиту разметки, представлен ниже:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">inputDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;images&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Папка с изображениями</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">outputDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;labels&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Папка для сохранения разметки</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">YOLOv5LabelerProcessing</span><span class="p">(</span><span class="n">inputDir</span><span class="p">,</span><span class="w"> </span><span class="n">outputDir</span><span class="p">);</span>
</pre></div>
</div>
<p>Результат работы функции показан на рисунке А.4.22:</p>
<img alt="Размеченное изображение после работы функции" class="align-center" src="_images/figure416.jpg" />
<p>Рисунок А.4.22 – Размеченное изображение после работы функции</p>
<p>При запуске кода появляется интерактивное окно для мультиклассовой разметки изображений с возможностью сохранения и корректировки данных.</p>
</section>
<section id="id89">
<h2>Пример использования программных функций библиотеки для генерации новых изображений для формирования обучающей выборки нейросетевого модуля аугментации данных<a class="headerlink" href="#id89" title="Link to this heading"></a></h2>
<p>Для демонстрации работы библиотеки был реализован тестовый сценарий, обрабатывающий 10 исходных изображений. Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/augmentation</span></code> библиотеки.</p>
<p>Генерация аугментированных изображений обеспечивается тестовой программой, представленной ниже:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Тест пакетной аугментации</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">BatchAugmentationConfig</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">keep_original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">total_output_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">random_seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>

<span class="n">config</span><span class="p">.</span><span class="n">method_weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">FLIP_HORIZONTAL</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">ROTATE_IMAGE_90</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">BRIGHTNESS_CONTRAST_ADJUST</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">PERSPECTIVE_WARP</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="n">mrcv</span><span class="o">::</span><span class="n">AUGMENTATION_METHOD</span><span class="o">::</span><span class="n">COLOR_JITTER</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">},</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;</span><span class="w"> </span><span class="n">batchOutput</span><span class="p">;</span>
<span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">batchAugmentation</span><span class="p">(</span><span class="n">inputImagesCopy</span><span class="p">,</span><span class="w"> </span><span class="n">batchOutput</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">,</span>
<span class="w">                                </span><span class="s">&quot;files&quot;</span><span class="w"> </span><span class="n">FILE_SEPARATOR</span><span class="w"> </span><span class="s">&quot;batch_output&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>В результате выполнения было создано 100 новых изображений (включая 10 оригиналов). Распределение методов:</p>
<ul class="simple">
<li><p>20% горизонтальных отражений,</p></li>
<li><p>20% поворотов на 90°,</p></li>
<li><p>30% коррекций яркости/контраста,</p></li>
<li><p>20% перспективных искажений,</p></li>
<li><p>10% цветовых вариаций.</p></li>
</ul>
<p>Среднее время обработки составило около 15 мс на изображение (Intel Core i7-9700K).</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure417a1.jpg"><img alt="_images/figure417a1.jpg" class="align-center" src="_images/figure417a1.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure417a2.jpg"><img alt="_images/figure417a2.jpg" class="align-center" src="_images/figure417a2.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-even"><td><a class="reference internal image-reference" href="_images/figure417a3.jpg"><img alt="_images/figure417a3.jpg" class="align-center" src="_images/figure417a3.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure417a4.jpg"><img alt="_images/figure417a4.jpg" class="align-center" src="_images/figure417a4.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure417a5.jpg"><img alt="_images/figure417a5.jpg" class="align-center" src="_images/figure417a5.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure417a6.jpg"><img alt="_images/figure417a6.jpg" class="align-center" src="_images/figure417a6.jpg" style="width: 100%;" /></a>
</td>
</tr>
</tbody>
</table>
<p><strong>Подписи к изображениям:</strong>
- Верхний ряд: color_jitter
- Средний ряд: brightness
- Нижний ряд: perspective_transform</p>
<p>Рисунок А.4.23 – Часть результатов пакетной аугментации</p>
<p>В результате был автоматически сгенерирован лог-файл с детализацией операций. Менее подробный вывод о вероятностном распределении методов приведен ниже:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Batch</span> <span class="n">augmentation</span> <span class="n">completed</span><span class="o">.</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">90</span> <span class="n">images</span><span class="o">.</span>
  <span class="n">brightness</span><span class="p">:</span> <span class="mi">27</span> <span class="n">images</span> <span class="p">(</span><span class="mi">30</span><span class="o">%</span><span class="p">)</span>
  <span class="n">color_jitter</span><span class="p">:</span> <span class="mi">9</span> <span class="n">images</span> <span class="p">(</span><span class="mi">10</span><span class="o">%</span><span class="p">)</span>
  <span class="n">flip_h</span><span class="p">:</span> <span class="mi">18</span> <span class="n">images</span> <span class="p">(</span><span class="mi">20</span><span class="o">%</span><span class="p">)</span>
  <span class="n">perspective</span><span class="p">:</span> <span class="mi">18</span> <span class="n">images</span> <span class="p">(</span><span class="mi">20</span><span class="o">%</span><span class="p">)</span>
  <span class="n">rotate_90</span><span class="p">:</span> <span class="mi">18</span> <span class="n">images</span> <span class="p">(</span><span class="mi">20</span><span class="o">%</span><span class="p">)</span>
</pre></div>
</div>
<p>Визуальный анализ результатов подтвердил сохранение семантического содержания изображений, естественность примененных преобразований, отсутствие артефактов обработки.</p>
<p>Реализованная библиотека позволяет преобразовывать исходные изображения в их вариации с различными типами аугментации, что значительно увеличивает объем и разнообразие обучающих данных. Это особенно важно для глубокого обучения, где качество моделей напрямую зависит от репрезентативности тренировочного набора.</p>
<p>Архитектурные решения обеспечивают:</p>
<ul class="simple">
<li><p>простоту добавления новых методов,</p></li>
<li><p>возможность комбинирования методов,</p></li>
<li><p>высокую производительность благодаря оптимизациям OpenCV,</p></li>
<li><p>надежность за счет комплексной обработки ошибок и валидации параметров.</p></li>
</ul>
</section>
<section id="id90">
<h2>Пример использования программных функций библиотеки для комплексирования данных, поступающих от сенсоров различных видов<a class="headerlink" href="#id90" title="Link to this heading"></a></h2>
<p>Пример использования модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/sensorsfusion</span></code> библиотеки.</p>
<p>В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся входные данные для демонстрации работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/Images/L_ГГ_ММ_ДД_ЧЧ_ММ_СС.png</span></code> – изображения, поступившие с системы технического зрения подводного аппарата;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imuLog.csv</span></code> – файл с данными от инерциальных датчиков подводного аппарата;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usblLog.csv</span></code> – файл с данными от USBL модема;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fuseData.yaml</span></code> – итоговый файл с объединёнными данными.</p></li>
</ul>
<p>Основной метод <code class="docutils literal notranslate"><span class="pre">fuseSensorData</span></code> библиотеки принимает на вход пути к данным с указанных сенсоров, путь к директории для сохранения изображений, а также путь и имя файла, в который будут сохранены итоговые векторы. Последний параметр – флаг визуализации, при установленном значении выводится изображение с меткой и информацией о расположении устройства.</p>
<p>Пример вызова метода:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">fuseSensorData</span><span class="p">(</span>
<span class="w">    </span><span class="n">usblDataPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">imuDataPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">datasetPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">fuseTupleSavePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="nb">true</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Тестирование производилось на собранных в рамках натурных испытаний данных.</p>
<p>Формат данных с USBL-модема представлен следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">01</span> <span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">Y</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">Z</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">Azimuth</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="n">Local_depth</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">Remote_depth</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">Propagation_time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">rs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">rh</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">36</span> <span class="mf">1.846667</span> <span class="mf">26.369645</span> <span class="mf">2.460589</span> <span class="mf">4.000000</span> <span class="mf">0.000000</span> <span class="mf">2.000000</span> <span class="mf">0.017699</span> <span class="mf">26.548500</span> <span class="mf">26.473059</span>
</pre></div>
</div>
<p>Формат данных с IMU:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Date</span><span class="p">,</span><span class="n">AccelX</span><span class="p">,</span><span class="n">AccelY</span><span class="p">,</span><span class="n">AccelZ</span><span class="p">,</span><span class="n">GyroX</span><span class="p">,</span><span class="n">GyroY</span><span class="p">,</span><span class="n">GyroZ</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">9.80</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.002</span><span class="p">,</span><span class="mf">0.0003</span>
</pre></div>
</div>
<p>Комплексированные данные имеют следующее представление:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">timestamp</span><span class="p">:</span> <span class="mi">1739882496000</span>
<span class="n">accel</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">9.8100000000000005</span><span class="p">]</span>
<span class="n">gyro</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0011000000000000001</span><span class="p">,</span> <span class="mf">0.0020999999999999999</span><span class="p">,</span> <span class="mf">0.00020000000000000001</span><span class="p">]</span>
<span class="n">position</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">relativeCoords</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.8466670000000001</span><span class="p">,</span> <span class="mf">26.369644999999998</span><span class="p">,</span> <span class="mf">2.4605890000000001</span><span class="p">]</span>
<span class="n">azimuth</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">localDepth</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">remoteDepth</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">propagationTime</span><span class="p">:</span> <span class="mf">0.0176989995</span>
<span class="n">rs</span><span class="p">:</span> <span class="mf">26.5485001</span>
<span class="n">rh</span><span class="p">:</span> <span class="mf">26.4730587</span>
<span class="n">image</span><span class="p">:</span> <span class="n">L_25</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18_15</span><span class="o">-</span><span class="mi">41</span><span class="o">-</span><span class="mf">41.</span><span class="n">png</span>
</pre></div>
</div>
<p>На рисунке А.4.24 представлена визуализация результата с нанесённой меткой:</p>
<img alt="Визуализация результата работы функции" class="align-center" src="_images/figure418.jpg" />
<p>Рисунок А.4.24 – Визуализация результата</p>
</section>
<section id="id91">
<h2>Пример использования программных функций библиотеки для формирования вектора признаков по данным, поступающим от сенсоров различных видов<a class="headerlink" href="#id91" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/extractfeature</span></code> библиотеки.</p>
<p>В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> представлены выборки с объединёнными данными и изображениями от системы технического зрения:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/Images/L_ГГ_ММ_ДД_ЧЧ_ММ_СС.png</span></code> – изображения с системы технического зрения (СТЗ);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fuseData.yaml</span></code> – объединённые данные с нескольких сенсоров;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extractedData.yaml</span></code> – файл с итоговыми векторами признаков.</p></li>
</ul>
<p>Для выполнения основных функций модуля используется вызов метода <code class="docutils literal notranslate"><span class="pre">extractFeatureVector</span></code>, как показано ниже.</p>
<p>В качестве входных данных функция принимает:</p>
<ul class="simple">
<li><p>путь к файлу с объединёнными данными,</p></li>
<li><p>путь к директории изображений,</p></li>
<li><p>директорию для сохранения итогового вектора.</p></li>
</ul>
<p>Пример вызова функции:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">extractFeatureVector</span><span class="p">(</span>
<span class="w">    </span><span class="n">fuseTupleSavePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">datasetPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span>
<span class="w">    </span><span class="n">extracedFeaturesPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Ниже приведён фрагмент технического лога библиотеки при работе указанных функций:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">12</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">27</span> <span class="o">|</span> <span class="n">INFO</span> <span class="o">|</span> <span class="n">Loaded</span> <span class="mi">90</span> <span class="n">fused</span> <span class="n">data</span> <span class="n">entries</span> <span class="kn">from</span><span class="w"> </span><span class="nn">YAML</span>
<span class="mi">12</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">30</span> <span class="o">|</span> <span class="n">INFO</span> <span class="o">|</span> <span class="n">Saved</span> <span class="mi">90</span> <span class="n">feature</span> <span class="n">vectors</span> <span class="n">to</span> <span class="o">~</span>\<span class="n">mrcv</span>\<span class="n">build</span>\<span class="n">examples</span>\<span class="n">extractfeature</span>\<span class="n">files</span>\<span class="n">extractedData</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>Пример вектора извлечённых признаков:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.500923336</span><span class="p">,</span> <span class="mf">0.513184786</span><span class="p">,</span> <span class="mf">0.501230299</span><span class="p">,</span> <span class="mf">0.0111111114</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.00200000009</span><span class="p">,</span> <span class="mf">0.0176989995</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.500500023</span><span class="p">,</span> <span class="mf">0.990500093</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.500175059</span><span class="p">,</span> <span class="mf">0.500334203</span><span class="p">,</span> <span class="mf">0.500031829</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0898506716</span><span class="p">,</span> <span class="mf">0.172127262</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mf">1.3717422e-06</span><span class="p">,</span> <span class="mf">2.55976875e-06</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id92">
<h2>Пример использования программных функций библиотеки для интеграции функций библиотеки для системы технического зрения морского робототехнического комплекса с одиночной камерой<a class="headerlink" href="#id92" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/visionmodule</span></code> библиотеки.</p>
<p>Для демонстрации работы библиотеки реализован тестовый сценарий, в котором происходит:</p>
<ul class="simple">
<li><p>захват изображения с камеры,</p></li>
<li><p>предобработка,</p></li>
<li><p>детекция объекта,</p></li>
<li><p>получение маски,</p></li>
<li><p>определение курса на объект.</p></li>
</ul>
<p>Для визуализации работы библиотеки в примере выводятся все последовательные этапы обработки, как показано на рис. А.4.25.</p>
<img alt="Результаты работы модуля" class="align-center" src="_images/figure420.jpg" />
<p>Рисунок А.4.25 – Результаты работы модуля</p>
<p>Инициализация модуля осуществляется с помощью конструктора:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv_vision</span><span class="o">::</span><span class="n">VisionModule</span><span class="w"> </span><span class="nf">vision_module</span><span class="p">(</span>
<span class="w">    </span><span class="n">model_path</span><span class="p">,</span>
<span class="w">    </span><span class="n">class_path</span><span class="p">,</span>
<span class="w">    </span><span class="n">segmentor_weights</span><span class="p">,</span>
<span class="w">    </span><span class="n">camera_params</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Входные параметры конструктора:</p>
<ul class="simple">
<li><p><strong>model_path</strong> (const std::string&amp;) – путь к файлу модели детекции объектов;</p></li>
<li><p><strong>class_path</strong> (const std::string&amp;) – путь к файлу с названиями классов для детекции;</p></li>
<li><p><strong>segmentor_weights</strong> (const std::string&amp;) – путь к файлу весов сегментатора;</p></li>
<li><p><strong>camera_params</strong> (const std::string&amp;) – путь к файлу с параметрами калибровки камеры (матрица камеры, коэффициенты искажений).</p></li>
</ul>
</section>
<section id="id93">
<h2>Пример использования программных функций библиотеки для интеграции функций библиотеки для системы технического зрения морского робототехнического комплекса со стереокамерой<a class="headerlink" href="#id93" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/stereovisionmodule</span></code> библиотеки.</p>
<p>Для демонстрации работы библиотеки был реализован тестовый сценарий, в котором происходит захват изображения с двух камер, производится предобработка, детекция объекта, получение маски, определение курса на объект и построение карты диспаратности. Для визуализации работы библиотеки в примере сделан вывод всех последовательных этапов обработки как это показано на рис. А.4.26.</p>
<img alt="Результаты работы модуля" class="align-center" src="_images/figure421.jpg" />
<p>Рисунок А.4.26 – Результаты работы модуля</p>
<p>Для инициализации модуля используется конструктор:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv_vision</span><span class="o">::</span><span class="n">StereoVisionModule</span><span class="w"> </span><span class="nf">stereo_vision_module</span><span class="p">(</span>
<span class="w">    </span><span class="n">model_path</span><span class="p">,</span>
<span class="w">    </span><span class="n">class_path</span><span class="p">,</span>
<span class="w">    </span><span class="n">segmentor_weights</span><span class="p">,</span>
<span class="w">    </span><span class="n">stereo_params</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Входные параметры модуля:
– model_path (const std::string&amp;) – путь к файлу модели детекции объектов.
– class_path (const std::string&amp;) – путь к файлу с названиями классов для детекции.
– segmentor_weights (const std::string&amp;) – путь к файлу весов сегментатора.
– stereo_params (const std::string&amp;) – путь к файлу с параметрами калибровки камеры (матрица камеры, коэффициенты искажений).</p>
</section>
<section id="id94">
<h2>Пример использования программных функций библиотеки для определения пространственного расположения объектов интереса<a class="headerlink" href="#id94" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/3dscene</span></code> библиотеки. В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся необходимые входные данные для демонстрации работы функции:</p>
<ol class="arabic simple">
<li><p>Видео файлы (камера движется, меняя ракурс, снимая объекты интереса под разными углами и на разном расстоянии):</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="w"> </span><span class="n">videoPathCamera01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./files/SV_01_left_20.mp4&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// путь к видео файлу камера 01</span>
<span class="n">cv</span><span class="o">::</span><span class="n">String</span><span class="w"> </span><span class="n">videoPathCamera02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./files/SV_02_right_20.mp4&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// путь к видео файлу камера 02</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Путь к файлу параметров модели камеры:</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathToFileCameraParametrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./files/(66a)_(960p)_NewCamStereoModule_Air.xml&quot;</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Файлы модели нейронной сети для обнаружения и распознания объектов:</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filePathModelYoloNeuralNet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./files/NeuralNet/yolov5n-seg.onnx&quot;</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filePathClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;./files/NeuralNet/yolov5.names&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Обработка данных выполняется для каждого кадра видео последовательности.</p>
<p>Вывод результата работы примера программы производится в виде записи видео файлов и диагностической информации в лог-файле:</p>
<ul class="simple">
<li><p><strong>DisparityMap.mp4</strong> – видео файл с результатами построения карты диспаратности для поиска 3D точек сцены.</p></li>
<li><p><strong>3dSceene.mp4</strong> – видео файл с результатами поиска 3D точек сцены.</p></li>
<li><p><strong>Result.mp4</strong> – видео файл с результатами обнаружения и распознания объектов и результатами определения координат 3D точек в сегментах идентифицированных объектов.</p></li>
<li><p><strong>ResultPrimitives.mp4</strong> – видео файл с результатами оценки параметров и формы идентифицированных объектов в виде прорисовки проекций примитивов.</p></li>
</ul>
<img alt="Карта диспаратности" class="align-center" src="_images/figure422a.jpg" />
<p>Рисунок А.4.27 – Видео файл с результатами построения карты диспаратности</p>
<img alt="3D точки сцены" class="align-center" src="_images/figure422b.jpg" />
<p>Рисунок А.4.28 – Видео файл с результатами поиска 3D точек сцены</p>
<img alt="Обнаружение объектов" class="align-center" src="_images/figure422c.jpg" />
<p>Рисунок А.4.29 – Видео файл с результатами обнаружения и распознания объектов и результатами определения координат 3D точек в сегментах идентифицированных объектов</p>
<img alt="Примитивы" class="align-center" src="_images/figure422d.jpg" />
<p>Рисунок А.4.30 – Видео файл с результатами оценки параметров и формы идентифицированных объектов в виде прорисовки проекций примитивов</p>
<p>Ниже приведён фрагмент из log-файла библиотеки во время запуска примера использования:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>18:23:42 | INFO | === НОВЫЙ ЗАПУСК ===
18:23:43 | INFO | 1.1 Чтение видео из файла Камера 01 (успешно)
18:23:43 | INFO |     количество кадров файла Камера 01 =  324
...
18:31:29 | INFO | 11. Прорисовка примитивов идентифицированных объектов заданной формы  (успешно)
18:31:30 | INFO | 11.2 Запись результирующего видео примитивов (успешно)
</pre></div>
</div>
</section>
<section id="id95">
<h2>Пример использования программных функций библиотеки для реализации алгоритма оценки параметров идентифицированных объектов заданной формы<a class="headerlink" href="#id95" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/3dscene</span></code> библиотеки. В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся необходимые входные данные для демонстрации работы функции:</p>
<p><code class="docutils literal notranslate"><span class="pre">L1000.bmp</span></code>, <code class="docutils literal notranslate"><span class="pre">R1000.bmp</span></code> – набор исходных изображений;
<code class="docutils literal notranslate"><span class="pre">(66a)_(960p)_NewCamStereoModule_Air.xml</span></code> – xml-файл с параметрами камеры.</p>
<p>В примере использованы функции библиотеки для предыдущих задач:</p>
<ol class="arabic simple">
<li><p><strong>Функция предобработки изображений</strong>:
<code class="docutils literal notranslate"><span class="pre">preprocessingImage()</span></code> – функции предварительной обработки изображений (автоматическая коррекция контраста и яркости, резкости).</p></li>
<li><p><strong>Функция получения облаков 3D точек обнаруженных объектов по исходным изображениям</strong>:
<code class="docutils literal notranslate"><span class="pre">find3dPointsInObjectsSegments()</span></code> – функции для определения координат 3D точек в сегментах идентифицированных объектов и восстановления 3D сцены по двумерным изображениям.</p></li>
</ol>
<p>После получения облаков 3D точек объектов используются описанные выше функции для решения задачи оценки параметров идентифицированных объектов заданной формы:
<code class="docutils literal notranslate"><span class="pre">detectObjectPrimitives()</span></code>
<code class="docutils literal notranslate"><span class="pre">drawPrimitives()</span></code></p>
<p>Затем в примере реализован вывод результатов в виде изображений (через функцию библиотеки <code class="docutils literal notranslate"><span class="pre">showImage()</span></code>) и данных в лог-файле.
Вывод результата работы примера программы представлен на рис. А.4.31 – А.4.34:</p>
<img alt="Экспериментальный стенд" class="align-center" src="_images/figure423a.jpg" />
<p>Рисунок А.4.31 – Фотография экспериментального стенда и стереопара со стереокамеры</p>
<img alt="Обнаруженные объекты по z" class="align-center" src="_images/figure423b.jpg" />
<p>Рисунок А.4.32 – Результат обнаружения объектов с координатой по z (по дальности)</p>
<img alt="3D сцена и облака точек" class="align-center" src="_images/figure423c.jpg" />
<p>Рисунок А.4.33 – 3D сцена и облака 3D точек обнаруженных объектов</p>
<img alt="Проекции примитивов" class="align-center" src="_images/figure423d.jpg" />
<p>Рисунок А.4.34 – Изображение обнаруженных объектов и изображения с проекциями примитивов объектов</p>
<p>Ниже приведён фрагмент из log-файла библиотеки во время запуска примера использования:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>13:36:51 | INFO | === НОВЫЙ ЗАПУСК ===
13:36:51 | INFO | 1. Загрузка изображений из файла (успешно)
13:36:51 | INFO |     загружено изображение: ./files/L1000.bmp :: 960x600x3
...
13:36:53 | INFO | 6.5 Проекция 3D сцены на 2D изображение для вывода на экран (успешно)
</pre></div>
</div>
<p>На рис. А.4.31 – А.4.34 и из текста лога можно сделать вывод, что осуществлена оценка параметров идентифицированных объектов заданной формы.</p>
</section>
<section id="id96">
<h2>Пример использования программных функций библиотеки для предварительной обработки изображений (удаление шумов, морфологическая обработка)<a class="headerlink" href="#id96" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/morphologyImage</span></code> библиотеки. В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся необходимые входные данные для демонстрации работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">closing.png</span></code> – пример изображения для наглядной демонстрации морфологического замыкания;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gradient.png</span></code> – пример для наглядной демонстрации выделения границ объектов на изображении;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">j.png</span></code> – пример изображения для наглядной демонстрации морфологической эрозии;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opening.png</span></code> – пример изображения для наглядной демонстрации морфологического размыкания.</p></li>
</ul>
<p>В качестве выходных данных функция создает файл <code class="docutils literal notranslate"><span class="pre">out.png</span></code>, которое является результирующим изображением.
Примеры работающих алгоритмов обработки изображений представлены на рис. А.4.35.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure424a1.jpg"><img alt="_images/figure424a1.jpg" src="_images/figure424a1.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure424a2.jpg"><img alt="_images/figure424a2.jpg" src="_images/figure424a2.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Изображение до обработки</p></td>
<td><p>Изображение после применения морфологического размыкания</p></td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure424a3.jpg"><img alt="_images/figure424a3.jpg" src="_images/figure424a3.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure424a4.jpg"><img alt="_images/figure424a4.jpg" src="_images/figure424a4.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Изображение до обработки</p></td>
<td><p>Изображение после применения морфологического градиента</p></td>
</tr>
</tbody>
</table>
<p>Рисунок А.4.35 – Демонстрация работы алгоритмов морфологической обработки</p>
<p>Для запуска примера необходимо использовать основную функцию <code class="docutils literal notranslate"><span class="pre">morphologyImage</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">morphologyImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">METOD_MORF</span><span class="o">::</span><span class="n">OPEN</span><span class="p">,</span><span class="w"> </span><span class="n">morph_size</span><span class="p">);</span>
</pre></div>
</div>
<p>В качестве входных параметров функция принимает параметры:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv::Mat</span> <span class="pre">image</span></code> – исходное изображение;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::string</span> <span class="pre">out</span></code> – путь для нового файла;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mrcv::METOD_MORF</span> <span class="pre">metod</span></code> – метод преобразования;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">morph_size</span></code> – размер преобразования;</p></li>
</ul>
<p>Результатом работы функции будет создан новый файл изображения с примененными морфологическими преобразованиями.</p>
</section>
<section id="id97">
<h2>Пример использования программных функций библиотеки для анализа изображений для выявления изменения состояния подводных археологических объектов<a class="headerlink" href="#id97" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещен в папке <code class="docutils literal notranslate"><span class="pre">examples/compareImages</span></code> библиотеки. В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся два тестовых файла для демонстрации работы функции.</p>
<p>В качестве входных данных функция возвращает значение в процентном соотношении, насколько эти два изображения идентичны. Для запуска примера необходимо использовать основную функцию <code class="docutils literal notranslate"><span class="pre">compareImages</span></code>.</p>
<p>В качестве входных параметров функция принимает параметры:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv::Mat</span> <span class="pre">img1</span></code> – первое изображение;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv::Mat</span> <span class="pre">img2</span></code> – второе изображение;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">methodCompare</span></code> – метод сравнения.</p></li>
</ul>
<p>Пример использования функции:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">compareImages</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span><span class="w"> </span><span class="n">img2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Результатом работы функции будет дан числовой ответ от 0 до 1:</p>
<p><strong>Диапазон выходных значений:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1.0</span></code> – полная корреляция (гистограммы идентичны);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0.0</span></code> – отсутствие линейной зависимости.</p></li>
</ul>
<p>На рис. А.4.36 представлены тестовые изображения, использовавшиеся для тестирования работы функции.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/figure425a.jpg"><img alt="_images/figure425a.jpg" src="_images/figure425a.jpg" style="width: 100%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/figure425b.jpg"><img alt="_images/figure425b.jpg" src="_images/figure425b.jpg" style="width: 100%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Исходное изображение</p></td>
<td><p>Измененное изображение</p></td>
</tr>
</tbody>
</table>
<p>Рисунок А.4.36 – Исходные изображения для тестирования функции сравнения изображений</p>
<p>Результат работы алгоритма показал коэффициент корреляции <strong>0.94</strong> схожести.</p>
</section>
<section id="id98">
<h2>Пример использования программных функций библиотеки для реализации алгоритма оценки геометрических размеров (габаритов) видимой части идентифицированных объектов<a class="headerlink" href="#id98" title="Link to this heading"></a></h2>
<p>Пример использования функций модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/geometry</span></code> библиотеки.</p>
<p>В соответствии со структурой информационного кадра облака 3D точек в качестве входных данных использовались файлы в текстовом формате, в котором данные разделены с помощью табуляции. Фрагмент файла с данными приведен на рис. А.4.38.</p>
<img alt="Исходный файл облака 3D точек" class="align-center" src="_images/figure426a.jpg" />
<p>Рисунок А.4.38 – Исходный файл с данными облака 3D точек</p>
<p>Для загрузки данных из облака 3D точек и парсинга данных в соответствующие структуры использовалась функция</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">* @brief Загрузка данных облака 3D точек для расчета геометрии объекта</span>
<span class="cm">* @param pathtofile - полный путь к файлу с данными</span>
<span class="cm">* @param cluster - номер кластера для выборки (по умолчанию = 0)</span>
<span class="cm">* @param rows - количество строк cvMat объекта (по умолчанию = 0)</span>
<span class="cm">* @param cols - количество столбцов cvMat объекта (по умолчанию = 0)</span>
<span class="cm">* @param norm - флаг нормализации данных, если true, данные будут нормализованы (по умолчанию = false)</span>
<span class="cm">* @return std::vector&lt;Cloud3DItem&gt; вектор точек 3D облака</span>
<span class="cm">*/</span>
<span class="n">MRCV_EXPORT</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Cloud3DItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">geometryLoadData</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">pathtofile</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<p>Выход функции – это вектор значений в формате структуры Cloud3DItem, имеющей вид:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">Cloud3DItem</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">U</span><span class="p">;</span><span class="w">      </span><span class="c1">// Координата X на изображении</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">V</span><span class="p">;</span><span class="w">      </span><span class="c1">// Координата Y на изображении</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">X</span><span class="p">;</span><span class="w">   </span><span class="c1">// Координата X в пространстве</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">Y</span><span class="p">;</span><span class="w">   </span><span class="c1">// Координата Y в пространстве</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">Z</span><span class="p">;</span><span class="w">   </span><span class="c1">// Координата X в пространстве</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w">      </span><span class="c1">// Цвет токчи R</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">G</span><span class="p">;</span><span class="w">      </span><span class="c1">// Цвет токчи G</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">B</span><span class="p">;</span><span class="w">      </span><span class="c1">// Цвет токчи B</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">C</span><span class="p">;</span><span class="w">      </span><span class="c1">// Номер кластера</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Непосредственный расчет геометрических размеров (габаритов) видимой части идентифицированного объекта осуществляется с помощью функции geometryCalculateSize</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">* @brief Вычисление геометрических характеристик объекта, заданного облаком 3D-точек</span>
<span class="cm">* @param std::vector&lt;Cloud3DItem&gt; cloud3D - облако 3D-точек объекта</span>
<span class="cm">* @param double* l - длина bounding box</span>
<span class="cm">* @param double* w - ширина bounding box</span>
<span class="cm">* @param double* h - высота bounding box</span>
<span class="cm">* @param double* length - длина осевой линии</span>
<span class="cm">* @param double* width - ширина осевой линии</span>
<span class="cm">* @param double* distance - растояние от камеры до центра масс объекта</span>
<span class="cm">* @return int - код ошибки {0 - нет ошибок}</span>
<span class="cm">*/</span>
<span class="n">MRCV_EXPORT</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">geometryCalculateSize</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Cloud3DItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cloud3D</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="p">);</span>
</pre></div>
</div>
<p>Пример вызова функций приведен ниже, соответствующий пример использования расположен в папке <code class="docutils literal notranslate"><span class="pre">examples/geometry/main.cpp</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Путь к файлу с данными</span>
<span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span><span class="w"> </span><span class="n">currentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">current_path</span><span class="p">();</span>
<span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;points3D.dat&quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span><span class="w"> </span><span class="n">pathToFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentPath</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fileName</span><span class="p">;</span>

<span class="c1">// Загрузка исходных данных</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">mrcv</span><span class="o">::</span><span class="n">Cloud3DItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cloud3D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrcv</span><span class="o">::</span><span class="n">geometryLoadData</span><span class="p">(</span><span class="n">pathToFile</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>

<span class="c1">// Рассчет геометрии точек</span>
<span class="kt">double</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">Length</span><span class="p">,</span><span class="w"> </span><span class="n">Width</span><span class="p">,</span><span class="w"> </span><span class="n">Distance</span><span class="p">;</span>
<span class="n">mrcv</span><span class="o">::</span><span class="n">geometryCalculateSize</span><span class="p">(</span><span class="n">cloud3D</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Length</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Width</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Distance</span><span class="p">);</span>
</pre></div>
</div>
<p>Результат работы функции приведен на рис. А.4.39 – А.4.40</p>
<img alt="Консольный вывод" class="align-center" src="_images/figure426b.jpg" />
<p>Рисунок А.4.39 – Консольный вывод расчетных значений оценки геометрических размеров (габаритов) объекта интереса</p>
<img alt="Bounding box объекта" class="align-center" src="_images/figure426c.jpg" />
<p>Рисунок А.4.40 – Визуализация параллелепипеда, в который может быть вписано облако точек объекта интереса</p>
<p>В случае, если объект интереса представляет из себя вытянутую фигуру (например фрагмент трубы подводного газопровода), как это показано на рис. А.4.41, оценку размеров нужно делать на основании значений параметров <code class="docutils literal notranslate"><span class="pre">length</span></code> и <code class="docutils literal notranslate"><span class="pre">width</span></code>.</p>
<img alt="Bounding box трубы" class="align-center" src="_images/figure426d.jpg" />
<p>Рисунок А.4.41 – Визуализация параллелепипеда, для облака точек фрагмента трубы подводного газопровода</p>
<p>Серия экспериментов определения геометрических габаритов эталонных объектов с помощью разработанных функций, проведённых в опытовом бассейне, показала, что точность определения геометрических размеров варьировалась в диапазоне 90–95%.</p>
</section>
<section id="arm">
<h2>Пример использования адаптированных программные функций библиотеки для детекции и идентификации объектов с использованием процессоров ARM<a class="headerlink" href="#arm" title="Link to this heading"></a></h2>
<p>Пример использования модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">/python/examples/detectorautotrain</span></code> библиотеки. В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся входные данные для демонстрации работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">autodetector.pt</span></code> – обученная модель в формате YOLO4_tiny;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">voc_classes.txt</span></code> – текстовый файл с именами классов объектов интереса;</p></li>
<li><p>изображения в формате <code class="docutils literal notranslate"><span class="pre">.jpg</span></code> для обучения и валидации модели;</p></li>
<li><p>файлы меток классов к изображениям в формате <code class="docutils literal notranslate"><span class="pre">.xml</span></code>.</p></li>
</ul>
<p>Для выполнения основных функций модуля используются вызовы методов класса <code class="docutils literal notranslate"><span class="pre">Detector</span></code>, как это показано ниже. Сперва необходимо объявление экземпляра класса:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">detector</span> <span class="o">=</span> <span class="n">mrcv</span><span class="o">.</span><span class="n">Detector</span><span class="p">()</span>
</pre></div>
</div>
<p>после чего вызывается метод:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">detector</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nameListPath</span><span class="p">)</span>
</pre></div>
</div>
<p>для инициализации модели.</p>
<p>В качестве входных данных функция инициализации принимает следующие аргументы:
- <code class="docutils literal notranslate"><span class="pre">width</span> <span class="pre">×</span> <span class="pre">height</span></code> – разрешение входящего в модель изображения после масштабирования;
- <code class="docutils literal notranslate"><span class="pre">nameListPath</span></code> – путь к текстовому файлу с именами классов объектов интереса.</p>
<p>Основной метод <code class="docutils literal notranslate"><span class="pre">AutoTrain</span></code> библиотеки принимает на вход путь к обучающей и валидационной выборкам, тип изображения в этих (например, <code class="docutils literal notranslate"><span class="pre">.jpg</span></code>, <code class="docutils literal notranslate"><span class="pre">.png</span></code> и другие), векторы значений гиперпараметров: количества эпох, размеров батча, скорости обучения, а также путь к предварительно обученной и сохранению итоговой моделей.</p>
<p>Пример использования методов:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">Detector</span>

<span class="c1"># Пути к файлам</span>
<span class="n">images_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/images&quot;</span>         <span class="c1"># Папка с изображениями (.jpg)</span>
<span class="n">names_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/xml&quot;</span>             <span class="c1"># Путь для меток классов</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/autodetector.pt&quot;</span> <span class="c1"># Путь к обученной модели YOLO4_tiny</span>
<span class="n">class_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/voc_classes.txt&quot;</span> <span class="c1"># Путь к файлу с именами классов</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">mrcv</span><span class="o">.</span><span class="n">Detector</span><span class="p">()</span>
<span class="n">detector</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="n">class_path</span><span class="p">)</span>
<span class="n">detector</span><span class="o">.</span><span class="n">AutoTrain</span><span class="p">(</span>
    <span class="n">images_path</span><span class="p">,</span>        <span class="c1"># Папка с изображениями и метками</span>
    <span class="s2">&quot;.jpg&quot;</span><span class="p">,</span>             <span class="c1"># Расширение изображений</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>       <span class="c1"># Количество эпох</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>             <span class="c1"># Размер батча</span>
    <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">1.0e-4</span><span class="p">],</span>    <span class="c1"># Скорость обучения</span>
    <span class="n">model_path</span><span class="p">,</span>         <span class="c1"># Путь к предобученной модели</span>
    <span class="n">names_path</span>          <span class="c1"># Путь для сохранения итоговой модели</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cuda">
<h2>Пример использования адаптированных программных функций библиотеки для детекции и идентификации объектов с использованием технологии CUDA<a class="headerlink" href="#cuda" title="Link to this heading"></a></h2>
<p>Пример использования модуля размещён в папке <code class="docutils literal notranslate"><span class="pre">examples/detectorautotrain</span></code> библиотеки. В папке <code class="docutils literal notranslate"><span class="pre">files</span></code> находятся входные данные для демонстрации работы функции:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">autodetector.pt</span></code> – обученная модель в формате YOLO4_tiny;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">voc_classes.txt</span></code> – текстовый файл с именами классов объектов интереса;</p></li>
<li><p>изображения в формате <code class="docutils literal notranslate"><span class="pre">.jpg</span></code> для обучения и валидации модели;</p></li>
<li><p>файлы меток классов к изображениям в формате <code class="docutils literal notranslate"><span class="pre">.xml</span></code>.</p></li>
</ul>
<p>Для выполнения основных функций модуля используются вызовы методов класса <code class="docutils literal notranslate"><span class="pre">mrcv::Detector</span></code>, как это показано ниже. Сперва необходимо объявление экземпляра класса:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="w"> </span><span class="n">detector</span><span class="p">;</span>
</pre></div>
</div>
<p>после чего вызывается метод:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">detector</span><span class="p">.</span><span class="n">InitializeCuda</span><span class="p">(</span><span class="n">devID</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">nameListPath</span><span class="p">);</span>
</pre></div>
</div>
<p>для инициализации модели.</p>
<p><strong>Входные параметры метода инициализации:</strong>
- <code class="docutils literal notranslate"><span class="pre">devID</span></code> – ID устройства, на котором будет исполняться функционал модели. <code class="docutils literal notranslate"><span class="pre">ID</span> <span class="pre">&lt;</span> <span class="pre">0</span></code> – исполнение на CPU, <code class="docutils literal notranslate"><span class="pre">ID</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> – исполнение на GPU с выбором конкретного устройства согласно его ID в системе;
- <code class="docutils literal notranslate"><span class="pre">width</span> <span class="pre">×</span> <span class="pre">height</span></code> – разрешение входящего в модель изображения после масштабирования;
- <code class="docutils literal notranslate"><span class="pre">nameListPath</span></code> – путь к текстовому файлу с именами классов объектов интереса.</p>
<p>Основной метод <code class="docutils literal notranslate"><span class="pre">AutoTrain</span></code> библиотеки принимает на вход:
- путь к обучающей и валидационной выборкам,
- тип изображения (например, <code class="docutils literal notranslate"><span class="pre">.jpg</span></code>, <code class="docutils literal notranslate"><span class="pre">.png</span></code> и др.),
- векторы значений гиперпараметров: количества эпох, размеров батча, скорости обучения,
- путь к предварительно обученной модели,
- путь для сохранения итоговой модели.</p>
<p>Пример использования методов:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mrcv</span><span class="o">::</span><span class="n">Detector</span><span class="w"> </span><span class="n">detector</span><span class="p">;</span>
<span class="n">detector</span><span class="p">.</span><span class="n">InitializeCuda</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">416</span><span class="p">,</span><span class="w"> </span><span class="mi">416</span><span class="p">,</span><span class="w"> </span><span class="n">vocClassesPath</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
<span class="n">detector</span><span class="p">.</span><span class="n">AutoTrain</span><span class="p">(</span>
<span class="w">    </span><span class="n">datasetPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span><span class="w">      </span><span class="c1">// Путь к обучающему датасету</span>
<span class="w">    </span><span class="s">&quot;.jpg&quot;</span><span class="p">,</span><span class="w">                      </span><span class="c1">// Тип изображений</span>
<span class="w">    </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">},</span><span class="w">                </span><span class="c1">// Количество эпох</span>
<span class="w">    </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">},</span><span class="w">                      </span><span class="c1">// Размер батча</span>
<span class="w">    </span><span class="p">{</span><span class="mf">0.001</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0E-4F</span><span class="p">},</span><span class="w">            </span><span class="c1">// Скорость обучения</span>
<span class="w">    </span><span class="n">pretrainedModelPath</span><span class="p">.</span><span class="n">u8string</span><span class="p">(),</span><span class="w">  </span><span class="c1">// Путь к предобученной модели</span>
<span class="w">    </span><span class="n">modelSavePath</span><span class="p">.</span><span class="n">u8string</span><span class="p">()</span><span class="w">         </span><span class="c1">// Путь сохранения итоговой модели</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Адаптация функций библиотеки под CUDA позволила достичь <strong>ускорения вычислений до 6–8 раз</strong> по сравнению с выполнением на CPU, обеспечив выполнение требований технического задания.
<strong>Рекомендуется</strong> использовать видеокарты с объёмом памяти не менее <strong>8 ГБ</strong> и <strong>регулярно обновлять зависимости</strong> для поддержки новых версий CUDA.</p>
</section>
</section>
<section id="id99">
<h1>Демонстрационные примеры на Python<a class="headerlink" href="#id99" title="Link to this heading"></a></h1>
<section id="objcourse-py">
<h2>Описание скрипта objcourse.py: определение курса на объект<a class="headerlink" href="#objcourse-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">objcourse.py</span></code> демонстрирует использование класса <code class="docutils literal notranslate"><span class="pre">ObjCourse</span></code> для подсчета количества объектов интереса на изображении и расчета углового курса на объект. Этот класс предназначен для задач, связанных с обнаружением объектов и навигацией роботизированных систем, таких как подводные или надводные аппараты.</p>
<p>Класс <code class="docutils literal notranslate"><span class="pre">ObjCourse</span></code> инициализируется с путями к файлу модели (в формате <code class="docutils literal notranslate"><span class="pre">ONNX</span></code>) и файлу с именами классов, определяющими, какие объекты могут быть обнаружены. Метод <code class="docutils literal notranslate"><span class="pre">get_object_count</span></code> принимает изображение в формате <code class="docutils literal notranslate"><span class="pre">cv::Mat</span></code> и возвращает количество обнаруженных объектов. Метод <code class="docutils literal notranslate"><span class="pre">get_object_course</span></code> вычисляет угловую поправку курса на объект с учетом горизонтального разрешения камеры (в пикселях) и угла обзора камеры (в градусах). Если на изображении обнаружено несколько объектов, курс рассчитывается на объект с максимальной площадью.</p>
<p>Методы используют предварительно обученную модель (например, основанную на архитектуре <code class="docutils literal notranslate"><span class="pre">YOLOv5</span></code>), что обеспечивает высокую точность обнаружения. Логирование в коде фиксирует пути к файлам и результаты работы методов, что упрощает отладку и контроль выполнения.</p>
<p>Эта функциональность применима в задачах поиска объектов (например, кораблей) и автоматического управления роботизированными аппаратами для сопровождения цели.</p>
<p>Пример использования</p>
<p>Пример демонстрирует создание экземпляра класса <code class="docutils literal notranslate"><span class="pre">ObjCourse</span></code>, загрузку изображения, подсчет объектов и расчет курса:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">ObjCourse</span>

<span class="c1"># Настройка логирования</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Пути к файлам</span>
<span class="n">model_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;files/ship.onnx&quot;</span><span class="p">)</span>
<span class="n">class_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;files/ship.names&quot;</span><span class="p">)</span>
<span class="n">ship_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;files/ship.bmp&quot;</span><span class="p">)</span>

<span class="n">current_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">current_path</span> <span class="o">/</span> <span class="n">model_file</span>
<span class="n">class_path</span> <span class="o">=</span> <span class="n">current_path</span> <span class="o">/</span> <span class="n">class_file</span>
<span class="n">ship_path</span> <span class="o">=</span> <span class="n">current_path</span> <span class="o">/</span> <span class="n">ship_file</span>

<span class="c1"># Создание экземпляра класса</span>
<span class="n">objcourse</span> <span class="o">=</span> <span class="n">ObjCourse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">class_path</span><span class="p">))</span>

<span class="c1"># Загрузка изображения</span>
<span class="n">frame_ship</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ship_path</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
<span class="k">if</span> <span class="n">frame_ship</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load image: </span><span class="si">{</span><span class="n">ship_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Подсчет объектов</span>
<span class="n">obj_count</span> <span class="o">=</span> <span class="n">objcourse</span><span class="o">.</span><span class="n">get_object_count</span><span class="p">(</span><span class="n">frame_ship</span><span class="p">)</span>

<span class="c1"># Расчет курса</span>
<span class="n">obj_angle</span> <span class="o">=</span> <span class="n">objcourse</span><span class="o">.</span><span class="n">get_object_course</span><span class="p">(</span><span class="n">frame_ship</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

<span class="c1"># Вывод результатов</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Файл модели: </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Файл классов: </span><span class="si">{</span><span class="n">class_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Входное изображение: </span><span class="si">{</span><span class="n">ship_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Обнаружено объектов: </span><span class="si">{</span><span class="n">obj_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Курс на цель в градусах: </span><span class="si">{</span><span class="n">obj_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Пример вывода</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2024-10-01 10:00:00 - Файл модели: /path/to/files/ship.onnx
2024-10-01 10:00:00 - Файл классов: /path/to/files/ship.names
2024-10-01 10:00:00 - Входное изображение: /path/to/files/ship.bmp
2024-10-01 10:00:00 - Обнаружено объектов: 1
2024-10-01 10:00:00 - Курс на цель в градусах: 17.0
</pre></div>
</div>
<p>В данном случае обнаружен один объект, а курсовая невязка составила 17 градусов вправо относительно центра кадра.</p>
</section>
<section id="yolov5-py">
<h2>Описание скрипта <code class="docutils literal notranslate"><span class="pre">yolov5.py</span></code><a class="headerlink" href="#yolov5-py" title="Link to this heading"></a></h2>
<p>Предоставляет утилиты для работы с моделями YOLOv5 — популярной архитектуры для обнаружения объектов, отличающейся высокой скоростью и точностью. Эти функции предназначены для подготовки данных и конфигураций, необходимых для обучения или использования моделей YOLOv5.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">yolov5_labeler_processing</span></code>: обрабатывает изображения или аннотации, принимая пути к входному и выходному каталогам. Используется для подготовки данных в формате, совместимом с YOLOv5.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yolov5_generate_config</span></code>: генерирует конфигурационный файл (например, <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>), указывая тип модели (например, <code class="docutils literal notranslate"><span class="pre">YOLOv5s</span></code>), путь к файлу и количество классов.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yolov5_generate_hyperparameters</span></code>: создаёт файл гиперпараметров (например, <code class="docutils literal notranslate"><span class="pre">hyperparameters.yaml</span></code>), определяя параметры обучения, такие как размер изображения и другие настройки.</p></li>
</ul>
<p>Эти функции упрощают настройку моделей YOLOv5 для специфических задач обнаружения объектов, таких как классификация кораблей или других объектов интереса.</p>
<p>Пример использования</p>
<p>Пример показывает, как использовать утилиты для подготовки данных и конфигураций:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">yolov5_labeler_processing</span><span class="p">,</span>
    <span class="n">yolov5_generate_config</span><span class="p">,</span>
    <span class="n">yolov5_generate_hyperparameters</span><span class="p">,</span>
    <span class="n">YOLOv5Model</span>
<span class="p">)</span>

<span class="c1"># Обработка данных для маркировки</span>
<span class="n">yolov5_labeler_processing</span><span class="p">(</span><span class="s2">&quot;path/to/input/dir&quot;</span><span class="p">,</span> <span class="s2">&quot;path/to/output/dir&quot;</span><span class="p">)</span>

<span class="c1"># Генерация конфигурационного файла</span>
<span class="n">yolov5_generate_config</span><span class="p">(</span><span class="n">YOLOv5Model</span><span class="o">.</span><span class="n">YOLOv5s</span><span class="p">,</span> <span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Генерация файла гиперпараметров</span>
<span class="n">yolov5_generate_hyperparameters</span><span class="p">(</span><span class="n">YOLOv5Model</span><span class="o">.</span><span class="n">YOLOv5s</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="s2">&quot;hyperparameters.yaml&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом примере:</p>
<ul class="simple">
<li><p>Обрабатываются данные из входного каталога и сохраняются в выходной.</p></li>
<li><p>Создаётся конфигурация для модели YOLOv5s с 10 классами.</p></li>
<li><p>Генерируются гиперпараметры для обучения с разрешением изображения 640×640.</p></li>
</ul>
</section>
<section id="roi-py">
<h2>Описание Скрипта <code class="docutils literal notranslate"><span class="pre">roi.py</span></code><a class="headerlink" href="#roi-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">roi.py</span></code> реализует систему предсказания движения объекта и оптимизации области интереса (ROI) для эффективного отслеживания. Используются классы <code class="docutils literal notranslate"><span class="pre">Predictor</span></code> и <code class="docutils literal notranslate"><span class="pre">Optimizer</span></code>.</p>
<ul class="simple">
<li><p>Класс <code class="docutils literal notranslate"><span class="pre">Predictor</span></code>: обучается на основе LSTM-сети для предсказания следующей позиции объекта по его предыдущим координатам. Метод <code class="docutils literal notranslate"><span class="pre">train_lstm_net</span></code> обучает модель, а <code class="docutils literal notranslate"><span class="pre">predict_next_coordinate</span></code> возвращает прогнозируемую позицию.</p></li>
<li><p>Класс <code class="docutils literal notranslate"><span class="pre">Optimizer</span></code>: оптимизирует размер ROI, анализируя движение объекта и отклонение предсказаний, чтобы минимизировать вычислительные затраты, сохраняя объект в кадре.</p></li>
</ul>
<p>Код симулирует движение объекта, генерируя координаты, обучает предиктор, а затем в реальном времени предсказывает позиции и корректирует ROI. Это полезно для систем слежения, таких как видеонаблюдение или автономное вождение.</p>
<p>Пример использования</p>
<p>Ниже приведён пример, демонстрирующий обучение предиктора и оптимизацию ROI:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">Predictor</span><span class="p">,</span> <span class="n">Optimizer</span><span class="p">,</span> <span class="n">generate_coordinates</span><span class="p">,</span> <span class="n">extract_roi</span><span class="p">,</span> <span class="n">to_point</span>

<span class="c1"># Инициализация параметров</span>
<span class="n">img_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1440</span><span class="p">,</span> <span class="mi">1080</span><span class="p">)</span>
<span class="n">predictor_train_points_num</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">object_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">layers_num</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">predictor</span> <span class="o">=</span> <span class="n">Predictor</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">layers_num</span><span class="p">,</span> <span class="n">predictor_train_points_num</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>

<span class="c1"># Генерация координат для обучения</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_coordinates</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">img_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">predictor_train_points_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

<span class="c1"># Обучение предиктора</span>
<span class="n">predictor</span><span class="o">.</span><span class="n">train_lstm_net</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

<span class="c1"># Симуляция и визуализация ROI</span>
<span class="n">img_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="n">real_coordinate</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">predicted_coordinate</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict_next_coordinate</span><span class="p">()</span>
<span class="n">roi_size</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize_roi_size</span><span class="p">(</span>
    <span class="n">real_coordinate</span><span class="p">,</span>
    <span class="n">predicted_coordinate</span><span class="p">,</span>
    <span class="n">object_size</span><span class="p">,</span>
    <span class="n">predictor</span><span class="o">.</span><span class="n">get_moving_average_deviation</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">roi</span> <span class="o">=</span> <span class="n">extract_roi</span><span class="p">(</span><span class="n">img_r</span><span class="p">,</span> <span class="n">to_point</span><span class="p">(</span><span class="n">predicted_coordinate</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">roi_size</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">roi_size</span><span class="p">)))</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;ROI Example translating to Пример ROI&quot;</span><span class="p">,</span> <span class="n">roi</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</pre></div>
</div>
<p>В данном примере:</p>
<ul class="simple">
<li><p>Обучается предиктор для предсказания координат объекта.</p></li>
<li><p>Предсказывается следующая позиция объекта.</p></li>
<li><p>Оптимизируется размер области интереса (ROI).</p></li>
<li><p>Визуализируется полученная область на изображении.</p></li>
</ul>
</section>
<section id="vae-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">vae.py</span></code><a class="headerlink" href="#vae-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">vae.py</span></code> демонстрирует использование вариационного автоэнкодера (VAE) для генерации синтетических изображений и их полуавтоматической маркировки. VAE — это генеративная модель, создающая данные, подобные обучающему набору.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">neural_network_augmentation_as_mat</span></code>: генерирует аугментированное изображение на основе входных данных.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semi_automatic_labeler_image</span></code>: использует модель (например, ONNX) для автоматической маркировки сгенерированного изображения.</p></li>
</ul>
<p>Этот подход расширяет набор данных для задач машинного обучения, где исходных данных недостаточно, например, для обнаружения кораблей.</p>
<p>Пример использования</p>
<p>Ниже приведён пример генерации и маркировки изображения:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">neural_network_augmentation_as_mat</span><span class="p">,</span> <span class="n">semi_automatic_labeler_image</span>

<span class="n">images_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/images&quot;</span>
<span class="n">result_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/result&quot;</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/ship.onnx&quot;</span>
<span class="n">class_path</span> <span class="o">=</span> <span class="s2">&quot;vae/files/ship.names&quot;</span>

<span class="n">height</span> <span class="o">=</span> <span class="mi">640</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">640</span>

<span class="c1"># Генерация изображения</span>
<span class="n">genImage</span> <span class="o">=</span> <span class="n">neural_network_augmentation_as_mat</span><span class="p">(</span><span class="n">images_path</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mf">3E-4</span><span class="p">)</span>

<span class="c1"># Преобразование и сохранение</span>
<span class="n">colorGenImage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">genImage</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2BGR</span><span class="p">)</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="s2">&quot;generated.jpg&quot;</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">colorGenImage</span><span class="p">)</span>

<span class="c1"># Маркировка</span>
<span class="n">semi_automatic_labeler_image</span><span class="p">(</span><span class="n">colorGenImage</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="n">result_path</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">class_path</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом примере:</p>
<ul class="simple">
<li><p>Генерируется изображение размером 640×640.</p></li>
<li><p>Преобразуется в цветное изображение и сохраняется.</p></li>
<li><p>Выполняется полуавтоматическая маркировка с использованием модели.</p></li>
</ul>
</section>
<section id="segmentation-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">segmentation.py</span></code><a class="headerlink" href="#segmentation-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">segmentation.py</span></code> реализует сегментацию изображений с использованием класса <code class="docutils literal notranslate"><span class="pre">Segmentor</span></code>. Сегментация разделяет изображение на регионы, выделяя объекты (например, корабли) от фона.</p>
<p>Класс <code class="docutils literal notranslate"><span class="pre">Segmentor</span></code> инициализируется с параметрами: количеством классов, размерами изображения, именами классов, архитектурой и путями к весам. Метод <code class="docutils literal notranslate"><span class="pre">predict</span></code> выполняет сегментацию для указанного класса (например, <code class="docutils literal notranslate"><span class="pre">&quot;ship&quot;</span></code>).</p>
<p>Эта функциональность важна для задач локализации объектов и анализа сцены, где требуется пиксельная точность.</p>
<p>Пример использования</p>
<p>Ниже приведён пример сегментации изображения:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">Segmentor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;segmentation/file/images/test/43.jpg&quot;</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Не удалось загрузить изображение: </span><span class="si">{</span><span class="n">image_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Создание и инициализация сегментатора</span>
<span class="n">segmentor</span> <span class="o">=</span> <span class="n">Segmentor</span><span class="p">()</span>
<span class="n">segmentor</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;ship&quot;</span><span class="p">],</span> <span class="s2">&quot;resnet34&quot;</span><span class="p">,</span> <span class="s2">&quot;segmentation/file/weights/resnet34.pt&quot;</span><span class="p">)</span>
<span class="n">segmentor</span><span class="o">.</span><span class="n">load_weight</span><span class="p">(</span><span class="s2">&quot;segmentation/file/weights/segmentor.pt&quot;</span><span class="p">)</span>

<span class="c1"># Выполнение сегментации</span>
<span class="n">segmentor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;ship&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом примере:</p>
<ul class="simple">
<li><p>Загружается изображение.</p></li>
<li><p>Инициализируется сегментатор с указанными параметрами.</p></li>
<li><p>Выполняется предсказание маски для класса <code class="docutils literal notranslate"><span class="pre">&quot;ship&quot;</span></code>.</p></li>
</ul>
</section>
<section id="clustering-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">clustering.py</span></code><a class="headerlink" href="#clustering-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">clustering.py</span></code> демонстрирует использование класса <code class="docutils literal notranslate"><span class="pre">DenseStereo</span></code> для выполнения кластеризации данных, загруженных из файла. Кластеризация — это процесс группировки данных по сходству, что полезно для анализа больших наборов данных, например, в задачах обработки изображений или анализа сцен.</p>
<p>Класс <code class="docutils literal notranslate"><span class="pre">DenseStereo</span></code> инициализируется, после чего данные загружаются из указанного файла с помощью метода <code class="docutils literal notranslate"><span class="pre">load_data_from_file</span></code>. Затем метод <code class="docutils literal notranslate"><span class="pre">make_clustering</span></code> выполняет кластеризацию загруженных данных.</p>
<p>Эта функциональность применима в задачах анализа стереоизображений, таких как группировка пикселей по диспаратности или другим характеристикам.</p>
<p>Пример использования</p>
<p>Ниже приведён пример загрузки данных и выполнения кластеризации:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">DenseStereo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;files/claster.dat&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Основная функция для выполнения кластеризации.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dense_stereo</span> <span class="o">=</span> <span class="n">DenseStereo</span><span class="p">()</span>  <span class="c1"># Замените на актуальную инициализацию</span>
    <span class="n">dense_stereo</span><span class="o">.</span><span class="n">load_data_from_file</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">dense_stereo</span><span class="o">.</span><span class="n">make_clustering</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">freeze_support</span>
    <span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># Для поддержки замороженных исполняемых файлов</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>В этом примере создаётся экземпляр класса <code class="docutils literal notranslate"><span class="pre">DenseStereo</span></code>, данные загружаются из файла <code class="docutils literal notranslate"><span class="pre">files/claster.dat</span></code>, и выполняется кластеризация с использованием метода <code class="docutils literal notranslate"><span class="pre">make_clustering</span></code>.</p>
</section>
<section id="disparity-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">disparity.py</span></code><a class="headerlink" href="#disparity-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">disparity.py</span></code> демонстрирует построение карты диспаратности для стереопары изображений с использованием функции <code class="docutils literal notranslate"><span class="pre">disparity_map</span></code>.
Карта диспаратности — это изображение, в котором каждый пиксель отражает разницу в положении соответствующего пикселя между левым и правым стереоизображениями, что позволяет оценить глубину сцены.</p>
<p>Функция <code class="docutils literal notranslate"><span class="pre">disparity_map</span></code> принимает левое и правое стереоизображения, параметры алгоритма (например, минимальную и максимальную диспаратность, размер блока), тип диспаратности и цветовую карту для визуализации. В примере используется тип <code class="docutils literal notranslate"><span class="pre">DisparityType.ALL</span></code> для генерации всех доступных типов карт диспаратности.</p>
<p>Эта функциональность полезна в задачах стереозрения, таких как реконструкция 3D-сцен или оценка глубины.</p>
<p>Пример использования</p>
<p>Ниже пример загрузки стереопары, вычисления карты диспаратности и её отображения:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">disparity_map</span>

<span class="c1"># Определение перечисления для типов диспаратности</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DisparityType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">BASIC_DISPARITY</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BASIC_HEATMAP</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">FILTERED_DISPARITY</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">FILTERED_HEATMAP</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ALL</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Пути к изображениям</span>
<span class="n">file_image_left</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;example_left.jpg&quot;</span><span class="p">)</span>
<span class="n">file_image_right</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;example_right.jpg&quot;</span><span class="p">)</span>

<span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">path_image_left</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="n">file_image_left</span><span class="p">)</span>
<span class="n">path_image_right</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="n">file_image_right</span><span class="p">)</span>

<span class="c1"># Загрузка изображений</span>
<span class="n">image_left</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_image_left</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
<span class="n">image_right</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_image_right</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>

<span class="c1"># Параметры функции</span>
<span class="n">min_disparity</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">num_disparities</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">block_size</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">5000.0</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLORMAP_TURBO</span>
<span class="n">disparity_type</span> <span class="o">=</span> <span class="n">DisparityType</span><span class="o">.</span><span class="n">ALL</span>

<span class="c1"># Проверка загрузки изображений</span>
<span class="k">if</span> <span class="n">image_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">image_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ошибка: Не удалось загрузить одно или оба изображения&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Создание пустого массива для результата</span>
<span class="n">disparity_map_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image_left</span><span class="p">)</span>

<span class="c1"># Построение карты диспаратности</span>
<span class="n">disparity_map</span><span class="p">(</span><span class="n">disparity_map_output</span><span class="p">,</span> <span class="n">image_left</span><span class="p">,</span> <span class="n">image_right</span><span class="p">,</span> <span class="n">min_disparity</span><span class="p">,</span> <span class="n">num_disparities</span><span class="p">,</span>
              <span class="n">block_size</span><span class="p">,</span> <span class="n">lambda_val</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">disparity_type</span><span class="p">,</span> <span class="n">color_map</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Отображение результата</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s2">&quot;MRCV Disparity Map translating to Карта диспаратности MRCV&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">WINDOW_AUTOSIZE</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;MRCV Disparity Map translating to Карта диспаратности MRCV&quot;</span><span class="p">,</span> <span class="n">disparity_map_output</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</pre></div>
</div>
<p>В этом примере загружаются левое и правое стереоизображения, вычисляется карта диспаратности с заданными параметрами, и результат отображается.</p>
</section>
<section id="dscene-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">3dscene.py</span></code><a class="headerlink" href="#dscene-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">3dscene.py</span></code> демонстрирует использование функции <code class="docutils literal notranslate"><span class="pre">find_3d_points_in_objects_segments</span></code> для определения 3D-точек в сегментах объектов на стереопаре изображений. Эта функция выполняет реконструкцию 3D-координат точек, принадлежащих объектам интереса, что полезно для задач 3D-реконструкции и анализа сцен.</p>
<p>Пример загружает стереопару изображений и параметры камеры, обрабатывает их для получения 3D-точек и выводит результаты, включая изображение с центрами 3D-сегментов, проекцию 3D-сцены и маски объектов.</p>
<p>Эта функциональность применима в задачах автономной навигации, робототехники и компьютерного зрения.</p>
<p>Пример использования</p>
<p>Пример демонстрирует загрузку данных, обработку и отображение результатов:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_camera_stereo_parameters_from_file</span><span class="p">,</span> \
    <span class="n">write_log</span><span class="p">,</span> \
    <span class="n">METOD_DISPARITY</span><span class="p">,</span> \
    <span class="n">find_3d_points_in_objects_segments</span><span class="p">,</span> \
    <span class="n">show_image</span><span class="p">,</span> \
    <span class="n">save_in_file_3d_points_in_objects_segments</span><span class="p">,</span> \
    <span class="n">show_disparity_map</span><span class="p">,</span> \
    <span class="n">converting_undistort_rectify</span><span class="p">,</span> \
    <span class="n">making_stereo_pair</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;=== НОВЫЙ ЗАПУСК ===&quot;</span><span class="p">)</span>

    <span class="c1"># Загрузка изображений</span>
    <span class="n">input_image_camera01</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;./files/L1000.bmp&quot;</span><span class="p">)</span>
    <span class="n">input_image_camera02</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;./files/R1000.bmp&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">input_image_camera01</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">input_image_camera02</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;Не удалось загрузить изображения&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;1. Загрузка изображений из файла (успешно)&quot;</span><span class="p">)</span>

    <span class="c1"># Загрузка параметров камеры</span>
    <span class="n">camera_parameters</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">read_camera_stereo_parameters_from_file</span><span class="p">(</span>
        <span class="s2">&quot;./files/(66a)_(960p)_NewCamStereoModule_Air.xml&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;2. Загрузка параметров стереокамеры из файла (успешно)&quot;</span><span class="p">)</span>

    <span class="c1"># Инициализация параметров</span>
    <span class="n">settings_metod_disparity</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metodDisparity&#39;</span><span class="p">:</span> <span class="n">METOD_DISPARITY</span><span class="o">.</span><span class="n">MODE_SGBM</span><span class="p">}</span>
    <span class="n">limit_out_points</span> <span class="o">=</span> <span class="mi">8000</span>
    <span class="n">limits_outlier_area</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">4.0e3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0e3</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mf">4.0e3</span><span class="p">,</span> <span class="mf">4.0e3</span><span class="p">,</span> <span class="mf">3.0e3</span><span class="p">]</span>
    <span class="n">file_path_model_yolo_neural_net</span> <span class="o">=</span> <span class="s2">&quot;./files/NeuralNet/yolov5n-seg.onnx&quot;</span>
    <span class="n">file_path_classes</span> <span class="o">=</span> <span class="s2">&quot;./files/NeuralNet/yolov5.names&quot;</span>
    <span class="n">parameters_3d_scene</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;angX&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;angY&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;angZ&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
        <span class="s1">&#39;tX&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;tY&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;tZ&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">600</span><span class="p">,</span>
        <span class="s1">&#39;dZ&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>

    <span class="c1"># Обработка изображений</span>
    <span class="n">output_image</span><span class="p">,</span> <span class="n">output_image_3d_scene</span><span class="p">,</span> <span class="n">points_3d</span><span class="p">,</span> <span class="n">reply_masks</span><span class="p">,</span> <span class="n">disparity_map</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">find_3d_points_in_objects_segments</span><span class="p">(</span>
        <span class="n">input_image_camera01</span><span class="p">,</span> <span class="n">input_image_camera02</span><span class="p">,</span> <span class="n">camera_parameters</span><span class="p">,</span>
        <span class="n">settings_metod_disparity</span><span class="p">,</span> <span class="n">limit_out_points</span><span class="p">,</span> <span class="n">limits_outlier_area</span><span class="p">,</span>
        <span class="n">file_path_model_yolo_neural_net</span><span class="p">,</span> <span class="n">file_path_classes</span><span class="p">,</span> <span class="n">parameters_3d_scene</span>
    <span class="p">)</span>

    <span class="c1"># Отображение результатов</span>
    <span class="n">foto_experimental_stand</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;./files/experimantalStand.jpg&quot;</span><span class="p">)</span>
    <span class="n">show_image</span><span class="p">(</span><span class="n">foto_experimental_stand</span><span class="p">,</span> <span class="s2">&quot;fotoExperimantalStand translating to Фото экспериментального стенда&quot;</span><span class="p">)</span>

    <span class="n">output_stereo_pair</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">making_stereo_pair</span><span class="p">(</span><span class="n">input_image_camera01</span><span class="p">,</span> <span class="n">input_image_camera02</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">show_image</span><span class="p">(</span><span class="n">output_stereo_pair</span><span class="p">,</span> <span class="s2">&quot;SourceStereoImage translating to Исходное стереоизображение&quot;</span><span class="p">)</span>
        <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;4.2 Отображение исходного изображения (успешно)&quot;</span><span class="p">)</span>

    <span class="n">input_image_camera01_remap</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">converting_undistort_rectify</span><span class="p">(</span>
        <span class="n">input_image_camera01</span><span class="p">,</span> <span class="n">camera_parameters</span><span class="p">[</span><span class="s1">&#39;map11&#39;</span><span class="p">],</span> <span class="n">camera_parameters</span><span class="p">[</span><span class="s1">&#39;map12&#39;</span><span class="p">])</span>
    <span class="n">input_image_camera02_remap</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">converting_undistort_rectify</span><span class="p">(</span>
        <span class="n">input_image_camera02</span><span class="p">,</span> <span class="n">camera_parameters</span><span class="p">[</span><span class="s1">&#39;map21&#39;</span><span class="p">],</span> <span class="n">camera_parameters</span><span class="p">[</span><span class="s1">&#39;map22&#39;</span><span class="p">])</span>
    <span class="n">output_stereo_pair_remap</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">making_stereo_pair</span><span class="p">(</span><span class="n">input_image_camera01_remap</span><span class="p">,</span> <span class="n">input_image_camera02_remap</span><span class="p">)</span>
    <span class="n">show_image</span><span class="p">(</span><span class="n">output_stereo_pair_remap</span><span class="p">,</span> <span class="s2">&quot;outputStereoPairRemap translating to Исправленная стереопара&quot;</span><span class="p">)</span>

    <span class="n">show_disparity_map</span><span class="p">(</span><span class="n">disparity_map</span><span class="p">,</span> <span class="s2">&quot;disparityMap translating to Карта диспаратности&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">qs</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reply_masks</span><span class="p">):</span>
        <span class="n">show_image</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;replyMasks </span><span class="si">{</span><span class="n">qs</span><span class="si">}</span><span class="s2"> translating to Маски ответа </span><span class="si">{</span><span class="n">qs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;4.5 Отображение бинарных изображений сегментов (успешно)&quot;</span><span class="p">)</span>

    <span class="n">path_to_file</span> <span class="o">=</span> <span class="s2">&quot;./files/3DPointsInObjectsSegments.txt&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">save_in_file_3d_points_in_objects_segments</span><span class="p">(</span><span class="n">points_3d</span><span class="p">,</span> <span class="n">path_to_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">write_log</span><span class="p">(</span><span class="s2">&quot;4.6 Сохранение 3D-точек в текстовый файл (успешно)&quot;</span><span class="p">)</span>

    <span class="n">show_image</span><span class="p">(</span><span class="n">output_image</span><span class="p">,</span> <span class="s2">&quot;outputImage translating to Выходное изображение&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">show_image</span><span class="p">(</span><span class="n">output_image_3d_scene</span><span class="p">,</span> <span class="s2">&quot;outputImage3dSceene translating to Проекция 3D-сцены&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Описание
В этом примере загружаются стереопара изображений и параметры камеры, выполняется обработка для получения 3D-точек, и результаты визуализируются с использованием различных функций отображения.</p>
</section>
<section id="imgpreprocessing-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">imgpreprocessing.py</span></code><a class="headerlink" href="#imgpreprocessing-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">imgpreprocessing.py</span></code> демонстрирует использование класса <code class="docutils literal notranslate"><span class="pre">MRCV</span></code> для предварительной обработки изображений с применением различных методов, таких как фильтрация шума, балансировка контраста и повышение резкости. Предобработка изображений — важный этап в задачах компьютерного зрения для улучшения качества изображений перед анализом.</p>
<p>Пример загружает изображение, определяет список методов предобработки и применяет их с помощью метода <code class="docutils literal notranslate"><span class="pre">preprocessingImage</span></code>. Результат сохраняется в файл и отображается.</p>
<p>Эта функциональность полезна для подготовки изображений к последующему анализу, например, для обнаружения объектов или сегментации.</p>
<p>Пример использования</p>
<p>Пример показывает загрузку изображения, применение предобработки и сохранение результата:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">MRCV</span><span class="p">,</span> <span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="p">,</span> <span class="n">LOGTYPE</span>

<span class="c1"># Создание выходной директории</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;./files/outImages&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Логирование уже настроено в mrcv.py</span>
<span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="s2">&quot; === НОВЫЙ ЗАПУСК === &quot;</span><span class="p">)</span>

<span class="c1"># Загрузка изображения</span>
<span class="n">imageInputFilePath</span> <span class="o">=</span> <span class="s2">&quot;./files/img02.jfif&quot;</span>
<span class="n">imageIn</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">imageInputFilePath</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
<span class="n">imageOut</span> <span class="o">=</span> <span class="n">imageIn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">imageIn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">imageIn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    загружено изображение: </span><span class="si">{</span><span class="n">imageInputFilePath</span><span class="si">}</span><span class="s2"> :: &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">imageIn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">imageIn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">imageIn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    не удалось загрузить изображение: </span><span class="si">{</span><span class="n">imageInputFilePath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">LOGTYPE</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Определение методов предобработки</span>
<span class="n">methodImagePreProcessingBrightnessContrast</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">.</span><span class="n">NOISE_FILTERING_01_MEDIAN_FILTER</span><span class="p">,</span>
    <span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">.</span><span class="n">BALANCE_CONTRAST_10_LAB_CLAHE</span><span class="p">,</span>
    <span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">.</span><span class="n">SHARPENING_02</span><span class="p">,</span>
    <span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">.</span><span class="n">BRIGHTNESS_LEVEL_DOWN</span><span class="p">,</span>
    <span class="n">METOD_IMAGE_PERPROCESSIN</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Предобработка изображения</span>
<span class="n">state</span><span class="p">,</span> <span class="n">imageOut</span> <span class="o">=</span> <span class="n">MRCV</span><span class="o">.</span><span class="n">preprocessingImage</span><span class="p">(</span>
    <span class="n">imageOut</span><span class="p">,</span> <span class="n">methodImagePreProcessingBrightnessContrast</span><span class="p">,</span> <span class="s2">&quot;./files/camera-parameters.xml&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="s2">&quot; Предобработка изображения завершена (успешно)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; preprocessingImage, state = </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">LOGTYPE</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="c1"># Сохранение выходного изображения</span>
<span class="n">imageOutputFilePath</span> <span class="o">=</span> <span class="s2">&quot;./files/outImages/test.png&quot;</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">imageOutputFilePath</span><span class="p">,</span> <span class="n">imageOut</span><span class="p">)</span>
<span class="n">MRCV</span><span class="o">.</span><span class="n">writeLog</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> результат предобработки сохранён: </span><span class="si">{</span><span class="n">imageOutputFilePath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Отображение изображений</span>
<span class="n">CoefShowWindow</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">imageIn</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">imageIn</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="n">CoefShowWindow</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="n">CoefShowWindow</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>
<span class="n">imageOut</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">imageOut</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="n">CoefShowWindow</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="n">CoefShowWindow</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s2">&quot;imageIn translating to Входное изображение&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">WINDOW_AUTOSIZE</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;imageIn translating to Входное изображение&quot;</span><span class="p">,</span> <span class="n">imageIn</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s2">&quot;imageOut translating to Выходное изображение&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">WINDOW_AUTOSIZE</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;imageOut translating to Выходное изображение&quot;</span><span class="p">,</span> <span class="n">imageOut</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</pre></div>
</div>
<p>Описание
В этом примере загружается изображение, выполняется предобработка с использованием указанных методов, а результат сохраняется и отображается.</p>
</section>
<section id="comparing-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">comparing.py</span></code><a class="headerlink" href="#comparing-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">comparing.py</span></code> демонстрирует использование функции <code class="docutils literal notranslate"><span class="pre">compare_images</span></code> для сравнения двух изображений и вычисления их сходства. Эта функция полезна для задач, таких как обнаружение дубликатов изображений, контроль качества или анализ изменений.</p>
<p>Функция <code class="docutils literal notranslate"><span class="pre">compare_images</span></code> принимает два изображения и возвращает показатель сходства, указывающий, насколько они похожи.</p>
<p>Пример использования</p>
<p>Пример показывает загрузку двух изображений и вычисление их сходства:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">compare_images</span>

<span class="c1"># Путь к папке с изображениями</span>
<span class="n">image_dir</span> <span class="o">=</span> <span class="s2">&quot;files&quot;</span>
<span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="n">image_dir</span><span class="p">)</span>

<span class="c1"># Загрузка изображений</span>
<span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s2">&quot;1.png&quot;</span><span class="p">))</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s2">&quot;2.png&quot;</span><span class="p">))</span>

<span class="c1"># Проверка, что изображения загружены</span>
<span class="k">if</span> <span class="n">img1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">img2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ошибка: Не удалось загрузить одно или оба изображения.&quot;</span><span class="p">)</span>

<span class="c1"># Сравнение изображений</span>
<span class="n">similarity</span> <span class="o">=</span> <span class="n">compare_images</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Сходство: </span><span class="si">{</span><span class="n">similarity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание</p>
<p>В этом примере загружаются два изображения, и их сходство вычисляется и выводится с использованием функции <code class="docutils literal notranslate"><span class="pre">compare_images</span></code>.</p>
</section>
<section id="detectorautotrain-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">detectorautotrain.py</span></code><a class="headerlink" href="#detectorautotrain-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">detectorautotrain.py</span></code> демонстрирует использование класса <code class="docutils literal notranslate"><span class="pre">Detector</span></code> для автоматического обучения детектора объектов. Этот класс позволяет инициализировать детектор с определёнными параметрами и запускать процесс обучения на предоставленном наборе данных.</p>
<p>Метод <code class="docutils literal notranslate"><span class="pre">auto_train</span></code> принимает путь к набору данных, расширение файлов изображений, списки эпох, размеров пакета и скоростей обучения, а также пути к предварительно обученной модели и месту сохранения обученной модели. Это автоматизирует обучение с различными гиперпараметрами.</p>
<p>Данная функциональность полезна для задач обнаружения объектов, таких как идентификация кораблей или других объектов интереса.</p>
<p>Пример использования</p>
<p>Пример показывает инициализацию детектора и запуск автоматического обучения:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">Detector</span>

<span class="n">voc_classes_path</span> <span class="o">=</span> <span class="s2">&quot;files/onwater/voc_classes.txt&quot;</span>
<span class="n">dataset_path</span> <span class="o">=</span> <span class="s2">&quot;files/onwater/&quot;</span>
<span class="n">pretrained_model_path</span> <span class="o">=</span> <span class="s2">&quot;files/onwater_autodetector.pt&quot;</span>
<span class="n">model_save_path</span> <span class="o">=</span> <span class="s2">&quot;files/yolo4_tiny.pt&quot;</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">Detector</span><span class="p">()</span>
<span class="n">detector</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="n">voc_classes_path</span><span class="p">)</span>
<span class="n">detector</span><span class="o">.</span><span class="n">auto_train</span><span class="p">(</span>
    <span class="n">dataset_path</span><span class="p">,</span>
    <span class="s2">&quot;.jpg&quot;</span><span class="p">,</span>
    <span class="n">epochs_list</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="n">batch_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="n">learning_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">],</span>
    <span class="n">pretrained_path</span><span class="o">=</span><span class="n">pretrained_model_path</span><span class="p">,</span>
    <span class="n">save_path</span><span class="o">=</span><span class="n">model_save_path</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Описание</p>
<p>В этом примере создаётся экземпляр класса <code class="docutils literal notranslate"><span class="pre">Detector</span></code>, инициализируется с параметрами, и запускается автоматическое обучение на наборе данных с различными гиперпараметрами.</p>
</section>
<section id="augmentation-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">augmentation.py</span></code><a class="headerlink" href="#augmentation-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">augmentation.py</span></code> демонстрирует использование функций <code class="docutils literal notranslate"><span class="pre">augmentation</span></code> и <code class="docutils literal notranslate"><span class="pre">batch_augmentation</span></code> для применения различных методов аугментации к изображениям.</p>
<p>Аугментация изображений — это метод увеличения размера набора данных путём создания изменённых копий изображений, что улучшает обобщающую способность моделей машинного обучения.</p>
<p>Функция <code class="docutils literal notranslate"><span class="pre">augmentation</span></code> принимает список изображений и методы аугментации, возвращая аугментированные изображения. Функция <code class="docutils literal notranslate"><span class="pre">batch_augmentation</span></code> выполняет аугментацию в пакетном режиме с конфигурацией, указывающей, сохранять ли оригиналы, общее количество выходных изображений и веса для различных методов.</p>
<p>Данная функциональность полезна для подготовки данных в задачах компьютерного зрения, таких как обучение детекторов объектов.</p>
<p>Пример использования</p>
<p>Пример показывает применение аугментации к изображениям:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">AugmentationMethod</span><span class="p">,</span> <span class="n">BatchAugmentationConfig</span><span class="p">,</span> <span class="n">augmentation</span><span class="p">,</span> <span class="n">batch_augmentation</span>

<span class="n">input_images</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;img</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка: Не удалось загрузить изображение по пути </span><span class="si">{</span><span class="n">img_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">input_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="c1"># Создание копии входных изображений</span>
<span class="n">input_images_copy</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">input_images</span><span class="p">]</span>

<span class="c1"># Определение методов аугментации</span>
<span class="n">augmentation_methods</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">ROTATE_IMAGE_90</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">FLIP_HORIZONTAL</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">FLIP_VERTICAL</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">ROTATE_IMAGE_45</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">ROTATE_IMAGE_315</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">ROTATE_IMAGE_270</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">FLIP_HORIZONTAL_AND_VERTICAL</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Выполнение аугментации</span>
<span class="n">state</span><span class="p">,</span> <span class="n">output_images</span> <span class="o">=</span> <span class="n">augmentation</span><span class="p">(</span><span class="n">input_images</span><span class="p">,</span> <span class="n">augmentation_methods</span><span class="p">)</span>
<span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка: Аугментация завершилась с кодом </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Конфигурация пакетной аугментации</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">BatchAugmentationConfig</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">keep_original</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">config</span><span class="o">.</span><span class="n">total_output_count</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">config</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">config</span><span class="o">.</span><span class="n">method_weights</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">FLIP_HORIZONTAL</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">ROTATE_IMAGE_90</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">BRIGHTNESS_CONTRAST_ADJUST</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">PERSPECTIVE_WARP</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">AugmentationMethod</span><span class="o">.</span><span class="n">COLOR_JITTER</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Выполнение пакетной аугментации</span>
<span class="n">state</span><span class="p">,</span> <span class="n">batch_output</span> <span class="o">=</span> <span class="n">batch_augmentation</span><span class="p">(</span>
    <span class="n">input_images_copy</span><span class="p">,</span>
    <span class="n">config</span><span class="p">,</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;batch_output&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка: Пакетная аугментация завершилась с кодом: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание</p>
<p>В этом примере загружаются изображения, применяются различные методы аугментации, и выполняется пакетная аугментация с заданной конфигурацией.</p>
</section>
<section id="morphologyimage-py">
<h2>Описание для скрипта <code class="docutils literal notranslate"><span class="pre">morphologyimage.py</span></code><a class="headerlink" href="#morphologyimage-py" title="Link to this heading"></a></h2>
<p>Скрипт <code class="docutils literal notranslate"><span class="pre">morphologyimage.py</span></code> демонстрирует использование функции <code class="docutils literal notranslate"><span class="pre">morphology_image</span></code> для применения морфологических операций к изображению.</p>
<p>Морфологические операции, такие как открытие, закрытие, эрозия и дилатация, используются для обработки бинарных или полутоновых изображений, помогая в сегментации, удалении шума и выделении структур.</p>
<p>Функция <code class="docutils literal notranslate"><span class="pre">morphology_image</span></code> принимает изображение, путь для сохранения результата, тип морфологической операции и размер ядра. В примере используется операция <code class="docutils literal notranslate"><span class="pre">METOD_MORF.OPEN</span></code> для удаления мелких объектов и шума.</p>
<p>Данная функциональность полезна для предобработки изображений перед анализом, например, для выделения объектов интереса.</p>
<p>Пример использования</p>
<p>Пример показывает применение морфологической операции к изображению:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mrcv</span><span class="w"> </span><span class="kn">import</span> <span class="n">morphology_image</span><span class="p">,</span> <span class="n">METOD_MORF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">image_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
<span class="n">current_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
<span class="n">image_path</span> <span class="o">=</span> <span class="n">current_path</span> <span class="o">/</span> <span class="n">image_file</span>
<span class="n">input_image</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_path</span> <span class="o">/</span> <span class="s2">&quot;opening.png&quot;</span><span class="p">)</span>
<span class="n">output_image</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_path</span> <span class="o">/</span> <span class="s2">&quot;out.png&quot;</span><span class="p">)</span>

<span class="n">morph_size</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Чтение изображения в градациях серого</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

<span class="c1"># Проверка успешности загрузки изображения</span>
<span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Не удалось открыть или найти изображение&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">morphology_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output_image</span><span class="p">,</span> <span class="n">METOD_MORF</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span> <span class="n">morph_size</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание</p>
<p>В этом примере загружается полутоновое изображение, применяется морфологическая операция открытия с размером ядра 1, и результат сохраняется.</p>
</section>
</section>
<section id="id100">
<h1>Руководство для контрибьюторов<a class="headerlink" href="#id100" title="Link to this heading"></a></h1>
<p>Это руководство предназначено для разработчиков и пользователей, желающих внести вклад в развитие библиотеки <strong>Marine Robotics Computer Vision (MRCV)</strong>. Ниже представлены инструкции по установке зависимостей, сборке проекта и рекомендации по работе с CUDA.</p>
<p>Датасет изображений для работы с библиотекой доступен по ссылкам:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://disk.yandex.ru/d/TxReQ9J6PAo9Nw">code-ai-400393-image-dataset.7z</a></p></li>
<li><p><a class="reference external" href="https://huggingface.co/datasets/saigon-89/code-ai-400393">code-ai-400393-huggingface</a></p></li>
</ul>
<section id="id101">
<h2>Получение исходного кода<a class="headerlink" href="#id101" title="Link to this heading"></a></h2>
<p>Исходный код библиотеки доступен на внутреннем репозитории. Клонируйте проект:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>main<span class="w"> </span>https://github.com/valabsoft/code-ai-400393.git
</pre></div>
</div>
</section>
<section id="mrcv">
<h2>Необходимые зависимости для установки библиотеки mrcv<a class="headerlink" href="#mrcv" title="Link to this heading"></a></h2>
<p>Для корректной работы библиотеки все необходимые зависимости должны быть установлены в соответсвии с разделом руководства <strong>Установка и первоначальная настройка библиотеки</strong>.</p>
</section>
<section id="windows-linux-mrcv">
<h2>Инструкция по установке Windows/Linux версии библиотеки mrcv<a class="headerlink" href="#windows-linux-mrcv" title="Link to this heading"></a></h2>
<p>Для сборки библиотеки на системах Windows или Linux (Ubuntu) необходимо воспользоваться инструкцией из раздела руководства <strong>Установка и первоначальная настройка библиотеки</strong>.</p>
</section>
<section id="id102">
<h2>Оформление изменений<a class="headerlink" href="#id102" title="Link to this heading"></a></h2>
<p>Перед отправкой изменений:</p>
<ol class="arabic simple">
<li><p><strong>Форкните репозиторий</strong> и создайте отдельную ветку для каждой задачи.</p></li>
<li><p><strong>Не объединяйте</strong> несвязанные изменения в одном pull request.</p></li>
<li><p><strong>Багфиксы</strong> — на ветках от стабильной версии; <strong>новые фичи</strong> — от <cite>main</cite>.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>fix-crash-in-detector<span class="w"> </span>main
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Убедитесь, что вы:
- написали/обновили тесты;
- обновили документацию;
- добавили вас в <cite>CHANGELOG.md</cite> (если он есть).</p></li>
</ol>
</section>
<section id="id103">
<h2>Отчёты об ошибках<a class="headerlink" href="#id103" title="Link to this heading"></a></h2>
<p>Перед отправкой:</p>
<ul class="simple">
<li><p>Обновитесь до последней версии библиотеки.</p></li>
<li><p>Проверьте, повторяется ли ошибка на старых версиях.</p></li>
<li><p>Проверьте зависимости: версии OpenCV, LibTorch и др.</p></li>
<li><p>Найдите похожие тикеты/обсуждения.</p></li>
</ul>
<p>При оформлении тикета:</p>
<ul class="simple">
<li><p>Укажите ОС, версию компилятора, сборки библиотек.</p></li>
<li><p>Приложите минимальный пример кода с воспроизведением ошибки.</p></li>
<li><p>Включите логи и команды запуска.</p></li>
</ul>
</section>
<section id="id104">
<h2>Рекомендации по контрибьюции<a class="headerlink" href="#id104" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Пишите понятный и документированный код.</p></li>
<li><p>Используйте стиль оформления, принятый в библиотеке.</p></li>
<li><p>Обновляйте документацию при добавлении новых функций.</p></li>
<li><p>Проверяйте кросс-платформенность (Windows/Linux, CPU/CUDA).</p></li>
<li><p>Перед публикацией изменений убедитесь, что они не нарушают сборку библиотеки.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Author.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>