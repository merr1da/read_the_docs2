Руководство для контрибьюторов
==============================

Это руководство предназначено для разработчиков и пользователей, желающих внести вклад в развитие библиотеки **Marine Robotics Computer Vision (MRCV)**. Ниже представлены инструкции по установке зависимостей, сборке проекта и рекомендации по работе с CUDA.

Получение исходного кода
~~~~~~~~~~~~~~~~~~~~~~~~

Исходный код библиотеки доступен на внутреннем репозитории. Клонируйте проект:

.. code-block:: bash

   git clone https://github.com/valabsoft/code-ai-400393.git
   cd mrcv

Необходимые зависимости
~~~~~~~~~~~~~~~~~~~~~~~~

Для корректной работы библиотеки на **Windows** все необходимые зависимости должны быть установлены и размещены следующим образом:

.. code-block:: none

   C:\
   ├───libtorch-12.4
   ├───libtorch-12.4-cuda
   ├───opencv-4.10.0-build
   ├───opencv-4.10.0-build-cuda
   └───yaml-cpp

Также необходимо добавить в системную переменную `PATH` пути к бинарным файлам обеих сборок OpenCV:

- C:\\opencv-4.10.0-build\\install\\x64\\vc17\\bin\\
- C:\\opencv-4.10.0-build-cuda\\install\\x64\\vc17\\bin\\

Настройка сборки
~~~~~~~~~~~~~~~~

В корневом `CMakeLists.txt` проекта имеется флаг:

.. code-block:: cmake

   option(USE_CUDA "Use CUDA Build" OFF)

Он определяет режим сборки библиотеки:

- `OFF` — сборка без поддержки CUDA. Используются OpenCV и LibTorch для CPU. CUDA-функции не будут доступны.
- `ON` — сборка с поддержкой CUDA. Используются OpenCV с модулями CUDA и LibTorch для CUDA. CUDA-функции активны в пространстве имён `mrcv::`.

Сборка с CUDA
^^^^^^^^^^^^^

Для включения поддержки CUDA необходимо:

1. Установить:

   - **CUDA Toolkit 12.4**
   - **cuDNN 9.3**

2. Скопировать содержимое `bin`, `lib` и `include` из папки cuDNN в каталог установки CUDA Toolkit.

.. important::

   После смены значения `USE_CUDA` обязательно удалите и пересоздайте директорию `build/`, иначе сборка завершится с ошибками.

.. code-block:: bash

   rd /s /q build
   mkdir build
   cd build
   cmake ..
   cmake --build . --config Release

При необходимости, скопируйте `*.dll` из используемой версии OpenCV или LibTorch в папку с исполняемыми файлами.

Оформление изменений
~~~~~~~~~~~~~~~~~~~~

Перед отправкой изменений:

1. **Форкните репозиторий** и создайте отдельную ветку для каждой задачи.
2. **Не объединяйте** несвязанные изменения в одном pull request.
3. **Багфиксы** — на ветках от стабильной версии; **новые фичи** — от `main`.

.. code-block:: bash

   git checkout -b fix-crash-in-detector main

4. Убедитесь, что вы:
   - написали/обновили тесты;
   - обновили документацию;
   - добавили вас в `CHANGELOG.md` (если он есть).

Репорты об ошибках
~~~~~~~~~~~~~~~~~~

Перед отправкой:

- Обновитесь до последней версии библиотеки.
- Проверьте, повторяется ли ошибка на старых версиях.
- Проверьте зависимости: версии OpenCV, LibTorch и др.
- Найдите похожие тикеты/обсуждения.

При оформлении тикета:

- Укажите ОС, версию компилятора, сборки библиотек.
- Приложите минимальный пример кода с воспроизведением ошибки.
- Включите логи и команды запуска.
  
Рекомендации по контрибьюции
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Пишите понятный и документированный код.
- Используйте стиль оформления, принятый в библиотеке.
- Обновляйте документацию при добавлении новых функций.
- Проверяйте кросс-платформенность (Windows/Linux, CPU/CUDA).
- Перед публикацией изменений убедитесь, что они не нарушают сборку библиотеки.
